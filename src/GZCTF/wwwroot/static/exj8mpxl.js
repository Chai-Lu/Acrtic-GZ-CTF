/* The GZ::CTF Project @unknown
 * 
 * License   : GNU Affero General Public License v3.0 (Core)
 * License   : LicenseRef-GZCTF-Restricted (Restricted components)
 * Commit    : Unofficial build version
 * Build     : 2025-12-08T11:45:34.456Z
 * Copyright (C) 2022-2025 GZTimeWalker. All Rights Reserved.
 */
import"./lcut4z52.js";import"./cbxtepre.js";import{l as e}from"./isy1dskq.js";import{t}from"./cdbutviq.js";import"./kocdnk2i.js";import{a as n,i as r,n as i,o as a,r as o,t as s}from"./hrbt7ry7.js";import{o as c}from"./gaobt2im.js";import{t as l}from"./j0saofxo.js";import"./nugqs812.js";import{n as u,t as d}from"./cppun4hr.js";import{t as f}from"./o417b45d.js";import{t as p}from"./h0nb8b87.js";import{$r as m,Br as ee,Ca as h,Cr as g,Fi as te,Gi as ne,Ht as re,In as ie,Jr as _,Mr as v,O as y,Oa as b,Or as x,Pi as ae,Si as oe,Ti as S,Vr as C,W as w,Wn as T,Xi as E,Y as se,Yr as D,Zr as O,Zt as ce,ai as le,b as ue,ci as k,cr as A,di as de,dr as j,fa as M,ha as fe,ii as pe,ji as N,jr as P,ki as me,la as he,li as F,ma as ge,mn as _e,ni as ve,nt as ye,oi as be,pa as xe,q as Se,ri as Ce,si as we,sr as Te,ta as Ee,ti as De,tn as Oe,tt as ke,wi as I,y as L,ya as Ae,yi as je}from"./index.hrqptwjo.js";import"./iwhjrhtg.js";import{t as Me}from"./cjpezv9m.js";import"./mdazlrzp.js";import"./mbfygvvk.js";import{t as Ne}from"./eojlsg3s.js";import{t as Pe}from"./lvtgxs0o.js";import{n as Fe}from"./o4secb0i.js";var R=b(h(),1),z=b(fe(),1),[Ie,B]=ge(`Drawer component was not found in tree`),V={root:`m_f11b401e`,header:`m_5a7c2c9`,content:`m_b8a05bbd`,inner:`m_31cd769a`},Le=I((e,t)=>{let{classNames:n,className:r,style:i,styles:a,vars:o,...s}=N(`DrawerBody`,null,e);return(0,z.jsx)(we,{ref:t,...B().getStyles(`body`,{classNames:n,style:i,styles:a,className:r}),...s})});Le.classes=V,Le.displayName=`@mantine/core/DrawerBody`;var Re=I((e,t)=>{let{classNames:n,className:r,style:i,styles:a,vars:o,...s}=N(`DrawerCloseButton`,null,e);return(0,z.jsx)(be,{ref:t,...B().getStyles(`close`,{classNames:n,style:i,styles:a,className:r}),...s})});Re.classes=V,Re.displayName=`@mantine/core/DrawerCloseButton`;var H=I((e,t)=>{let{classNames:n,className:r,style:i,styles:a,vars:o,children:s,radius:c,__hidden:l,...u}=N(`DrawerContent`,null,e),d=B(),f=d.scrollAreaComponent||De;return(0,z.jsx)(le,{...d.getStyles(`content`,{className:r,style:i,styles:a,classNames:n}),innerProps:d.getStyles(`inner`,{className:r,style:i,styles:a,classNames:n}),ref:t,...u,radius:c||d.radius||0,"data-hidden":l||void 0,children:(0,z.jsx)(f,{style:{height:`calc(100vh - var(--drawer-offset) * 2)`},children:s})})});H.classes=V,H.displayName=`@mantine/core/DrawerContent`;var ze=I((e,t)=>{let{classNames:n,className:r,style:i,styles:a,vars:o,...s}=N(`DrawerHeader`,null,e);return(0,z.jsx)(pe,{ref:t,...B().getStyles(`header`,{classNames:n,style:i,styles:a,className:r}),...s})});ze.classes=V,ze.displayName=`@mantine/core/DrawerHeader`;var Be=I((e,t)=>{let{classNames:n,className:r,style:i,styles:a,vars:o,...s}=N(`DrawerOverlay`,null,e);return(0,z.jsx)(Ce,{ref:t,...B().getStyles(`overlay`,{classNames:n,style:i,styles:a,className:r}),...s})});Be.classes=V,Be.displayName=`@mantine/core/DrawerOverlay`;function Ve(e){switch(e){case`top`:return`flex-start`;case`bottom`:return`flex-end`;default:return}}function He(e){if(e===`top`||e===`bottom`)return`0 0 calc(100% - var(--drawer-offset, 0rem) * 2)`}var Ue={top:`slide-down`,bottom:`slide-up`,left:`slide-right`,right:`slide-left`},We={top:`slide-down`,bottom:`slide-up`,right:`slide-right`,left:`slide-left`},Ge={closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:M(`modal`),position:`left`},Ke=ne((e,{position:t,size:n,offset:r})=>({root:{"--drawer-size":he(n,`drawer-size`),"--drawer-flex":He(t),"--drawer-height":t===`left`||t===`right`?void 0:`var(--drawer-size)`,"--drawer-align":Ve(t),"--drawer-justify":t===`right`?`flex-end`:void 0,"--drawer-offset":Ae(r)}})),U=I((e,t)=>{let n=N(`DrawerRoot`,Ge,e),{classNames:r,className:i,style:a,styles:o,unstyled:s,vars:c,scrollAreaComponent:l,position:u,transitionProps:d,radius:f,attributes:p,...m}=n,{dir:ee}=oe(),h=ae({name:`Drawer`,classes:V,props:n,className:i,style:a,classNames:r,styles:o,unstyled:s,attributes:p,vars:c,varsResolver:Ke}),g=(ee===`rtl`?We:Ue)[u];return(0,z.jsx)(Ie,{value:{scrollAreaComponent:l,getStyles:h,radius:f},children:(0,z.jsx)(k,{ref:t,...h(`root`),transitionProps:{transition:g,...d},"data-offset-scrollbars":l===je.Autosize||void 0,unstyled:s,...m})})});U.classes=V,U.displayName=`@mantine/core/DrawerRoot`;var[qe,Je]=xe();function Ye({children:e}){let[t,n]=(0,R.useState)([]),[r,i]=(0,R.useState)(M(`modal`));return(0,z.jsx)(qe,{value:{stack:t,addModal:(e,t)=>{n(t=>[...new Set([...t,e])]),i(e=>typeof t==`number`&&typeof e==`number`?Math.max(e,t):e)},removeModal:e=>n(t=>t.filter(t=>t!==e)),getZIndex:e=>`calc(${r} + ${t.indexOf(e)} + 1)`,currentId:t[t.length-1],maxZIndex:r},children:e})}Ye.displayName=`@mantine/core/DrawerStack`;var W=I((e,t)=>{let{classNames:n,className:r,style:i,styles:a,vars:o,...s}=N(`DrawerTitle`,null,e);return(0,z.jsx)(ve,{ref:t,...B().getStyles(`title`,{classNames:n,style:i,styles:a,className:r}),...s})});W.classes=V,W.displayName=`@mantine/core/DrawerTitle`;var G={closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:M(`modal`),withOverlay:!0,withCloseButton:!0},K=I((e,t)=>{let{title:n,withOverlay:r,overlayProps:i,withCloseButton:a,closeButtonProps:o,children:s,opened:c,stackId:l,zIndex:u,...d}=N(`Drawer`,G,e),f=Je(),p=!!n||a,m=f&&l?{closeOnEscape:f.currentId===l,trapFocus:f.currentId===l,zIndex:f.getZIndex(l)}:{},ee=r===!1?!1:l&&f?f.currentId===l:c;return(0,R.useEffect)(()=>{f&&l&&(c?f.addModal(l,u||M(`modal`)):f.removeModal(l))},[c,l,u]),(0,z.jsxs)(U,{ref:t,opened:c,zIndex:f&&l?f.getZIndex(l):u,...d,...m,children:[r&&(0,z.jsx)(Be,{visible:ee,transitionProps:f&&l?{duration:0}:void 0,...i}),(0,z.jsxs)(H,{__hidden:f&&l&&c?l!==f.currentId:!1,children:[p&&(0,z.jsxs)(ze,{children:[n&&(0,z.jsx)(W,{children:n}),a&&(0,z.jsx)(Re,{...o})]}),(0,z.jsx)(Le,{children:s})]})]})});K.classes=V,K.displayName=`@mantine/core/Drawer`,K.Root=U,K.Overlay=Be,K.Content=H,K.Body=Le,K.Header=ze,K.Title=W,K.CloseButton=Re,K.Stack=Ye;function Xe({data:e,value:t}){let n=t.map(e=>e.trim().toLowerCase());return e.reduce((e,t)=>(i(t)?e.push({group:t.group,items:t.items.filter(e=>n.indexOf(e.value.toLowerCase().trim())===-1)}):n.indexOf(t.value.toLowerCase().trim())===-1&&e.push(t),e),[])}var Ze={maxValues:1/0,withCheckIcon:!0,checkIconPosition:`left`,hiddenInputValuesDivider:`,`,clearSearchOnChange:!0,size:`sm`},q=I((e,t)=>{let i=N(`MultiSelect`,Ze,e),{classNames:c,className:l,style:f,styles:p,unstyled:m,vars:ee,size:h,value:g,defaultValue:ne,onChange:re,onKeyDown:ie,variant:_,data:v,dropdownOpened:y,defaultDropdownOpened:b,onDropdownOpen:x,onDropdownClose:oe,selectFirstOptionOnChange:S,onOptionSubmit:C,comboboxProps:w,filter:T,limit:se,withScrollArea:D,maxDropdownHeight:O,searchValue:ce,defaultSearchValue:le,onSearchChange:ue,readOnly:k,disabled:A,onFocus:de,onBlur:j,radius:M,rightSection:fe,rightSectionWidth:pe,rightSectionPointerEvents:P,rightSectionProps:he,leftSection:F,leftSectionWidth:ge,leftSectionPointerEvents:_e,leftSectionProps:ve,inputContainer:ye,inputWrapperOrder:be,withAsterisk:xe,labelProps:Se,descriptionProps:Ce,errorProps:we,wrapperProps:Te,description:De,label:Oe,error:ke,maxValues:I,searchable:L,nothingFoundMessage:Ae,withCheckIcon:je,checkIconPosition:Me,hidePickedOptions:Ne,withErrorStyles:Pe,name:Fe,form:Ie,id:B,clearable:V,clearButtonProps:Le,hiddenInputProps:Re,placeholder:H,hiddenInputValuesDivider:ze,required:Be,mod:Ve,renderOption:He,onRemove:Ue,onClear:We,scrollAreaProps:Ge,chevronColor:Ke,attributes:U,clearSearchOnChange:qe,...Je}=i,Ye=Ee(B),W=a(v),G=n(W),K=(0,R.useRef)({}),q=r({opened:y,defaultOpened:b,onDropdownOpen:x,onDropdownClose:()=>{oe?.(),q.resetSelectedOption()}}),{styleProps:Qe,rest:{type:J,autoComplete:$e,...et}}=me(Je),[Y,X]=E({value:g,defaultValue:ne,finalValue:[],onChange:re}),[tt,nt]=E({value:ce,defaultValue:le,finalValue:``,onChange:ue}),Z=e=>{nt(e),q.resetSelectedOption()},rt=ae({name:`MultiSelect`,classes:{},props:i,classNames:c,styles:p,unstyled:m,attributes:U}),{resolvedClassNames:Q,resolvedStyles:it}=te({props:i,styles:p,classNames:c}),at=e=>{ie?.(e),e.key===` `&&!L&&(e.preventDefault(),q.toggleDropdown()),e.key===`Backspace`&&tt.length===0&&Y.length>0&&(Ue?.(Y[Y.length-1]),X(Y.slice(0,Y.length-1)))},$=Y.map((e,t)=>{let n=G[e]||K.current[e];return(0,z.jsx)(u,{withRemoveButton:!k&&!G[e]?.disabled,onRemove:()=>{X(Y.filter(t=>e!==t)),Ue?.(e)},unstyled:m,disabled:A,...rt(`pill`),children:n?.label||e},`${e}-${t}`)});(0,R.useEffect)(()=>{S&&q.selectFirstOption()},[S,tt]),(0,R.useEffect)(()=>{Y.forEach(e=>{e in G&&(K.current[e]=G[e])})},[G,Y]);let ot=(0,z.jsx)(o.ClearButton,{...Le,onClear:()=>{We?.(),X([]),Z(``)}}),st=Xe({data:W,value:Y}),ct=V&&Y.length>0&&!A&&!k;return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(o,{store:q,classNames:Q,styles:it,unstyled:m,size:h,readOnly:k,__staticSelector:`MultiSelect`,attributes:U,onOptionSubmit:e=>{C?.(e),qe&&Z(``),q.updateSelectedOptionIndex(`selected`),Y.includes(G[e].value)?(X(Y.filter(t=>t!==G[e].value)),Ue?.(G[e].value)):Y.length<I&&X([...Y,G[e].value])},...w,children:[(0,z.jsx)(o.DropdownTarget,{children:(0,z.jsx)(d,{...Qe,__staticSelector:`MultiSelect`,classNames:Q,styles:it,unstyled:m,size:h,className:l,style:f,variant:_,disabled:A,radius:M,__defaultRightSection:(0,z.jsx)(o.Chevron,{size:h,error:ke,unstyled:m,color:Ke}),__clearSection:ot,__clearable:ct,rightSection:fe,rightSectionPointerEvents:P||`none`,rightSectionWidth:pe,rightSectionProps:he,leftSection:F,leftSectionWidth:ge,leftSectionPointerEvents:_e,leftSectionProps:ve,inputContainer:ye,inputWrapperOrder:be,withAsterisk:xe,labelProps:Se,descriptionProps:Ce,errorProps:we,wrapperProps:Te,description:De,label:Oe,error:ke,withErrorStyles:Pe,__stylesApiProps:{...i,rightSectionPointerEvents:P||(ct?`all`:`none`),multiline:!0},pointer:!L,onClick:()=>L?q.openDropdown():q.toggleDropdown(),"data-expanded":q.dropdownOpened||void 0,id:Ye,required:Be,mod:Ve,attributes:U,children:(0,z.jsxs)(u.Group,{attributes:U,disabled:A,unstyled:m,...rt(`pillsList`),children:[$,(0,z.jsx)(o.EventsTarget,{autoComplete:$e,children:(0,z.jsx)(d.Field,{...et,ref:t,id:Ye,placeholder:H,type:!L&&!H?`hidden`:`visible`,...rt(`inputField`),unstyled:m,onFocus:e=>{de?.(e),L&&q.openDropdown()},onBlur:e=>{j?.(e),q.closeDropdown(),Z(``)},onKeyDown:at,value:tt,onChange:e=>{Z(e.currentTarget.value),L&&q.openDropdown(),S&&q.selectFirstOption()},disabled:A,readOnly:k||!L,pointer:!L})})]})})}),(0,z.jsx)(s,{data:Ne?st:W,hidden:k||A,filter:T,search:tt,limit:se,hiddenWhenEmpty:!Ae,withScrollArea:D,maxDropdownHeight:O,filterOptions:L,value:Y,checkIconPosition:Me,withCheckIcon:je,nothingFoundMessage:Ae,unstyled:m,labelId:Oe?`${Ye}-label`:void 0,"aria-label":Oe?void 0:Je[`aria-label`],renderOption:He,scrollAreaProps:Ge})]}),(0,z.jsx)(o.HiddenInput,{name:Fe,valuesDivider:ze,value:Y,form:Ie,disabled:A,...Re})]})});q.classes={...O.classes,...o.classes},q.displayName=`@mantine/core/MultiSelect`;var Qe=b(y());const J=[{value:T.JoinGame,challengeScoped:!1,i18nKey:`join_game`,color:`red`},{value:T.RankOverall,challengeScoped:!1,i18nKey:`rank_overall`,color:`pink`},{value:T.RequireReview,challengeScoped:!1,i18nKey:`require_review`,color:`grape`},{value:T.ViewChallenge,challengeScoped:!0,i18nKey:`view_challenge`,color:`indigo`},{value:T.SubmitFlags,challengeScoped:!0,i18nKey:`submit_flags`,color:`blue`},{value:T.GetScore,challengeScoped:!0,i18nKey:`get_score`,color:`green`},{value:T.GetBlood,challengeScoped:!0,i18nKey:`get_blood`,color:`yellow`},{value:T.AffectDynamicScore,challengeScoped:!0,i18nKey:`affect_dynamic_score`,color:`orange`}];J.filter(e=>e.challengeScoped);const $e=(e,t)=>`admin.content.games.divisions.permissions.${e}.${t}`,et=T.All,Y=e=>{let t=e??et;return t===T.All?J.map(e=>e.value):J.filter(e=>(t&e.value)===e.value).map(e=>e.value)},X=e=>{let t=Array.from(e);return t.length===J.length?T.All:t.reduce((e,t)=>e|t,0)};var tt={dot:`fe`};const nt=({value:t,onChange:n,disabled:r,challengeScoped:i,...a})=>{let{t:o}=j(),s=(0,R.useMemo)(()=>i?J.filter(e=>e.challengeScoped):J,[i]),c=(0,R.useMemo)(()=>{let e=new Set(s.map(e=>e.value));return Y(t).filter(t=>e.has(t)).map(e=>e.toString())},[t,s]),l=c.length>0,u=s.length>0&&c.length===s.length,d=e=>{n(X(e.map(e=>Number(e))))},p=e=>{if(!e){n(0);return}if(!i){n(T.All);return}n(X(s.map(e=>e.value)))};return(0,z.jsxs)(P,{gap:`sm`,...a,children:[(0,z.jsx)(F,{children:(0,z.jsx)(e,{disabled:r,label:o(`admin.content.games.divisions.permissions.all`),checked:u,indeterminate:!u&&l,onChange:e=>p(e.currentTarget.checked)})}),(0,z.jsx)(e.Group,{value:c,onChange:d,children:(0,z.jsx)(f,{spacing:`sm`,cols:{base:1,sm:2},children:s.map(t=>(0,z.jsx)(e,{value:t.value.toString(),label:o($e(t.i18nKey,`label`)),description:o($e(t.i18nKey,`description`)),disabled:r,color:t.color},t.value))})})]})},Z=({granted:e=!0,...t})=>{let{t:n}=j();return(0,z.jsx)(v,{label:n($e(t.i18nKey,`label`)),withArrow:!0,position:`top`,children:(0,z.jsx)(S,{component:`span`,className:tt.dot,"data-granted":e||void 0,style:{"--dot-color":`var(--mantine-color-${t.color}-6)`}})},t.value)},rt=({division:e,challengeTitleMap:t,onEdit:n,onDelete:r,onCopyInviteCode:i,...a})=>{let{t:o}=j(),s=(e.challengeConfigs??[]).toSorted((e,n)=>{let r=t.get(e.challengeId)??`#${e.challengeId}`,i=t.get(n.challengeId)??`#${n.challengeId}`;return r.localeCompare(i)}),c=(e,t=!1)=>{let n=new Set(Y(e));return(0,z.jsx)(F,{gap:6,wrap:`wrap`,children:J.filter(e=>t||e.challengeScoped).map(e=>{let t=n.has(e.value);return(0,z.jsx)(Z,{...e,granted:t},e.value)})})};return(0,z.jsx)(l,{withBorder:!0,shadow:`sm`,radius:`md`,padding:`md`,...a,children:(0,z.jsxs)(P,{gap:`xs`,children:[(0,z.jsxs)(F,{justify:`space-between`,align:`flex-start`,children:[(0,z.jsxs)(F,{gap:`sm`,children:[(0,z.jsx)(Qe.Icon,{path:_e,size:.8}),(0,z.jsx)(x,{order:4,lineClamp:1,children:e.name})]}),(0,z.jsxs)(F,{gap:`sm`,wrap:`nowrap`,children:[(0,z.jsx)(de,{variant:`transparent`,color:`blue`,onClick:()=>n(e),children:(0,z.jsx)(Qe.Icon,{path:ce,size:1})}),(0,z.jsx)(Me,{iconPath:ke,color:`red`,message:o(`admin.content.games.divisions.delete_confirm`,{name:e.name}),onClick:()=>r(e)})]})]}),e.inviteCode&&(0,z.jsxs)(F,{gap:`sm`,align:`center`,wrap:`wrap`,children:[(0,z.jsx)(_,{size:`sm`,children:o(`admin.content.games.divisions.form.invite_code.label`)}),(0,z.jsx)(_,{ff:`monospace`,fw:`bold`,fz:`sm`,children:e.inviteCode}),(0,z.jsx)(v,{label:o(`common.button.copy`),withArrow:!0,children:(0,z.jsx)(de,{size:`sm`,variant:`transparent`,onClick:()=>i(e.inviteCode??``),children:(0,z.jsx)(Qe.Icon,{path:`M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z`,size:.6})})})]}),(0,z.jsxs)(F,{gap:`sm`,align:`center`,children:[(0,z.jsx)(_,{size:`sm`,children:o(`admin.content.games.divisions.default_permission_label`)}),c(e.defaultPermissions,!0)]}),s.length>0&&(0,z.jsxs)(P,{gap:`xs`,children:[(0,z.jsx)(_,{size:`sm`,children:o(`admin.content.games.divisions.override_label`)}),(0,z.jsx)(P,{gap:`xs`,children:s.map(e=>(0,z.jsxs)(F,{align:`center`,children:[(0,z.jsx)(_,{size:`sm`,miw:`2rem`,children:`#${e.challengeId}`}),(0,z.jsx)(Ne,{text:t.get(e.challengeId)??``,w:`14rem`}),c(e.permissions)]},e.challengeId))})]})]})})};var Q=b(y());const it=({gameId:e,division:t,challenges:n,onDivisionSaved:r,...i})=>{let{t:a}=j(),{opened:o,onClose:s,title:c,size:l,position:u,closeOnClickOutside:d,overlayProps:f,...ee}=i,h={blur:3,backgroundOpacity:.55,...f??{}},[te,ne]=(0,R.useState)(``),[re,v]=(0,R.useState)(``),[y,b]=(0,R.useState)(T.All),[x,ae]=(0,R.useState)([]),[oe,S]=(0,R.useState)({}),[E,se]=(0,R.useState)(!1),O=(0,R.useMemo)(()=>{let e=new Map;return n?.forEach(t=>{t.id!==void 0&&t.id!==null&&e.set(t.id,t)}),e},[n]),ce=(0,R.useMemo)(()=>{let e=(n??[]).filter(e=>e.id!==void 0&&e.id!==null).map(e=>({value:e.id.toString(),label:e.title??`${a(`common.label.challenge`)} #${e.id}`}));return x.forEach(t=>{e.find(e=>e.value===t)||e.push({value:t,label:a(`admin.content.games.divisions.unknown_challenge`,{id:Number(t)})})}),e.sort((e,t)=>e.label.localeCompare(t.label))},[n,x,a]),le=(0,R.useMemo)(()=>[...x].sort((e,t)=>{let n=O.get(Number(e))?.title??`#${e}`,r=O.get(Number(t))?.title??`#${t}`;return n.localeCompare(r)}),[O,x]),k=()=>{ne(t?.name??``),v(t?.inviteCode??``),b(t?.defaultPermissions??T.All);let e=t?.challengeConfigs??[],n={};ae(e.map(e=>(n[e.challengeId]=e.permissions??T.All,e.challengeId.toString()))),S(n)};(0,R.useEffect)(()=>{o&&(k(),se(!1))},[t,o]);let A=e=>{ae(e),S(t=>{let n={...t};return Object.keys(n).forEach(t=>{e.includes(t)||delete n[Number(t)]}),e.forEach(e=>{let t=Number(e);t in n||(n[t]=y)}),n})},M=(e,t)=>{S(n=>({...n,[e]:t}))},fe=e=>O.get(e)?.title??a(`admin.content.games.divisions.unknown_challenge`,{id:e}),pe=e=>({name:e,inviteCode:re.trim()?re.trim():null,defaultPermissions:y,challengeConfigs:x.map(e=>{let t=Number(e);return{challengeId:t,permissions:oe[t]??y}})}),N=async()=>{let n=te.trim();if(!n){g({color:`red`,message:a(`common.error.empty`),icon:(0,z.jsx)(Q.Icon,{path:Se,size:1})});return}se(!0);let i=pe(n);try{if(t){let n=await ie.edit.editUpdateDivision(e,t.id,i);g({color:`teal`,message:a(`admin.notification.games.divisions.updated`),icon:(0,z.jsx)(Q.Icon,{path:w,size:1})}),r({...n.data,challengeConfigs:n.data.challengeConfigs??[]})}else{let t=await ie.edit.editCreateDivision(e,i);g({color:`teal`,message:a(`admin.notification.games.divisions.created`),icon:(0,z.jsx)(Q.Icon,{path:w,size:1})}),r({...t.data,challengeConfigs:t.data.challengeConfigs??[]})}s?.()}catch(e){ue(e,a)}finally{se(!1)}},me=(e,t=!1)=>{let n=new Set(Y(e));return(0,z.jsx)(F,{gap:6,wrap:`wrap`,children:J.filter(e=>t||e.challengeScoped).map(e=>(0,z.jsx)(Z,{...e,granted:n.has(e.value)},e.value))})};return(0,z.jsx)(K,{...ee,opened:o,title:c,size:l??`xl`,position:u??`right`,closeOnClickOutside:d??!E,onClose:()=>!E&&s?.(),overlayProps:h,children:(0,z.jsxs)(P,{gap:`sm`,children:[(0,z.jsxs)(F,{gap:`sm`,grow:!0,children:[(0,z.jsx)(p,{label:a(`admin.content.games.divisions.form.name.label`),description:a(`admin.content.games.divisions.form.name.description`),placeholder:a(`admin.placeholder.games.divisions`),withAsterisk:!0,disabled:E,value:te,onChange:e=>ne(e.currentTarget.value)}),(0,z.jsx)(p,{label:a(`admin.content.games.divisions.form.invite_code.label`),description:a(`admin.content.games.divisions.form.invite_code.description`),placeholder:a(`admin.content.games.info.invite_code.placeholder`),value:re,disabled:E,onChange:e=>v(e.currentTarget.value),rightSection:(0,z.jsx)(de,{disabled:E,onClick:()=>!E&&v(L()),children:(0,z.jsx)(Q.Icon,{path:ye,size:.9})})})]}),(0,z.jsx)(m.Wrapper,{label:a(`admin.content.games.divisions.form.default_permissions.label`),description:a(`admin.content.games.divisions.form.default_permissions.description`),children:(0,z.jsx)(nt,{pt:`md`,value:y,onChange:b,disabled:E})}),(0,z.jsx)(q,{label:a(`admin.content.games.divisions.form.challenge_overrides.label`),description:a(`admin.content.games.divisions.form.challenge_overrides.description`),data:ce,value:x,onChange:A,searchable:!0,disabled:E||!n,nothingFoundMessage:a(`admin.content.nothing_found`),placeholder:a(`admin.content.games.divisions.form.challenge_overrides.placeholder`)}),le.length>0&&(0,z.jsx)(je,{type:`auto`,offsetScrollbars:!0,h:300,children:(0,z.jsx)(D,{chevronPosition:`left`,variant:`filled`,radius:`md`,children:le.map(e=>{let t=Number(e);return(0,z.jsxs)(D.Item,{value:e,children:[(0,z.jsx)(D.Control,{children:(0,z.jsxs)(F,{justify:`space-between`,wrap:`nowrap`,children:[(0,z.jsxs)(F,{gap:`xs`,children:[(0,z.jsx)(_,{size:`sm`,miw:`2rem`,children:`#${t}`}),(0,z.jsx)(Ne,{text:fe(t),w:`12rem`}),me(oe[t])]}),(0,z.jsx)(C,{variant:`subtle`,size:`xs`,color:`red`,disabled:E,leftSection:(0,z.jsx)(Q.Icon,{path:`M17,13H7V11H17M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z`,size:.8}),onClick:t=>{t.stopPropagation(),A(x.filter(t=>t!==e))},children:a(`common.modal.delete`)})]})}),(0,z.jsx)(D.Panel,{children:(0,z.jsx)(nt,{challengeScoped:!0,value:oe[t]??y,onChange:e=>M(t,e),disabled:E})})]},e)})})}),(0,z.jsxs)(F,{justify:`flex-end`,children:[(0,z.jsx)(C,{variant:`default`,disabled:E,onClick:s,children:a(`common.modal.cancel`)}),(0,z.jsx)(C,{onClick:N,loading:E,children:a(t?`common.modal.confirm_update`:`common.modal.confirm`)})]})]})})};var at={masonryContainer:`L_`,masonryItem:`M_`},$=b(y(),1),ot=()=>{let{id:e}=A(),n=parseInt(e??`-1`,10),{t:r}=j(),i=Te(),a=t({timeout:1500}),{divisions:o,mutate:s}=c(n),{challenges:l}=Fe(n),[u,d]=(0,R.useState)(!1),[f,p]=(0,R.useState)(null);(0,R.useEffect)(()=>{(Number.isNaN(n)||n<0)&&(g({color:`red`,message:r(`common.error.param_error`),icon:(0,z.jsx)($.Icon,{path:Se,size:1})}),i(`/admin/games`))},[i,n,r]);let m=(0,R.useMemo)(()=>{let e=new Map;return l?.forEach(t=>{t.id&&e.set(t.id,t.title)}),e},[l,r]),h=(0,R.useMemo)(()=>o?o.toSorted((e,t)=>e.name.localeCompare(t.name)):[],[o]),te=e=>{if(e)try{a.copy(e),g({color:`teal`,message:r(`admin.notification.games.divisions.invite_copied`),icon:(0,z.jsx)($.Icon,{path:w,size:1})})}catch{g({color:`red`,message:r(`common.error.try_later`),icon:(0,z.jsx)($.Icon,{path:Se,size:1})})}},ne=e=>{let t=o??[];s(t.findIndex(t=>t.id===e.id)===-1?[...t,e]:t.map(t=>t.id===e.id?e:t),!1),p(null)},re=async e=>{try{await ie.edit.editDeleteDivision(n,e.id),g({color:`teal`,message:r(`admin.notification.games.divisions.deleted`),icon:(0,z.jsx)($.Icon,{path:w,size:1})}),s((o??[]).filter(t=>t.id!==e.id),!1)}catch(e){ue(e,r)}};return(0,z.jsxs)(Pe,{isLoading:o===void 0||l===null,contentPos:`flex-end`,head:(0,z.jsx)(C,{mr:`18px`,leftSection:(0,z.jsx)($.Icon,{path:Oe,size:1}),onClick:()=>{p(null),d(!0)},children:r(`admin.button.divisions.new`)}),children:[(0,z.jsx)(je,{h:`calc(100vh - 180px)`,offsetScrollbars:!0,type:`auto`,children:h.length===0?(0,z.jsx)(ee,{h:`calc(100vh - 200px)`,children:(0,z.jsxs)(P,{gap:0,children:[(0,z.jsx)(x,{order:2,children:r(`admin.content.games.divisions.empty.title`)}),(0,z.jsx)(_,{children:r(`admin.content.games.divisions.empty.description`)})]})}):(0,z.jsx)(S,{className:at.masonryContainer,children:h.map(e=>(0,z.jsx)(rt,{division:e,challengeTitleMap:m,onEdit:e=>{p(e),d(!0)},onDelete:re,onCopyInviteCode:te,className:at.masonryItem},e.id))})}),(0,z.jsx)(it,{title:r(f?`admin.button.divisions.edit`:`admin.button.divisions.new`),opened:u,onClose:()=>{d(!1),p(null)},gameId:n,division:f,challenges:l,onDivisionSaved:ne})]})};export{ot as default};