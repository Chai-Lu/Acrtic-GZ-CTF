/* The GZ::CTF Project @unknown
 * 
 * License   : GNU Affero General Public License v3.0 (Core)
 * License   : LicenseRef-GZCTF-Restricted (Restricted components)
 * Commit    : Unofficial build version
 * Build     : 2025-12-08T11:45:34.456Z
 * Copyright (C) 2022-2025 GZTimeWalker. All Rights Reserved.
 */
import"./lcut4z52.js";import"./cbxtepre.js";import"./isy1dskq.js";import{t as e}from"./ltc052rv.js";import{t}from"./cdbutviq.js";import"./kocdnk2i.js";import{t as n}from"./nu4jnu0f.js";import{s as ee}from"./gaobt2im.js";import"./j0saofxo.js";import{t as r}from"./kpl3u1sg.js";import{s as i,t as a}from"./nugqs812.js";import{t as o}from"./bfzgeflf.js";import{t as s}from"./o417b45d.js";import{t as c}from"./h0nb8b87.js";import{t as l}from"./mi2mv45h.js";import{$r as te,Ar as u,Br as d,Ca as f,Cr as p,Dr as m,In as h,Jr as g,K as _,Lr as v,O as y,Oa as b,S as x,Sr as S,Tr as C,Vr as w,W as T,X as ne,_ as E,b as D,cr as re,di as ie,dr as ae,er as O,ha as k,it as A,jr as j,li as M,nt as oe,p as N,q as P,sr as se,tt as ce,wr as F,y as I}from"./index.hrqptwjo.js";import"./iwhjrhtg.js";import"./mdazlrzp.js";import"./mbfygvvk.js";import{t as L}from"./je83xcx9.js";import{t as R}from"./bok6ip78.js";import{t as z}from"./lvtgxs0o.js";var B=b(y(),1),V=b(m(),1),H=b(O(),1),U=b(f(),1),W=b(k(),1);V.default.extend(H.default);var G=()=>{let{id:f}=re(),m=parseInt(f??`-1`),{game:y,mutate:b}=ee(m),[O,k]=(0,U.useState)(),H=se(),[G,K]=(0,U.useState)(!1),[q,J]=n((0,V.default)()),[Y,X]=n((0,V.default)()),[Z,Q]=n(3),le=C(),ue=t(),{t:$}=ae();(0,U.useEffect)(()=>{if(m<0){p({color:`red`,message:$(`common.error.param_error`),icon:(0,W.jsx)(B.Icon,{path:P,size:1})}),H(`/admin/games`);return}if(y){k(y),J((0,V.default)(y.start)),X((0,V.default)(y.end));let e=(0,V.default)(y.writeupDeadline).diff(y.end,`h`);Q(e<0?0:e)}},[f,y]);let de=async e=>{if(!(!O||!e)){K(!0),S.clean(),p({id:`upload-poster`,color:`orange`,message:$(`admin.notification.games.info.poster.uploading`),loading:!0,autoClose:!1});try{let t=await h.edit.editUpdateGamePoster(O.id,{file:e});F({id:`upload-poster`,color:`teal`,message:$(`admin.notification.games.info.poster.uploaded`),icon:(0,W.jsx)(B.Icon,{path:T,size:1}),autoClose:!0,loading:!1}),b({...O,poster:t.data})}catch(e){F({id:`upload-poster`,color:`red`,title:$(`admin.notification.games.info.poster.upload_failed`),message:x(e,$),icon:(0,W.jsx)(B.Icon,{path:P,size:1}),autoClose:!0,loading:!1})}finally{K(!1)}}},fe=async()=>{if(O?.title){K(!0);try{await h.edit.editUpdateGame(O.id,{...O,inviteCode:O.inviteCode?.length??!1?O.inviteCode:null,start:q.valueOf(),end:Y.valueOf(),writeupDeadline:Y.add(Z,`h`).valueOf()}),p({color:`teal`,message:$(`admin.notification.games.info.info_updated`),icon:(0,W.jsx)(B.Icon,{path:T,size:1})}),b(),h.game.mutateGameGames()}catch(e){D(e,$)}finally{K(!1)}}},pe=async()=>{if(O)try{await h.edit.editDeleteGame(O.id),p({color:`teal`,message:$(`admin.notification.games.info.deleted`),icon:(0,W.jsx)(B.Icon,{path:T,size:1})}),H(`/admin/games`)}catch(e){D(e,$)}};return(0,W.jsxs)(z,{headProps:{justify:`apart`},contentPos:`right`,isLoading:!O,head:(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(w,{disabled:G,color:`red`,leftSection:(0,W.jsx)(B.Icon,{path:ce,size:1}),variant:`outline`,onClick:()=>le.openConfirmModal({title:$(`admin.button.games.delete`),children:(0,W.jsx)(g,{size:`sm`,children:$(`admin.content.games.info.delete`,{name:O?.title})}),onConfirm:()=>pe(),confirmProps:{color:`red`}}),children:$(`admin.button.games.delete`)}),(0,W.jsx)(w,{leftSection:(0,W.jsx)(B.Icon,{path:A,size:1}),disabled:G,onClick:async()=>{O?.id&&await L(h.edit.editExportGame(O.id,{format:`blob`}),K,$)},variant:`outline`,children:$(`admin.button.games.export`)}),(0,W.jsx)(w,{leftSection:(0,W.jsx)(B.Icon,{path:_,size:1}),disabled:G,onClick:()=>{ue.copy(O?.publicKey||``),p({color:`teal`,message:$(`admin.notification.games.info.public_key_copied`),icon:(0,W.jsx)(B.Icon,{path:T,size:1})})},children:$(`admin.button.games.copy_public_key`)}),(0,W.jsx)(w,{leftSection:(0,W.jsx)(B.Icon,{path:ne,size:1}),disabled:G,onClick:fe,children:$(`admin.button.save`)})]}),children:[(0,W.jsxs)(s,{cols:4,children:[(0,W.jsx)(c,{label:$(`admin.content.games.info.title.label`),description:$(`admin.content.games.info.title.description`),disabled:G,value:O?.title,required:!0,onChange:e=>O&&k({...O,title:e.target.value})}),(0,W.jsx)(o,{label:$(`admin.content.games.info.member_limit.label`),description:$(`admin.content.games.info.member_limit.description`),disabled:G,min:0,required:!0,value:O?.teamMemberCountLimit,onChange:e=>{let t=E(e);!O||isNaN(t)||k({...O,teamMemberCountLimit:t})}}),(0,W.jsx)(o,{label:$(`admin.content.games.info.container_limit.label`),description:$(`admin.content.games.info.container_limit.description`),disabled:G,min:0,required:!0,value:O?.containerCountLimit,onChange:e=>{let t=E(e);!O||isNaN(t)||k({...O,containerCountLimit:t})}}),(0,W.jsx)(c,{label:$(`admin.content.games.info.invite_code.label`),description:$(`admin.content.games.info.invite_code.description`),placeholder:$(`admin.content.games.info.invite_code.placeholder`),value:O?.inviteCode||``,disabled:G,onChange:e=>O&&k({...O,inviteCode:e.target.value}),rightSection:(0,W.jsx)(ie,{disabled:G,onClick:()=>O&&k({...O,inviteCode:I()}),children:(0,W.jsx)(B.Icon,{path:oe,size:.9})})}),(0,W.jsx)(l,{label:$(`admin.content.games.info.start_time`),size:`sm`,value:q.toDate(),valueFormat:`L LT`,disabled:G,clearable:!1,onChange:e=>{let t=(0,V.default)(e);J(t),t&&Y<t&&X(t.add(2,`h`))},required:!0}),(0,W.jsx)(l,{label:$(`admin.content.games.info.end_time`),size:`sm`,disabled:G,minDate:q.toDate(),value:Y.toDate(),valueFormat:`L LT`,clearable:!1,onChange:e=>{X((0,V.default)(e))},error:Y<q,required:!0}),(0,W.jsx)(u,{disabled:G,checked:O?.acceptWithoutReview??!1,classNames:{root:a.switchVerticalMiddle},label:R($(`admin.content.games.info.accept_without_review.label`),$(`admin.content.games.info.accept_without_review.description`)),onChange:e=>O&&k({...O,acceptWithoutReview:e.target.checked})}),(0,W.jsx)(u,{disabled:G,checked:O?.practiceMode??!0,classNames:{root:a.switchVerticalMiddle},label:R($(`admin.content.games.info.practice_mode.label`),$(`admin.content.games.info.practice_mode.description`)),onChange:e=>O&&k({...O,practiceMode:e.target.checked})})]}),(0,W.jsxs)(M,{grow:!0,justify:`space-between`,children:[(0,W.jsx)(v,{label:$(`admin.content.games.info.summary.label`),description:$(`admin.content.games.info.summary.description`),value:O?.summary,w:`100%`,autosize:!0,disabled:G,minRows:8,maxRows:8,onChange:e=>O&&k({...O,summary:e.target.value})}),(0,W.jsxs)(j,{gap:`0.488125rem`,children:[(0,W.jsxs)(M,{grow:!0,justify:`space-between`,children:[(0,W.jsx)(u,{disabled:G,checked:O?.writeupRequired??!1,classNames:{root:a.switchVerticalMiddle},label:R($(`admin.content.games.info.writeup_required.label`),$(`admin.content.games.info.writeup_required.description`)),onChange:e=>O&&k({...O,writeupRequired:e.target.checked})}),(0,W.jsx)(o,{label:$(`admin.content.games.info.writeup_deadline.label`),description:$(`admin.content.games.info.writeup_deadline.description`),disabled:G,min:0,required:!0,value:Z,onChange:e=>Q(E(e))})]}),(0,W.jsx)(v,{label:$(`admin.content.games.info.writeup_instruction`),description:$(`admin.content.markdown_support`),value:O?.writeupNote,w:`100%`,autosize:!0,disabled:G,minRows:4,maxRows:4,onChange:e=>O&&k({...O,writeupNote:e.target.value})})]})]}),(0,W.jsxs)(r,{grow:!0,children:[(0,W.jsx)(r.Col,{span:8,children:(0,W.jsx)(v,{label:(0,W.jsxs)(M,{gap:`sm`,children:[(0,W.jsx)(g,{size:`sm`,children:$(`admin.content.games.info.content`)}),(0,W.jsx)(g,{size:`xs`,c:`dimmed`,children:$(`admin.content.markdown_support`)})]}),value:O?.content,w:`100%`,autosize:!0,disabled:G,minRows:10,maxRows:10,onChange:e=>O&&k({...O,content:e.target.value})})}),(0,W.jsx)(r.Col,{span:4,children:(0,W.jsx)(te.Wrapper,{label:$(`admin.content.games.info.poster`),children:(0,W.jsx)(e,{onDrop:e=>de(e[0]),onReject:()=>{p({color:`red`,title:$(`common.error.file_invalid.title`),message:$(`common.error.file_invalid.message`),icon:(0,W.jsx)(B.Icon,{path:P,size:1})})},maxSize:3*1024*1024,accept:N,disabled:G,"data-poster":O?.poster||void 0,classNames:{root:a.gamePoster},children:(0,W.jsx)(d,{className:a.noPointerEvents,children:O?.poster?(0,W.jsx)(i,{height:`231px`,fit:`contain`,src:O.poster,alt:`poster`}):(0,W.jsx)(d,{h:`231px`,children:(0,W.jsxs)(j,{gap:0,children:[(0,W.jsx)(g,{size:`xl`,inline:!0,children:$(`common.content.drop_zone.content`,{type:$(`common.content.drop_zone.type.poster`)})}),(0,W.jsx)(g,{size:`sm`,c:`dimmed`,inline:!0,mt:7,children:$(`common.content.drop_zone.limit`)})]})})})})})})]})]})};export{G as default};