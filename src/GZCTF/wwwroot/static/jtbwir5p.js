/* The GZ::CTF Project @unknown
 * 
 * License   : GNU Affero General Public License v3.0 (Core)
 * License   : LicenseRef-GZCTF-Restricted (Restricted components)
 * Commit    : Unofficial build version
 * Build     : 2025-12-08T11:45:34.456Z
 * Copyright (C) 2022-2025 GZTimeWalker. All Rights Reserved.
 */
import{i as e}from"./lcut4z52.js";import"./isy1dskq.js";import"./kocdnk2i.js";import"./gaobt2im.js";import"./j0saofxo.js";import{t}from"./nugqs812.js";import{t as n}from"./gmgm1gqp.js";import"./h0nb8b87.js";import{$i as r,$n as i,$r as a,Ar as o,Br as s,Ca as c,Cr as l,Dr as u,E as d,Hr as f,In as p,Jn as m,Jr as h,Li as g,O as _,Oa as v,Or as y,Ti as b,Ur as x,W as S,Yr as C,_i as w,b as T,cr as E,dr as D,ha as O,hn as k,jn as A,jr as j,kn as M,kt as N,li as P,yi as F}from"./index.hrqptwjo.js";import{t as I}from"./iwhjrhtg.js";import"./cjpezv9m.js";import"./mdazlrzp.js";import"./je83xcx9.js";import{t as L}from"./bok6ip78.js";import{n as R,t as z}from"./yb0kdwg6.js";import"./fmw116au.js";import"./laaps3um.js";import"./odnwo8oc.js";import{t as B}from"./drtvoui5.js";var V=v(_(),1),H=v(u(),1),U=v(c(),1),W=v(O(),1),G=function(e){return e.Submit=`Submit`,e.Owned=`Owned`,e}(G||{}),K=new Map([[G.Submit,{color:`orange`,iconPath:k}],[G.Owned,{color:`red`,iconPath:N}]]),q=e=>{let t=new Map;for(let n of e){let{ownedTeam:e,submitTeam:r,submission:i}=n;if(!e||!r||!i)continue;let a=(0,H.default)(i.time);for(let n of[e,r])t.has(n.id??-1)||t.set(n.id??-1,{name:n.team?.name,avatar:n.team?.avatar,teamId:n.team?.id,status:n.status,participateId:n.id,divisionId:n.divisionId,division:n.division,lastSubmitTime:a,submissionInfo:new Set});let o=t.get(e.id??-1),s=t.get(r.id??-1);if(!o||!s)continue;o.lastSubmitTime?.isBefore(a)&&(o.lastSubmitTime=a);let c={time:a,answer:i.answer,user:i.user,challenge:i.challenge,cheatType:G.Owned,relatedTeam:r.team?.name};o.submissionInfo.add(c),s.lastSubmitTime?.isBefore(a)&&(s.lastSubmitTime=a);let l={...c,cheatType:G.Submit,relatedTeam:e.team?.name};s.submissionInfo.add(l)}return t},J=e=>{let{submissionInfo:t}=e,n=g(),r=K.get(t.cheatType),{classes:o}=M({ff:`monospace`}),{locale:s}=i();return(0,W.jsxs)(P,{justify:`space-between`,w:`100%`,gap:0,children:[(0,W.jsxs)(P,{justify:`space-between`,w:`60%`,pr:`2rem`,children:[(0,W.jsxs)(P,{justify:`left`,children:[(0,W.jsx)(V.Icon,{path:r.iconPath,size:1,color:n.colors[r.color][6]}),(0,W.jsx)(f,{size:`sm`,color:`indigo`,children:(0,H.default)(t.time).locale(s).format(`SL HH:mm:ss`)}),(0,W.jsx)(h,{lineClamp:1,fw:`bold`,children:t.relatedTeam})]}),(0,W.jsx)(h,{size:`sm`,lineClamp:1,fw:`bold`,children:t.user})]}),(0,W.jsxs)(j,{gap:0,w:`40%`,children:[(0,W.jsx)(h,{fw:`bold`,size:`xs`,lineClamp:1,children:t.challenge}),(0,W.jsx)(a,{variant:`unstyled`,value:t.answer,readOnly:!0,size:`xs`,classNames:o})]})]})},Y=e=>{let{cheatTeamInfo:n,disabled:r,userRole:a,setParticipation:o}=e,s=g(),c=d().get(n.status),{t:l}=D(),{locale:u}=i();return(0,W.jsxs)(C.Item,{value:n.participateId.toString(),children:[(0,W.jsx)(b,{display:`flex`,className:t.alignCenter,children:(0,W.jsx)(C.Control,{children:(0,W.jsxs)(P,{justify:`space-between`,children:[(0,W.jsxs)(P,{justify:`left`,children:[(0,W.jsx)(x,{alt:`avatar`,src:n.avatar,children:n.name?n.name.slice(0,1):`T`}),(0,W.jsxs)(j,{gap:0,children:[(0,W.jsxs)(P,{gap:4,children:[(0,W.jsx)(y,{order:4,lineClamp:1,fw:`bold`,children:n.name?n.name:l(`admin.placeholder.games.participation.team`)}),n?.division&&(0,W.jsx)(f,{size:`sm`,variant:`outline`,children:n.division})]}),(0,W.jsx)(h,{size:`sm`,lineClamp:1,children:(0,H.default)(n.lastSubmitTime).locale(u).format(`SL LTS`)})]})]}),(0,W.jsxs)(P,{w:`12rem`,gap:0,justify:`space-between`,wrap:`nowrap`,children:[(0,W.jsx)(b,{w:`6rem`,ta:`center`,children:(0,W.jsx)(f,{color:c.color,children:c.title})}),I(m.Admin,a)&&(0,W.jsx)(R,{disabled:r,participation:{id:n.participateId,divisionId:n.divisionId,status:n.status},setParticipation:o,m:`0 ${s.spacing.xl}`,miw:s.spacing.xl})]})]})})}),(0,W.jsx)(C.Panel,{children:(0,W.jsx)(j,{gap:`sm`,children:[...n.submissionInfo].sort((e,t)=>(t.time?.unix()??0)-(e.time?.unix()??0)).map(e=>(0,W.jsx)(J,{submissionInfo:e},e.time?.unix()))})})]})},X=t=>{let{role:n}=e(),{cheatTeamInfo:r,disabled:i,setParticipation:a}=t,{t:o}=D();return(0,W.jsx)(F,{offsetScrollbars:!0,h:`calc(100vh - 180px)`,children:(0,W.jsx)(j,{gap:`xs`,w:`100%`,children:!r||r?.size===0?(0,W.jsx)(s,{h:`calc(100vh - 200px)`,children:(0,W.jsxs)(j,{gap:0,children:[(0,W.jsx)(y,{order:2,children:o(`game.content.no_cheat.title`)}),(0,W.jsx)(h,{children:o(`game.content.no_cheat.comment`)})]})}):(0,W.jsx)(C,{multiple:!0,variant:`contained`,chevronPosition:`left`,classNames:z,className:z.root,children:[...r.values()].sort((e,t)=>(t.lastSubmitTime?.unix()??0)-(e.lastSubmitTime?.unix()??0)).map(e=>(0,W.jsx)(Y,{userRole:n??m.User,cheatTeamInfo:e,disabled:i,setParticipation:a},e.participateId))})})})},Z=e=>{let{classes:t}=M({ff:`monospace`}),{t:r}=D(),{locale:o}=i(),s=e.cheatInfo.sort((e,t)=>((0,H.default)(t.submission?.time).unix()??0)-((0,H.default)(e.submission?.time).unix()??0)).map((e,r)=>(0,W.jsxs)(n.Tr,{children:[(0,W.jsx)(n.Td,{ff:`monospace`,children:(0,W.jsx)(f,{size:`sm`,color:`indigo`,children:(0,H.default)(e.submission?.time).locale(o).format(`SL HH:mm:ss`)})}),(0,W.jsx)(n.Td,{children:(0,W.jsx)(h,{size:`sm`,fw:`bold`,children:e.ownedTeam?.team?.name??`Team`})}),(0,W.jsx)(n.Td,{children:(0,W.jsx)(f,{size:`sm`,color:`orange`,children:`>>>`})}),(0,W.jsx)(n.Td,{children:(0,W.jsx)(h,{size:`sm`,fw:`bold`,children:e.submitTeam?.team?.name??`Team`})}),(0,W.jsx)(n.Td,{children:(0,W.jsx)(h,{ff:`monospace`,size:`sm`,fw:`bold`,children:e.submission?.user??`User`})}),(0,W.jsx)(n.Td,{children:e.submission?.challenge??`Challenge`}),(0,W.jsx)(n.Td,{p:`0`,w:`24vw`,children:(0,W.jsx)(a,{variant:`unstyled`,value:e.submission?.answer,readOnly:!0,size:`sm`,classNames:t})})]},`${e.submission?.time}@${r}`));return(0,W.jsx)(w,{shadow:`md`,p:`md`,children:(0,W.jsx)(F,{offsetScrollbars:!0,h:`calc(100vh - 200px)`,children:(0,W.jsxs)(n,{className:z.table,children:[(0,W.jsx)(n.Thead,{children:(0,W.jsxs)(n.Tr,{children:[(0,W.jsx)(n.Th,{w:`8rem`,children:r(`common.label.time`)}),(0,W.jsx)(n.Th,{miw:`5rem`,children:r(`game.label.cheat_info.owned_team`)}),(0,W.jsx)(n.Th,{}),(0,W.jsx)(n.Th,{miw:`5rem`,children:r(`game.label.cheat_info.submit_team`)}),(0,W.jsx)(n.Th,{miw:`5rem`,children:r(`game.label.cheat_info.submit_user`)}),(0,W.jsx)(n.Th,{miw:`3rem`,children:r(`common.label.challenge`)}),(0,W.jsx)(n.Th,{className:z.mono,children:r(`common.label.flag`)})]})}),(0,W.jsx)(n.Tbody,{children:s})]})})})},Q=()=>{let{id:e}=E(),t=parseInt(e??`-1`),{data:n}=p.game.useGameCheatInfo(t,A),[i,a]=(0,U.useState)(!1),[s,c]=(0,U.useState)(),[u,d]=r({key:`cheat-info-team-view`,defaultValue:!0,getInitialValueInEffect:!1}),{t:f}=D();return(0,U.useEffect)(()=>{n&&c(q(n))},[n]),(0,W.jsxs)(B,{isLoading:!n,children:[(0,W.jsx)(P,{justify:`space-between`,w:`100%`,children:(0,W.jsx)(o,{label:L(f(`game.content.team_view.label`),f(`game.content.team_view.description`)),checked:u,onChange:e=>d(e.currentTarget.checked)})}),u?(0,W.jsx)(X,{disabled:i,cheatTeamInfo:s??new Map,setParticipation:async(e,t)=>{a(!0);try{await p.admin.adminParticipation(e,t);let n=s?.get(e);s&&n&&c(s.set(e,{...n,status:t.status??n.status})),l({color:`teal`,message:f(`admin.notification.games.participation.updated`),icon:(0,W.jsx)(V.Icon,{path:S,size:1})})}catch(e){T(e,f)}finally{a(!1)}}}):(0,W.jsx)(Z,{cheatInfo:n??[]})]})};export{Q as default};