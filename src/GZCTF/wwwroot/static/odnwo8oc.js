/* The GZ::CTF Project @unknown
 * 
 * License   : GNU Affero General Public License v3.0 (Core)
 * License   : LicenseRef-GZCTF-Restricted (Restricted components)
 * Commit    : Unofficial build version
 * Build     : 2025-12-08T11:45:34.456Z
 * Copyright (C) 2022-2025 GZTimeWalker. All Rights Reserved.
 */
import{i as e}from"./lcut4z52.js";import{s as t}from"./isy1dskq.js";import{t as n}from"./kocdnk2i.js";import{c as r,i}from"./gaobt2im.js";import{t as a}from"./j0saofxo.js";import{t as o}from"./nugqs812.js";import{Ca as s,Cr as c,Dr as l,Jn as u,Jr as d,Kn as f,O as p,Oa as m,Or as h,U as g,Ut as _,cr as v,ct as y,dr as b,ha as x,jr as S,or as C,sr as w,u as T,vt as E}from"./index.hrqptwjo.js";import{t as D}from"./iwhjrhtg.js";import{t as O}from"./mdazlrzp.js";import{t as k}from"./fmw116au.js";import{t as A}from"./laaps3um.js";var j=m(p()),M=m(l()),N=m(k()),P=m(s()),F=m(x());M.default.extend(N.default);var I=({game:e})=>{let{endTime:t,progress:n}=i(e),[r,s]=(0,P.useState)((0,M.default)()),{t:c}=b();(0,P.useEffect)(()=>{if(!e||(0,M.default)()>(0,M.default)(e.end))return;let t=setInterval(()=>s((0,M.default)()),1e3);return()=>clearInterval(t)},[e]);let l=M.default.duration(t.diff(r));return(0,F.jsxs)(a,{miw:`9rem`,ta:`center`,pt:4,className:o.overflowVisible,children:[(0,F.jsx)(d,{fw:`bold`,lineClamp:1,children:l.asHours()>999?c(`game.content.game_lasts_long`):l.asSeconds()>0?`${Math.floor(l.asHours())} : ${l.format(`mm : ss`)}`:c(`game.content.game_ended`)}),(0,F.jsx)(a.Section,{mt:4,children:(0,F.jsx)(A,{percentage:n,py:0})})]})};const L=({children:i})=>{let{id:a}=v(),o=parseInt(a??`-1`),s=C(),l=w(),{role:d}=e(),{game:p,status:m}=r(o),{t:x}=b(),k=(0,M.default)()>(0,M.default)(p?.end??new Date),A=[{icon:E,title:x(`game.tab.challenge`),path:`challenges`,link:`challenges`,requireJoin:!0,requireRole:u.User},{icon:g,title:x(`game.tab.scoreboard`),path:`scoreboard`,link:`scoreboard`,requireJoin:!1,requireRole:u.User},{icon:_,title:x(`game.tab.monitor.index`),path:`monitor`,link:`monitor/events`,requireJoin:!1,requireRole:u.Monitor}].filter(e=>D(e.requireRole,d)).filter(e=>!e.requireJoin||p?.status===f.Accepted).filter(e=>!e.requireJoin||!k||p?.practiceMode),N=A.map(e=>({tabKey:e.link,label:e.title,icon:(0,F.jsx)(j.Icon,{path:e.icon,size:1})})),L=e=>A?.findIndex(t=>e.includes(t.path)),R=L(s.pathname),[z,B]=(0,P.useState)(R<0?0:R);return n(p?.title),(0,P.useEffect)(()=>{let e=L(s.pathname);!e||e<0||B(e)}),(0,P.useEffect)(()=>{if(p){let e=(0,M.default)();if(e<(0,M.default)(p.start)){l(`/games/${o}`),c({id:`no-access`,color:`yellow`,message:x(`game.notification.not_started`),icon:(0,F.jsx)(j.Icon,{path:y,size:1})});return}if(s.pathname.includes(`scoreboard`)||s.pathname.includes(`monitor`)&&D(u.Monitor,d))return;e<(0,M.default)(p.end)?m===f.Suspended?(l(`/games/${o}`),c({id:`no-access`,color:`yellow`,message:x(`game.notification.suspended`),icon:(0,F.jsx)(j.Icon,{path:y,size:1})})):m!==f.Accepted&&(l(`/games/${o}`),c({id:`no-access`,color:`yellow`,message:x(`game.notification.not_joined`),icon:(0,F.jsx)(j.Icon,{path:y,size:1})})):!p.practiceMode&&!D(u.Monitor,d)&&(l(`/games/${o}`),c({id:`no-access`,color:`yellow`,message:x(`game.notification.ended`),icon:(0,F.jsx)(j.Icon,{path:y,size:1})}))}},[p,m,d,s]),(0,F.jsxs)(S,{pos:`relative`,mt:`md`,children:[(0,F.jsx)(t,{visible:!p,overlayProps:T}),(0,F.jsx)(O,{active:z,onTabChange:(e,t)=>{B(e),l(`/games/${o}/${t}`)},tabs:N,aside:p&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(h,{children:p?.title}),(0,F.jsx)(I,{game:p})]})}),i]})};export{L as t};