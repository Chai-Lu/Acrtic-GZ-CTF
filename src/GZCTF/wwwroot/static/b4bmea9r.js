/* The GZ::CTF Project @unknown
 * 
 * License   : GNU Affero General Public License v3.0 (Core)
 * License   : LicenseRef-GZCTF-Restricted (Restricted components)
 * Commit    : Unofficial build version
 * Build     : 2025-12-08T11:45:34.456Z
 * Copyright (C) 2022-2025 GZTimeWalker. All Rights Reserved.
 */
import"./lcut4z52.js";import"./cbxtepre.js";import{t as e}from"./isy1dskq.js";import{a as t,i as n,n as r,o as i,r as a,t as o}from"./hrbt7ry7.js";import"./nugqs812.js";import{n as s,t as c}from"./cppun4hr.js";import{t as l}from"./o417b45d.js";import{t as u}from"./h0nb8b87.js";import{An as ee,Ca as d,Cr as f,Fi as p,In as m,Jn as te,Jr as h,Li as g,Lr as _,Mi as ne,O as v,Oa as y,Or as b,Pi as x,Qi as S,Ri as C,Tr as w,Vr as T,W as E,X as re,Xi as D,Zr as O,b as k,cr as A,dr as j,ha as M,ji as N,jr as ie,ki as P,li as F,sr as ae,ta as oe,tt as se,ut as ce,wi as le}from"./index.hrqptwjo.js";import{n as ue}from"./iwhjrhtg.js";var I=y(M(),1),L=y(d(),1);function de({data:e,value:t}){let n=t.map(e=>e.trim().toLowerCase());return e.reduce((e,t)=>(r(t)?e.push({group:t.group,items:t.items.filter(e=>n.indexOf(e.label.toLowerCase().trim())===-1)}):n.indexOf(t.label.toLowerCase().trim())===-1&&e.push(t),e),[])}function R(e,t){return e?t.split(RegExp(`[${e.join(``)}]`)).map(e=>e.trim()).filter(e=>e!==``):[t]}function z({splitChars:e,allowDuplicates:t,maxTags:n,value:r,currentTags:i}){let a=R(e,r),o=t?[...i,...a]:[...new Set([...i,...a])];return n?o.slice(0,n):o}var fe={maxTags:1/0,acceptValueOnBlur:!0,splitChars:[`,`],hiddenInputValuesDivider:`,`,size:`sm`},B=le((e,r)=>{let l=N(`TagsInput`,fe,e),{classNames:u,className:ee,style:d,styles:f,unstyled:m,vars:te,size:h,value:g,defaultValue:_,onChange:ne,onKeyDown:v,maxTags:y,allowDuplicates:b,onDuplicate:C,variant:w,data:T,dropdownOpened:E,defaultDropdownOpened:re,onDropdownOpen:O,onDropdownClose:k,selectFirstOptionOnChange:A,onOptionSubmit:j,comboboxProps:M,filter:ie,limit:F,withScrollArea:ae,maxDropdownHeight:se,searchValue:ce,defaultSearchValue:le,onSearchChange:ue,readOnly:R,disabled:B,splitChars:V,onFocus:H,onBlur:pe,onPaste:me,radius:he,rightSection:ge,rightSectionWidth:_e,rightSectionPointerEvents:ve,rightSectionProps:ye,leftSection:be,leftSectionWidth:xe,leftSectionPointerEvents:Se,leftSectionProps:Ce,inputContainer:we,inputWrapperOrder:Te,withAsterisk:Ee,required:U,labelProps:De,descriptionProps:Oe,errorProps:ke,wrapperProps:Ae,description:je,label:W,error:Me,withErrorStyles:Ne,name:Pe,form:Fe,id:Ie,clearable:Le,clearButtonProps:Re,hiddenInputProps:ze,hiddenInputValuesDivider:Be,mod:Ve,renderOption:He,onRemove:Ue,onClear:We,scrollAreaProps:Ge,acceptValueOnBlur:Ke,isDuplicate:qe,attributes:G,...Je}=l,K=oe(Ie),Ye=i(T),Xe=t(Ye),q=(0,L.useRef)(null),Ze=S(q,r),J=n({opened:E,defaultOpened:re,onDropdownOpen:O,onDropdownClose:()=>{k?.(),J.resetSelectedOption()}}),{styleProps:Qe,rest:{type:$e,autoComplete:et,...tt}}=P(Je),[Y,X]=D({value:g,defaultValue:_,finalValue:[],onChange:ne}),[Z,nt]=D({value:ce,defaultValue:le,finalValue:``,onChange:ue}),Q=e=>{nt(e),J.resetSelectedOption()},$=x({name:`TagsInput`,classes:{},props:l,classNames:u,styles:f,unstyled:m}),{resolvedClassNames:rt,resolvedStyles:it}=p({props:l,styles:f,classNames:u}),at=e=>{let t=qe?qe(e,Y):Y.some(t=>t.toLowerCase()===e.toLowerCase());t&&C?.(e),(!t||t&&b)&&Y.length<y&&(j?.(e),Q(``),e.length>0&&X([...Y,e]))},ot=e=>{if(v?.(e),e.isPropagationStopped())return;let t=Z.trim(),{length:n}=t;if(V.includes(e.key)&&n>0&&(X(z({splitChars:V,allowDuplicates:b,maxTags:y,value:Z,currentTags:Y})),Q(``),e.preventDefault()),e.key===`Enter`&&n>0&&!e.nativeEvent.isComposing){if(e.preventDefault(),document.querySelector(`#${J.listId} [data-combobox-option][data-combobox-selected]`))return;at(t)}e.key===`Backspace`&&n===0&&Y.length>0&&!e.nativeEvent.isComposing&&!R&&(Ue?.(Y[Y.length-1]),X(Y.slice(0,Y.length-1)))},st=e=>{me?.(e),e.preventDefault(),e.clipboardData&&(X(z({splitChars:V,allowDuplicates:b,maxTags:y,value:`${Z}${e.clipboardData.getData(`text/plain`)}`,currentTags:Y})),Q(``))},ct=Y.map((e,t)=>(0,I.jsx)(s,{withRemoveButton:!R,onRemove:()=>{let n=Y.slice();n.splice(t,1),X(n),Ue?.(e)},unstyled:m,disabled:B,attributes:G,...$(`pill`),children:e},`${e}-${t}`));(0,L.useEffect)(()=>{A&&J.selectFirstOption()},[A,Y,Z]);let lt=(0,I.jsx)(a.ClearButton,{...Re,onClear:()=>{X([]),Q(``),q.current?.focus(),J.openDropdown(),We?.()}});return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(a,{store:J,classNames:rt,styles:it,unstyled:m,size:h,readOnly:R,__staticSelector:`TagsInput`,attributes:G,onOptionSubmit:e=>{j?.(e),Q(``),Y.length<y&&X([...Y,Xe[e].label]),J.resetSelectedOption()},...M,children:[(0,I.jsx)(a.DropdownTarget,{children:(0,I.jsx)(c,{...Qe,__staticSelector:`TagsInput`,classNames:rt,styles:it,unstyled:m,size:h,className:ee,style:d,variant:w,disabled:B,radius:he,rightSection:ge,__clearSection:lt,__clearable:Le&&Y.length>0&&!B&&!R,rightSectionWidth:_e,rightSectionPointerEvents:ve,rightSectionProps:ye,leftSection:be,leftSectionWidth:xe,leftSectionPointerEvents:Se,leftSectionProps:Ce,inputContainer:we,inputWrapperOrder:Te,withAsterisk:Ee,required:U,labelProps:De,descriptionProps:Oe,errorProps:ke,wrapperProps:Ae,description:je,label:W,error:Me,withErrorStyles:Ne,__stylesApiProps:{...l,multiline:!0},id:K,mod:Ve,attributes:G,children:(0,I.jsxs)(s.Group,{disabled:B,unstyled:m,...$(`pillsList`),children:[ct,(0,I.jsx)(a.EventsTarget,{autoComplete:et,children:(0,I.jsx)(c.Field,{...tt,ref:Ze,...$(`inputField`),unstyled:m,onKeyDown:ot,onFocus:e=>{H?.(e),J.openDropdown()},onBlur:e=>{pe?.(e),Ke&&at(Z),J.closeDropdown()},onPaste:st,value:Z,onChange:e=>Q(e.currentTarget.value),required:U&&Y.length===0,disabled:B,readOnly:R,id:K})})]})})}),(0,I.jsx)(o,{data:de({data:Ye,value:Y}),hidden:R||B,filter:ie,search:Z,limit:F,hiddenWhenEmpty:!0,withScrollArea:ae,maxDropdownHeight:se,unstyled:m,labelId:W?`${K}-label`:void 0,"aria-label":W?void 0:Je[`aria-label`],renderOption:He,scrollAreaProps:Ge})]}),(0,I.jsx)(a.HiddenInput,{name:Pe,form:Fe,value:Y,valuesDivider:Be,disabled:B,...ze})]})});B.classes={...O.classes,...a.classes},B.displayName=`@mantine/core/TagsInput`;var V=y(v(),1),H=()=>{let{postId:t}=A(),n=g(),r=ae(),{t:i}=j();(0,L.useEffect)(()=>{if(t?.length!==8&&t!==`new`){r(`/404`);return}},[t,r]);let{data:a}=m.info.useInfoGetPost(t??``,{refreshInterval:0,revalidateOnFocus:!1,shouldRetryOnError:!1},t?.length===8),[o,s]=(0,L.useState)({title:a?.title??``,content:a?.content??``,summary:a?.summary??``,tags:a?.tags??[]}),[c,d]=(0,L.useState)([]),[p,v]=(0,L.useState)(!1),[y,x]=(0,L.useState)(!1),S=w(),D=ee(),{colorScheme:O}=ne(),M=async()=>{if(t===`new`){v(!0);try{let e=await m.edit.editAddPost(o);m.info.mutateInfoGetLatestPosts(),m.info.mutateInfoGetPosts(),f({color:`teal`,message:i(`post.notification.created`),icon:(0,I.jsx)(V.Icon,{path:E,size:24})}),x(!1),r(`/posts/${e.data}/edit`)}catch(e){k(e,i)}finally{v(!1)}}else if(t?.length===8){v(!0);try{let e=await m.edit.editUpdatePost(t,o);m.info.mutateInfoGetPost(t,e.data),m.info.mutateInfoGetLatestPosts(),m.info.mutateInfoGetPosts(),f({color:`teal`,message:i(`post.notification.saved`),icon:(0,I.jsx)(V.Icon,{path:E,size:24})}),x(!1)}catch(e){k(e,i)}finally{v(!1)}}},N=async()=>{if(t){v(!0);try{await m.edit.editDeletePost(t),m.info.mutateInfoGetPosts(),m.info.mutateInfoGetLatestPosts(),r(`/posts`)}catch(e){k(e,i)}finally{v(!1)}}};(0,L.useEffect)(()=>{a&&(s({title:a.title,content:a.content,summary:a.summary,isPinned:a.isPinned,tags:a.tags??[]}),d(a.tags??[]))},[a]),(0,L.useEffect)(()=>{a&&x(o.title!==a.title||o.content!==a.content||o.summary!==a.summary||o.isPinned!==a.isPinned||(o.tags?.some(e=>!a?.tags?.includes(e))??!1))},[o,a]);let P=(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(u,{label:i(`post.label.title`),value:o.title??``,onChange:e=>s({...o,title:e.currentTarget.value})}),(0,I.jsx)(B,{label:i(`post.label.tag`),data:c.map(e=>({value:e,label:e}))||[],placeholder:i(`post.label.add_tag`),value:o?.tags??[],onChange:e=>s({...o,tags:e}),clearable:!0})]});return(0,I.jsx)(e,{minWidth:0,withHeader:!0,stickyHeader:!0,children:(0,I.jsx)(ue,{requiredRole:te.Admin,children:(0,I.jsxs)(ie,{mt:D?25:30,children:[(0,I.jsxs)(F,{justify:D?`right`:`space-between`,children:[!D&&(0,I.jsx)(b,{order:1,c:C(O===`dark`?n.colors.light[6]:n.colors.gray[7],.5),children:`> ${i(t===`new`?`post.button.new`:`post.button.edit`)}`}),(0,I.jsxs)(F,{justify:`right`,children:[t?.length===8&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(T,{disabled:p,color:`red`,leftSection:(0,I.jsx)(V.Icon,{path:`M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19M8,9H16V19H8V9M15.5,4L14.5,3H9.5L8.5,4H5V6H19V4H15.5Z`,size:1}),variant:`outline`,onClick:()=>S.openConfirmModal({title:i(`post.button.delete`),children:(0,I.jsx)(h,{size:`sm`,children:i(`post.content.delete`,{title:a?.title})}),onConfirm:N,confirmProps:{color:`red`}}),children:i(`post.button.delete`)}),(0,I.jsx)(T,{disabled:p,leftSection:(0,I.jsx)(V.Icon,{path:`M23.5 17L18.5 22L15 18.5L16.5 17L18.5 19L22 15.5L23.5 17M13.09 20H6V4H13V9H18V13.09C18.33 13.04 18.66 13 19 13S19.67 13.04 20 13.09V8L14 2H6C4.89 2 4 2.9 4 4V20C4 21.11 4.89 22 6 22H13.81C13.46 21.39 13.21 20.72 13.09 20Z`,size:1}),onClick:()=>{y?S.openConfirmModal({title:i(`post.content.updated.title`),children:(0,I.jsx)(h,{size:`sm`,children:i(`post.content.updated.content`)}),onConfirm:()=>{M(),r(`/posts/${t}`)}}):r(`/posts/${t}`)},children:i(`post.button.goto`)})]}),(0,I.jsx)(T,{disabled:p,leftSection:(0,I.jsx)(V.Icon,{path:re,size:1}),onClick:M,children:i(t===`new`?`post.button.new`:`post.button.save`)})]})]}),D?P:(0,I.jsx)(l,{cols:2,children:P}),(0,I.jsx)(_,{label:(0,I.jsxs)(F,{gap:`sm`,children:[(0,I.jsx)(h,{size:`sm`,children:i(`post.label.summary`)}),(0,I.jsx)(h,{size:`xs`,c:`dimmed`,children:i(`admin.content.markdown_support`)})]}),autosize:!0,value:o.summary??``,onChange:e=>s({...o,summary:e.currentTarget.value}),minRows:5,maxRows:5}),(0,I.jsx)(_,{label:(0,I.jsxs)(F,{gap:`sm`,children:[(0,I.jsx)(h,{size:`sm`,children:i(`post.label.content`)}),(0,I.jsx)(h,{size:`xs`,c:`dimmed`,children:i(`admin.content.markdown_support`)})]}),autosize:!0,value:o.content??``,onChange:e=>s({...o,content:e.currentTarget.value}),minRows:D?14:16,maxRows:D?14:16})]})})})};export{H as default};