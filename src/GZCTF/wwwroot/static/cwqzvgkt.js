/* The GZ::CTF Project @unknown
 * 
 * License   : GNU Affero General Public License v3.0 (Core)
 * License   : LicenseRef-GZCTF-Restricted (Restricted components)
 * Commit    : Unofficial build version
 * Build     : 2025-12-08T11:45:34.456Z
 * Copyright (C) 2022-2025 GZTimeWalker. All Rights Reserved.
 */
import{r as e}from"./lcut4z52.js";import"./cbxtepre.js";import{o as t}from"./isy1dskq.js";import{t as n}from"./cdbutviq.js";import"./kocdnk2i.js";import{t as r}from"./nu4jnu0f.js";import{t as i}from"./kpl3u1sg.js";import"./nugqs812.js";import{t as a}from"./o417b45d.js";import{t as o}from"./gmgm1gqp.js";import{t as s}from"./h0nb8b87.js";import{t as c}from"./lj7msjkh.js";import{Ar as l,Br as u,Bt as d,Ca as f,Cr as p,Dr as m,Hr as h,In as g,Jn as _,Jr as v,L as y,Lr as b,Lt as x,Nr as S,O as C,Oa as w,P as ee,Tr as te,Ur as T,Vr as E,W as D,Zt as O,_i as k,b as A,di as j,dr as M,ha as N,jr as P,li as F,tt as I,yi as L,z as R,zr as z}from"./index.hrqptwjo.js";import"./iwhjrhtg.js";import{t as B}from"./cjpezv9m.js";import"./mdazlrzp.js";import{t as ne}from"./mbfygvvk.js";import{t as re}from"./c5hn22cb.js";import{t as ie}from"./l7haotmn.js";var V=w(C()),H=w(m()),U=w(f()),W=w(N());const G=new Map([[_.Admin,`blue`],[_.User,`green`],[_.Monitor,`yellow`],[_.Banned,`red`]]),ae=n=>{let{user:r,mutateUser:o,...c}=n,{user:l}=e(),[d,f]=(0,U.useState)(!1),[m,h]=(0,U.useState)({}),{t:y}=M(),x=l?.userId===r.id;(0,U.useEffect)(()=>{h({...r})},[r]);let C=async()=>{if(r.id){f(!0);try{await g.admin.adminUpdateUserInfo(r.id,m),p({color:`teal`,message:y(`admin.notification.users.updated`),icon:(0,W.jsx)(V.Icon,{path:D,size:1})}),o({...r,...m}),c.onClose()}catch(e){A(e,y)}finally{f(!1)}}};return(0,W.jsx)(S,{...c,children:(0,W.jsxs)(P,{gap:`md`,m:`auto`,mt:15,children:[(0,W.jsxs)(i,{grow:!0,children:[(0,W.jsx)(i.Col,{span:8,children:(0,W.jsx)(s,{label:y(`account.label.username`),type:`text`,w:`100%`,value:m.userName??`ctfer`,disabled:d,onChange:e=>h({...m,userName:e.target.value})})}),(0,W.jsx)(i.Col,{span:4,children:(0,W.jsx)(u,{children:(0,W.jsx)(T,{alt:`avatar`,radius:`xl`,size:70,src:r.avatar,children:r.userName?.slice(0,1)??`U`})})})]}),(0,W.jsx)(t.Group,{label:y(`admin.label.users.role`),value:m.role,onChange:e=>{h({...m,role:e})},children:(0,W.jsx)(F,{grow:!0,mt:`xs`,children:Object.keys(_).map(e=>(0,W.jsx)(t,{value:e,label:(0,W.jsx)(v,{size:`sm`,fw:`bold`,children:e}),color:G.get(e),disabled:d||x},e))})}),(0,W.jsxs)(a,{cols:2,children:[(0,W.jsx)(s,{label:y(`account.label.email`),type:`email`,w:`100%`,value:m.email??`ctfer@gzti.me`,disabled:d,onChange:e=>h({...m,email:e.target.value})}),(0,W.jsx)(s,{label:y(`account.label.phone`),type:`tel`,w:`100%`,value:m.phone??``,disabled:d,onChange:e=>h({...m,phone:e.target.value})}),(0,W.jsx)(s,{label:y(`account.label.student_id`),type:`text`,w:`100%`,value:m.stdNumber??``,disabled:d,onChange:e=>h({...m,stdNumber:e.target.value})}),(0,W.jsx)(s,{label:y(`account.label.real_name`),type:`text`,w:`100%`,value:m.realName??``,disabled:d,onChange:e=>h({...m,realName:e.target.value})})]}),(0,W.jsx)(b,{label:y(`account.label.bio`),value:m.bio??y(`account.placeholder.bio`),w:`100%`,disabled:d,autosize:!0,minRows:2,maxRows:4,onChange:e=>h({...m,bio:e.target.value})}),(0,W.jsxs)(P,{gap:2,children:[(0,W.jsxs)(F,{justify:`space-between`,children:[(0,W.jsx)(v,{size:`sm`,fw:500,children:y(`common.label.ip`)}),(0,W.jsx)(v,{size:`sm`,span:!0,fw:500,ff:`monospace`,children:r.ip})]}),(0,W.jsxs)(F,{justify:`space-between`,children:[(0,W.jsx)(v,{size:`sm`,fw:500,children:y(`admin.label.users.last_visit`)}),(0,W.jsx)(v,{size:`sm`,span:!0,fw:500,ff:`monospace`,children:(0,H.default)(r.lastVisitedUtc).format(`YYYY-MM-DD HH:mm:ss`)})]})]}),(0,W.jsx)(F,{grow:!0,m:`auto`,w:`100%`,children:(0,W.jsx)(E,{fullWidth:!0,disabled:d,onClick:C,children:y(`admin.button.save`)})})]})})};var K=w(C(),1),q=30,J=()=>{let[t,i]=(0,U.useState)(1),[a,u]=(0,U.useState)(new Date),[f,m]=(0,U.useState)(!1),[b,x]=(0,U.useState)({}),{data:S,total:C,setData:w,updateData:O}=ie(),[N,I]=r(``),[V,H]=(0,U.useState)(!1),[J,Y]=(0,U.useState)(!1),[X,Z]=(0,U.useState)(0),oe=te(),{user:se}=e(),ce=n(),{t:Q}=M(),$=(0,U.useRef)(null);(0,U.useEffect)(()=>{$.current?.scrollTo({top:0,behavior:`smooth`})},[t,$]),(0,U.useEffect)(()=>{(async()=>{try{let e=await g.admin.adminUsers({count:q,skip:(t-1)*q});w(e.data),Z((t-1)*q+e.data.length)}catch(e){A(e,Q)}})()},[t,a]);let le=async()=>{try{if(N){let e=await g.admin.adminSearchUsers({hint:N});w(e.data),Z(e.data.length)}else{let e=await g.admin.adminUsers({count:q,skip:(t-1)*q});w(e.data),Z((t-1)*q+e.data.length)}}catch(e){A(e,Q)}finally{H(!1)}},ue=async e=>{Y(!0);try{await g.admin.adminUpdateUserInfo(e.id,{emailConfirmed:!e.emailConfirmed}),S&&O(S.map(t=>t.id===e.id?{...t,emailConfirmed:!t.emailConfirmed}:t))}catch(e){A(e,Q)}finally{Y(!1)}},de=async e=>{Y(!0);try{let t=await g.admin.adminResetPassword(e.id);oe.openModal({title:Q(`admin.content.users.reset.title`,{name:e.userName}),children:(0,W.jsxs)(P,{children:[(0,W.jsx)(v,{children:(0,W.jsx)(c,{i18nKey:`admin.content.users.reset.content`})}),(0,W.jsx)(v,{fw:`bold`,ff:`monospace`,children:t.data}),(0,W.jsx)(E,{onClick:()=>{ce.copy(t.data),p({message:Q(`admin.notification.users.password_copied`),color:`teal`,icon:(0,W.jsx)(K.Icon,{path:D,size:1})})},children:Q(`common.button.copy`)})]})})}catch(e){A(e,Q)}finally{Y(!1)}},fe=async e=>{try{if(Y(!0),!e.id)return;await g.admin.adminDeleteUser(e.id),p({message:Q(`admin.notification.users.deleted`,{name:e.userName}),color:`teal`,icon:(0,W.jsx)(K.Icon,{path:D,size:1})}),S&&O(S.filter(t=>t.id!==e.id)),Z(X-1),u(new Date)}catch(e){A(e,Q)}finally{Y(!1)}};return(0,W.jsx)(ne,{isLoading:V||!S,head:(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(s,{w:`36%`,leftSection:(0,W.jsx)(K.Icon,{path:d,size:1}),placeholder:Q(`admin.placeholder.users.search`),value:N,onChange:I,onKeyDown:e=>{!V&&e.key===`Enter`&&le()},rightSection:(0,W.jsx)(K.Icon,{path:ee,size:1})}),(0,W.jsxs)(F,{justify:`right`,children:[(0,W.jsx)(v,{fw:`bold`,size:`sm`,children:(0,W.jsxs)(c,{i18nKey:`admin.content.users.stats`,values:{current:X,total:C},children:[`_`,(0,W.jsx)(z,{children:`_`}),`_`]})}),(0,W.jsx)(j,{size:`lg`,disabled:t<=1,onClick:()=>i(t-1),children:(0,W.jsx)(K.Icon,{path:y,size:1})}),(0,W.jsx)(v,{fw:`bold`,size:`sm`,children:t}),(0,W.jsx)(j,{size:`lg`,disabled:t*q>=C,onClick:()=>i(t+1),children:(0,W.jsx)(K.Icon,{path:R,size:1})})]})]}),children:(0,W.jsxs)(k,{shadow:`md`,p:`xs`,w:`100%`,children:[(0,W.jsx)(L,{viewportRef:$,offsetScrollbars:!0,scrollbarSize:4,h:`calc(100vh - 190px)`,children:(0,W.jsxs)(o,{className:re.table,children:[(0,W.jsx)(o.Thead,{children:(0,W.jsxs)(o.Tr,{children:[(0,W.jsx)(o.Th,{miw:`1.8rem`,children:Q(`admin.label.users.active`)}),(0,W.jsx)(o.Th,{children:Q(`common.label.user`)}),(0,W.jsx)(o.Th,{children:Q(`account.label.email`)}),(0,W.jsx)(o.Th,{children:Q(`common.label.ip`)}),(0,W.jsx)(o.Th,{children:Q(`account.label.real_name`)}),(0,W.jsx)(o.Th,{children:Q(`account.label.student_id`)}),(0,W.jsx)(o.Th,{})]})}),(0,W.jsx)(o.Tbody,{children:S&&S.map(e=>(0,W.jsxs)(o.Tr,{children:[(0,W.jsx)(o.Td,{children:(0,W.jsx)(l,{disabled:J,checked:e.emailConfirmed??!1,onChange:()=>ue(e)})}),(0,W.jsx)(o.Td,{children:(0,W.jsxs)(F,{wrap:`nowrap`,justify:`space-between`,gap:`xs`,children:[(0,W.jsxs)(F,{wrap:`nowrap`,justify:`left`,children:[(0,W.jsx)(T,{alt:`avatar`,src:e.avatar,radius:`xl`,children:e.userName?.slice(0,1)??`U`}),(0,W.jsx)(v,{ff:`monospace`,size:`sm`,fw:`bold`,lineClamp:1,children:e.userName})]}),(0,W.jsx)(h,{size:`sm`,color:G.get(e.role??_.User),children:e.role})]})}),(0,W.jsx)(o.Td,{children:(0,W.jsx)(v,{size:`sm`,lineClamp:1,children:e.email})}),(0,W.jsx)(o.Td,{children:(0,W.jsx)(v,{lineClamp:1,size:`sm`,ff:`monospace`,children:e.ip})}),(0,W.jsx)(o.Td,{children:e.realName??Q(`admin.placeholder.users.real_name`)}),(0,W.jsx)(o.Td,{children:(0,W.jsx)(v,{size:`sm`,ff:`monospace`,children:e.stdNumber??Q(`admin.placeholder.users.student_id`)})}),(0,W.jsx)(o.Td,{align:`right`,children:(0,W.jsxs)(F,{wrap:`nowrap`,gap:`sm`,justify:`right`,children:[(0,W.jsx)(j,{color:`blue`,onClick:()=>{x(e),m(!0)},children:(0,W.jsx)(K.Icon,{path:`M14.06,9L15,9.94L5.92,19H5V18.08L14.06,9M17.66,3C17.41,3 17.15,3.1 16.96,3.29L15.13,5.12L18.88,8.87L20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18.17,3.09 17.92,3 17.66,3M14.06,6.19L3,17.25V21H6.75L17.81,9.94L14.06,6.19Z`,size:1})}),(0,W.jsx)(B,{iconPath:`M12.63,2C18.16,2 22.64,6.5 22.64,12C22.64,17.5 18.16,22 12.63,22C9.12,22 6.05,20.18 4.26,17.43L5.84,16.18C7.25,18.47 9.76,20 12.64,20A8,8 0 0,0 20.64,12A8,8 0 0,0 12.64,4C8.56,4 5.2,7.06 4.71,11H7.47L3.73,14.73L0,11H2.69C3.19,5.95 7.45,2 12.63,2M15.59,10.24C16.09,10.25 16.5,10.65 16.5,11.16V15.77C16.5,16.27 16.09,16.69 15.58,16.69H10.05C9.54,16.69 9.13,16.27 9.13,15.77V11.16C9.13,10.65 9.54,10.25 10.04,10.24V9.23C10.04,7.7 11.29,6.46 12.81,6.46C14.34,6.46 15.59,7.7 15.59,9.23V10.24M12.81,7.86C12.06,7.86 11.44,8.47 11.44,9.23V10.24H14.19V9.23C14.19,8.47 13.57,7.86 12.81,7.86Z`,color:`orange`,message:Q(`admin.content.users.reset.message`,{name:e.userName}),disabled:J,onClick:()=>de(e)}),(0,W.jsx)(B,{iconPath:`M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19M8,9H16V19H8V9M15.5,4L14.5,3H9.5L8.5,4H5V6H19V4H15.5Z`,color:`alert`,message:Q(`admin.content.users.delete`,{name:e.userName}),disabled:J||e.id===se?.userId,onClick:()=>fe(e)})]})})]},e.id))})]})}),(0,W.jsx)(ae,{size:`35%`,title:Q(`admin.button.users.edit`),user:b,opened:f,onClose:()=>m(!1),mutateUser:e=>{O([e,...S?.filter(t=>t.id!==e.id)??[]].sort((e,t)=>e.id<t.id?-1:1))}})]})})};export{J as default};