/* The GZ::CTF Project @unknown
 * 
 * License   : GNU Affero General Public License v3.0 (Core)
 * License   : LicenseRef-GZCTF-Restricted (Restricted components)
 * Commit    : Unofficial build version
 * Build     : 2025-12-08T11:45:34.456Z
 * Copyright (C) 2022-2025 GZTimeWalker. All Rights Reserved.
 */
import{n as e,r as t}from"./lcut4z52.js";import"./cbxtepre.js";import{t as n}from"./isy1dskq.js";import{t as r}from"./ltc052rv.js";import{t as i}from"./cdbutviq.js";import{t as a}from"./kocdnk2i.js";import{t as o}from"./j0saofxo.js";import{t as s}from"./kpl3u1sg.js";import{n as c,s as l,t as u}from"./nugqs812.js";import{t as d}from"./gjb4rijj.js";import{t as f}from"./o417b45d.js";import{t as p}from"./h0nb8b87.js";import{t as m}from"./lj7msjkh.js";import{An as h,Br as g,Ca as _,Cr as v,Hr as y,In as b,It as x,J as S,Jn as C,Jr as w,Li as T,Lr as E,Mr as D,N as O,Nr as k,O as A,Oa as j,Or as M,Q as N,S as P,Sr as F,Ti as ee,Tr as I,Ur as L,Vr as R,W as z,an as B,b as V,di as H,dn as U,dr as W,fi as te,ha as ne,jr as G,li as K,p as re,q,wr as ie,wt as ae,yi as oe}from"./index.hrqptwjo.js";import{n as se}from"./iwhjrhtg.js";var J=j(A()),Y=j(_()),X={lockBadge:`Da`,card:`Ea`,cardMobile:`Fa`,contentGroup:`Ga`,contentGroupMobile:`Ha`,avatarGroup:`Ia`,captainIcon:`Ja`},Z=j(ne());const ce=e=>{let{team:t,isCaptain:n,onEdit:r}=e,{t:i}=W(),a=h();return(0,Z.jsxs)(o,{shadow:`md`,radius:`lg`,onClick:r,className:a?X.cardMobile:X.card,classNames:{root:u.hoverCard},children:[(0,Z.jsxs)(K,{className:a?X.contentGroupMobile:X.contentGroup,children:[(0,Z.jsx)(L,{alt:`avatar`,size:`xl`,radius:`xl`,src:t.avatar,children:t.name?.slice(0,1)??`T`}),(0,Z.jsxs)(G,{gap:4,className:u.flexGrow,children:[(0,Z.jsxs)(K,{justify:`space-between`,align:`center`,children:[(0,Z.jsx)(M,{order:2,lineClamp:1,children:t.name}),n&&(0,Z.jsx)(J.Icon,{path:`M5 16L3 5L8.5 10L12 4L15.5 10L21 5L19 16H5M19 19C19 19.6 18.6 20 18 20H6C5.4 20 5 19.6 5 19V18H19V19Z`,size:1,className:X.captainIcon})]}),(0,Z.jsx)(w,{size:`sm`,c:`dimmed`,lineClamp:1,children:t.bio||i(`team.placeholder.bio`)}),(0,Z.jsxs)(K,{justify:`space-between`,align:`center`,children:[(0,Z.jsxs)(w,{size:`sm`,c:`dimmed`,tt:`uppercase`,fw:`bold`,children:[i(`team.label.members`),` (`,t.members?.length||0,`)`]}),(0,Z.jsxs)(L.Group,{className:X.avatarGroup,children:[t.members?.slice(0,6).map(e=>(0,Z.jsx)(D,{label:e.userName,withArrow:!0,children:(0,Z.jsx)(L,{alt:`avatar`,radius:`xl`,size:`md`,src:e.avatar,children:e.userName?.slice(0,1)??`U`})},e.id)),t.members&&t.members.length>6&&(0,Z.jsxs)(L,{radius:`xl`,size:`lg`,children:[`+`,t.members.length-6]})]})]})]})]}),t.locked&&(0,Z.jsx)(g,{className:X.lockBadge,children:(0,Z.jsx)(J.Icon,{path:`M12,17C10.89,17 10,16.1 10,15C10,13.89 10.89,13 12,13A2,2 0 0,1 14,15A2,2 0 0,1 12,17M18,20V10H6V20H18M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V10C4,8.89 4.89,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z`,size:.8,color:`white`})})]})};var le=j(A());const ue=e=>{let{disallowCreate:t,mutate:n,...r}=e,[i,a]=(0,Y.useState)({name:``,bio:``}),[o,s]=(0,Y.useState)(!1),c=T(),{t:l}=W(),u=async()=>{s(!0);try{let e=await b.team.teamCreateTeam(i);v({color:`teal`,title:l(`team.notification.create.success.title`),message:l(`team.notification.create.success.message`,{team:e.data.name}),icon:(0,Z.jsx)(le.Icon,{path:z,size:1})}),a({name:``,bio:``}),n(),r.onClose()}catch(e){V(e,l)}finally{s(!1)}};return(0,Z.jsx)(k,{...r,children:t?(0,Z.jsxs)(G,{gap:`lg`,p:40,ta:`center`,children:[(0,Z.jsx)(g,{children:(0,Z.jsx)(le.Icon,{color:c.colors.red[7],path:S,size:4})}),(0,Z.jsx)(M,{order:3,children:l(`team.content.disallow_create.title`)}),(0,Z.jsx)(w,{children:(0,Z.jsx)(m,{i18nKey:`team.content.disallow_create.content`})})]}):(0,Z.jsxs)(G,{children:[(0,Z.jsx)(w,{children:l(`team.content.create`)}),(0,Z.jsx)(p,{label:l(`team.label.name`),type:`text`,placeholder:`team`,w:`100%`,disabled:o,value:i?.name??``,onChange:e=>a({...i,name:e.currentTarget.value})}),(0,Z.jsx)(E,{label:l(`team.label.bio`),placeholder:i?.bio??l(`team.placeholder.bio`),value:i?.bio??``,w:`100%`,autosize:!0,minRows:2,maxRows:4,disabled:o,onChange:e=>a({...i,bio:e.currentTarget.value})}),(0,Z.jsx)(R,{fullWidth:!0,variant:`outline`,onClick:u,disabled:o,children:l(`team.button.create`)})]})})};var de={teamMember:`Ma`,captainGroup:`Na`},Q=j(A()),fe=e=>{let{user:t,isCaptain:n,onKick:r,onTransferCaptain:i}=e,[a,o]=(0,Y.useState)(!1),{t:s}=W();return(0,Z.jsxs)(K,{justify:`space-between`,gap:2,p:`xs`,className:de.teamMember,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onClick:()=>o(!a),children:[(0,Z.jsxs)(K,{justify:`left`,children:[(0,Z.jsx)(L,{alt:`avatar`,src:t.avatar,radius:`xl`,size:`md`,children:t.userName?.slice(0,1)??`U`}),(0,Z.jsx)(w,{fw:500,size:`sm`,children:t.userName})]}),n&&a&&(0,Z.jsxs)(K,{gap:`xs`,justify:`right`,children:[(0,Z.jsx)(D,{label:s(`team.label.transfer`),children:(0,Z.jsx)(H,{variant:`light`,color:`yellow`,onClick:e=>{e.stopPropagation(),i(t)},children:(0,Z.jsx)(Q.Icon,{path:`M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z`,size:.8})})}),(0,Z.jsx)(D,{label:s(`team.label.kick`),children:(0,Z.jsx)(H,{variant:`light`,color:`red`,onClick:e=>{e.stopPropagation(),r(t)},children:(0,Z.jsx)(Q.Icon,{path:`M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z`,size:.8})})})]})]})};const pe=e=>{let{team:t,isCaptain:n,...a}=e,o=t?.id,[c,f]=(0,Y.useState)(t),[m,h]=(0,Y.useState)(!1),[_,x]=(0,Y.useState)(null),[S,C]=(0,Y.useState)(``),[T,D]=(0,Y.useState)(!1),{data:O,mutate:A}=b.team.useTeamGetTeamsInfo(),j=i(),M=c?.members?.filter(e=>e.captain)[0],N=c?.members?.filter(e=>!e.captain),B=I(),{t:U}=W();(0,Y.useEffect)(()=>{f(t)},[t]),(0,Y.useEffect)(()=>{(async()=>{!n||!o||S||C((await b.team.teamInviteCode(o)).data)})()},[S,n,o]);let te=async()=>{if(!(!c||n))try{await b.team.teamLeave(c.id),v({color:`teal`,title:U(`team.notification.leave.success`),message:U(`team.notification.updated`),icon:(0,Z.jsx)(Q.Icon,{path:z,size:1})}),A(O?.filter(e=>e.id!==c.id),{revalidate:!1}),C(``),f(null),e.onClose()}catch(e){V(e,U)}},ne=async()=>{if(!(!c||!n))try{await b.team.teamDeleteTeam(c.id),v({color:`teal`,title:U(`team.notification.disband.success`),message:U(`team.notification.updated`),icon:(0,Z.jsx)(Q.Icon,{path:z,size:1})}),C(``),f(null),A(O?.filter(e=>e.id!==c.id),{revalidate:!1}),e.onClose()}catch(e){V(e,U)}},ae=async e=>{if(!(!c||!n))try{await b.team.teamTransfer(c.id,{newCaptainId:e}),v({color:`teal`,title:U(`team.notification.transfer.success`),message:U(`team.notification.updated`),icon:(0,Z.jsx)(Q.Icon,{path:z,size:1})}),A(O?.map(e=>e.id===c.id?c:e),{revalidate:!1})}catch(e){V(e,U)}},se=async e=>{if(!(!c?.id||!n))try{await b.team.teamKickUser(c.id,e),v({color:`teal`,title:U(`team.notification.kick.success`),message:U(`team.notification.updated`),icon:(0,Z.jsx)(Q.Icon,{path:z,size:1})}),A(O?.map(e=>e.id===c.id?c:e),{revalidate:!1})}catch(e){V(e,U)}},J=async()=>{if(!(!S||!t?.id))try{C((await b.team.teamUpdateInviteToken(t.id)).data),v({color:`teal`,message:U(`team.notification.invite_code.updated`),icon:(0,Z.jsx)(Q.Icon,{path:z,size:1})})}catch(e){V(e,U)}},X=async()=>{if(!(!_||!c?.id)){D(!0),F.clean(),v({id:`upload-avatar`,color:`orange`,message:U(`common.avatar.uploading`),loading:!0,autoClose:!1});try{let e=await b.team.teamAvatar(c.id,{file:_});ie({id:`upload-avatar`,color:`teal`,message:U(`common.avatar.uploaded`),icon:(0,Z.jsx)(Q.Icon,{path:z,size:1}),autoClose:!0,loading:!1}),x(null);let t={...c,avatar:e.data};f(t),A(O?.map(e=>e.id===c.id?t:e),{revalidate:!1})}catch(e){ie({id:`upload-avatar`,color:`red`,title:U(`common.avatar.upload_failed`),message:P(e,U),icon:(0,Z.jsx)(Q.Icon,{path:q,size:1}),autoClose:!0,loading:!1})}finally{D(!1),h(!1)}}},ce=async()=>{if(!(!c||!c?.id))try{await b.team.teamUpdateTeam(c.id,c),v({color:`teal`,message:U(`team.notification.updated`),icon:(0,Z.jsx)(Q.Icon,{path:z,size:1})}),A(O?.map(e=>e.id===c.id?c:e),{revalidate:!1})}catch(e){V(e,U)}};return(0,Z.jsxs)(k,{...a,onClose:()=>{h(!1),e.onClose()},children:[(0,Z.jsxs)(G,{gap:`sm`,children:[(0,Z.jsxs)(s,{grow:!0,children:[(0,Z.jsx)(s.Col,{span:8,children:(0,Z.jsx)(p,{label:U(`team.label.name`),type:`text`,placeholder:t?.name??`ctfteam`,w:`100%`,value:c?.name??`team`,disabled:!n,onChange:e=>f({...c,name:e.target.value})})}),(0,Z.jsx)(s.Col,{span:4,children:(0,Z.jsx)(g,{children:(0,Z.jsx)(L,{alt:`avatar`,radius:`xl`,size:70,src:c?.avatar,onClick:()=>n&&h(!0),children:c?.name?.slice(0,1)??`T`})})})]}),n&&(0,Z.jsx)(d,{label:(0,Z.jsxs)(K,{gap:3,children:[(0,Z.jsx)(w,{fw:500,size:`sm`,children:U(`team.label.invite_code`)}),(0,Z.jsx)(H,{size:`sm`,onClick:J,children:(0,Z.jsx)(Q.Icon,{path:`M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z`,size:1})})]}),value:S,placeholder:`loading...`,onClick:()=>{j.copy(S),v({color:`teal`,message:U(`team.notification.invite_code.copied`),icon:(0,Z.jsx)(Q.Icon,{path:`M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z`,size:1})})},readOnly:!0}),(0,Z.jsx)(E,{label:U(`team.label.bio`),placeholder:c?.bio??U(`team.placeholder.bio`),value:c?.bio??``,w:`100%`,disabled:!n,autosize:!0,minRows:2,maxRows:4,onChange:e=>f({...c,bio:e.target.value})}),(0,Z.jsx)(w,{fw:500,size:`sm`,children:U(`team.label.members`)}),(0,Z.jsx)(oe,{h:210,offsetScrollbars:!0,children:(0,Z.jsxs)(G,{gap:`xs`,children:[M&&(0,Z.jsxs)(K,{justify:`space-between`,p:`xs`,className:de.captainGroup,children:[(0,Z.jsxs)(K,{justify:`left`,children:[(0,Z.jsx)(L,{alt:`avatar`,src:M.avatar,radius:`xl`,size:`md`,children:M.userName?.slice(0,1)??`C`}),(0,Z.jsx)(w,{fw:500,size:`sm`,children:M.userName})]}),(0,Z.jsx)(y,{color:`orange`,leftSection:(0,Z.jsx)(Q.Icon,{path:`M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z`,size:.6}),children:U(`team.content.role.captain`)})]}),N&&N.map(e=>(0,Z.jsx)(fe,{isCaptain:n,user:e,onTransferCaptain:e=>{B.openConfirmModal({title:U(`team.content.transfer.confirm.title`),children:(0,Z.jsx)(w,{size:`sm`,children:U(`team.content.transfer.confirm.message`,{team:c?.name,user:e.userName})}),onConfirm:()=>ae(e.id),confirmProps:{color:`orange`},zIndex:1e4})},onKick:e=>{B.openConfirmModal({title:U(`team.content.kick.confirm.title`),children:(0,Z.jsx)(w,{size:`sm`,children:U(`team.content.kick.confirm.message`,{user:e.userName})}),onConfirm:()=>se(e.id),confirmProps:{color:`orange`},zIndex:1e4})}},e.id))]})}),(0,Z.jsxs)(K,{grow:!0,m:`auto`,w:`100%`,children:[(0,Z.jsx)(R,{fullWidth:!0,color:`red`,variant:`outline`,onClick:()=>{B.openConfirmModal({title:U(n?`team.content.disband.confirm.title`:`team.content.leave.confirm.title`),children:(0,Z.jsx)(w,{size:`sm`,children:U(n?`team.content.disband.confirm.message`:`team.content.leave.confirm.message`,{team:c?.name})}),onConfirm:n?ne:te,confirmProps:{color:`red`},zIndex:1e4})},children:U(n?`team.button.disband`:`team.button.leave`)}),(0,Z.jsx)(R,{fullWidth:!0,disabled:!n,onClick:ce,children:U(`team.button.save`)})]})]}),(0,Z.jsxs)(k,{opened:m,onClose:()=>h(!1),withCloseButton:!1,zIndex:1e3,children:[(0,Z.jsx)(r,{onDrop:e=>x(e[0]),onReject:()=>{v({color:`red`,title:U(`common.error.file_invalid.title`),message:U(`common.error.file_invalid.message`),icon:(0,Z.jsx)(Q.Icon,{path:q,size:1})})},m:`0 auto 20px auto`,miw:220,mih:220,disabled:T,maxSize:3*1024*1024,accept:re,children:(0,Z.jsx)(K,{justify:`center`,gap:`xl`,mih:240,className:u.n,children:_?(0,Z.jsx)(l,{fit:`contain`,src:URL.createObjectURL(_),alt:`avatar`}):(0,Z.jsxs)(ee,{children:[(0,Z.jsx)(w,{size:`xl`,inline:!0,children:U(`common.content.drop_zone.content`,{type:U(`common.content.drop_zone.type.avatar`)})}),(0,Z.jsx)(w,{size:`sm`,c:`dimmed`,inline:!0,mt:7,children:U(`common.content.drop_zone.limit`)})]})})}),(0,Z.jsx)(R,{fullWidth:!0,variant:`outline`,disabled:T,onClick:X,children:U(`common.avatar.save`)})]})]})};var $=j(A(),1),me=()=>{let{user:r,error:i}=t(),{teams:o,mutate:s,error:l}=e(),u=T(),[d,m]=(0,Y.useState)(!1),[_,y]=(0,Y.useState)(``),[x,S]=(0,Y.useState)(!1),[E,D]=(0,Y.useState)(!1),[A,j]=(0,Y.useState)(null),N=(o?.filter(e=>e.members?.some(e=>e?.captain&&e.id===r?.userId))?.length??0)>=3,P=h(),{t:F}=W();a(F(`team.title.index`));let ee=e=>{j(e),D(!0)},I=/:\d+:[0-9a-f]{32}$/,L=async()=>{if(!I.test(_)){v({color:`red`,title:F(`common.error.encountered`),message:F(`team.notification.join.wrong_invite_code`),icon:(0,Z.jsx)($.Icon,{path:q,size:1})});return}try{await b.team.teamAccept(_),v({color:`teal`,title:F(`team.notification.join.success`),message:F(`team.notification.updated`),icon:(0,Z.jsx)($.Icon,{path:z,size:1})}),s()}catch(e){V(e,F)}finally{y(``),m(!1)}},B=(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(R,{leftSection:(0,Z.jsx)($.Icon,{path:ae,size:1}),variant:`outline`,onClick:()=>m(!0),children:F(`team.button.join`)}),(0,Z.jsx)(R,{leftSection:(0,Z.jsx)($.Icon,{path:O,size:1}),variant:`filled`,onClick:()=>S(!0),children:F(`team.button.create`)})]});return(0,Z.jsx)(n,{minWidth:0,children:(0,Z.jsxs)(se,{requiredRole:C.User,children:[(0,Z.jsxs)(G,{pt:`md`,children:[(0,Z.jsx)(K,{justify:P?`center`:`space-between`,grow:P,children:P?B:(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(c,{}),(0,Z.jsx)(K,{justify:`right`,children:B})]})}),o&&!l&&r&&!i?o.length>0?(0,Z.jsx)(f,{cols:P?1:2,spacing:`xl`,p:P?`sm`:`2rem`,w:`100%`,children:(o||[]).map((e,t)=>(0,Z.jsx)(ce,{team:e,isCaptain:e.members?.some(e=>e?.captain&&e.id===r?.userId)??!1,onEdit:()=>ee(e)},t))}):(0,Z.jsx)(g,{w:`100%`,h:`80vh`,children:(0,Z.jsxs)(G,{align:`center`,gap:`md`,maw:P?`90%`:`100%`,children:[(0,Z.jsx)($.Icon,{path:O,size:4,color:u.colors.gray[5]}),(0,Z.jsx)(M,{order:2,ta:`center`,style:{wordBreak:`break-word`,hyphens:`auto`},children:F(`team.content.no_team.title`)}),(0,Z.jsx)(w,{size:`sm`,c:`dimmed`,ta:`center`,style:{wordBreak:`break-word`,hyphens:`auto`},children:F(`team.content.no_team.hint`)})]})}):(0,Z.jsx)(g,{w:`100%`,h:`80vh`,children:(0,Z.jsx)(te,{})})]}),(0,Z.jsx)(k,{opened:d,title:F(`team.button.join`),onClose:()=>m(!1),children:(0,Z.jsxs)(G,{children:[(0,Z.jsx)(w,{size:`sm`,children:F(`team.content.join`)}),(0,Z.jsx)(p,{label:F(`team.label.invite_code`),type:`text`,placeholder:`team:0:01234567890123456789012345678901`,w:`100%`,value:_,onChange:e=>y(e.currentTarget.value)}),(0,Z.jsx)(R,{fullWidth:!0,variant:`outline`,onClick:L,children:F(`team.button.join`)})]})}),(0,Z.jsx)(ue,{opened:x,title:F(`team.button.create`),disallowCreate:N??!1,onClose:()=>S(!1),mutate:s}),(0,Z.jsx)(pe,{opened:E,title:F(`team.button.edit`),onClose:()=>D(!1),team:A,isCaptain:A?.members?.some(e=>e?.captain&&e.id===r?.userId)??!1})]})})};export{me as default};