/* The GZ::CTF Project @unknown
 * 
 * License   : GNU Affero General Public License v3.0 (Core)
 * License   : LicenseRef-GZCTF-Restricted (Restricted components)
 * Commit    : Unofficial build version
 * Build     : 2025-12-08T11:45:34.456Z
 * Copyright (C) 2022-2025 GZTimeWalker. All Rights Reserved.
 */
import"./lcut4z52.js";import"./cbxtepre.js";import"./isy1dskq.js";import"./kocdnk2i.js";import{t as e}from"./nu4jnu0f.js";import{t}from"./glsbf5jj.js";import"./hrbt7ry7.js";import{t as n}from"./j0saofxo.js";import"./nugqs812.js";import{t as r}from"./bfzgeflf.js";import{t as i}from"./dut9ujr7.js";import{t as a}from"./o417b45d.js";import{t as o}from"./h0nb8b87.js";import{$ as s,Ar as c,Br as l,Ca as u,Cr as d,In as f,Jr as p,Li as m,Mi as h,Mr as g,Nr as _,O as v,Oa as y,Or as b,St as x,T as S,Tr as C,Vr as w,W as T,Yn as E,an as ee,ar as D,b as O,c as k,cr as A,di as j,dr as M,ha as N,i as P,jn as F,jr as I,li as L,o as R,rn as z,s as B,sr as V,tn as H,w as U,yi as W,zn as G}from"./index.hrqptwjo.js";import"./iwhjrhtg.js";import"./mdazlrzp.js";import"./mbfygvvk.js";import{t as K}from"./lvtgxs0o.js";import{n as q}from"./o4secb0i.js";var te=y(v()),J=y(u()),Y=y(N()),X=e=>{if(typeof e==`string`){let t=Number(e);return isNaN(t)?0:t}return e};const ne=e=>{let{id:t}=A(),n=parseInt(t??`-1`),{data:i,mutate:a}=f.edit.useEditGetGame(n,F),[o,s]=(0,J.useState)(!1),[c,l]=(0,J.useState)(0),[u,d]=(0,J.useState)(0),[m,h]=(0,J.useState)(0),{t:g}=M();(0,J.useEffect)(()=>{if(i){let e=new P(i.bloodBonus);l(e.getBonusNum(E.FirstBlood)),d(e.getBonusNum(E.SecondBlood)),h(e.getBonusNum(E.ThirdBlood))}},[i]);let v=async()=>{if(i?.title){s(!0);try{await f.edit.editUpdateGame(n,{...i,bloodBonus:P.fromBonus(c,u,m).value}),a(),e.onClose()}finally{s(!1)}}};return(0,Y.jsx)(_,{...e,children:(0,Y.jsxs)(I,{children:[(0,Y.jsx)(p,{children:g(`admin.content.games.challenges.bonus.description`)}),(0,Y.jsx)(r,{label:g(`admin.content.games.challenges.bonus.first_blood`),defaultValue:5,decimalScale:1,fixedDecimalScale:!0,min:0,step:1,max:100,disabled:o,value:c/10,onChange:e=>l(Math.floor(X(e)*10))}),(0,Y.jsx)(r,{label:g(`admin.content.games.challenges.bonus.second_blood`),defaultValue:3,decimalScale:1,fixedDecimalScale:!0,min:0,step:1,max:100,disabled:o,value:u/10,onChange:e=>d(Math.floor(X(e)*10))}),(0,Y.jsx)(r,{label:g(`admin.content.games.challenges.bonus.third_blood`),defaultValue:1,decimalScale:1,fixedDecimalScale:!0,min:0,step:1,max:100,disabled:o,value:m/10,onChange:e=>h(Math.floor(X(e)*10))}),(0,Y.jsx)(L,{grow:!0,m:`auto`,w:`100%`,children:(0,Y.jsx)(w,{fullWidth:!0,disabled:o,onClick:v,children:g(`admin.button.save`)})})]})})},re=n=>{let{id:r}=A(),{onAddChallenge:i,...a}=n,[s,c]=(0,J.useState)(!1),l=V(),u=U(),p=S(),[m,h]=e(``),[g,v]=(0,J.useState)(null),[y,b]=(0,J.useState)(null),{t:x}=M(),C=async()=>{if(!m||!g||!y)return;c(!0);let e=parseInt(r??`-1`);try{let t=await f.edit.editAddGameChallenge(e,{title:m,category:g,type:y});d({color:`teal`,message:x(`admin.notification.games.challenges.created`),icon:(0,Y.jsx)(te.Icon,{path:T,size:1})}),i(t.data),l(`/admin/games/${r}/challenges/${t.data.id}`)}catch(e){O(e,x)}finally{c(!1)}};return(0,Y.jsx)(_,{...a,children:(0,Y.jsxs)(I,{children:[(0,Y.jsx)(o,{label:x(`admin.content.games.challenges.title`),type:`text`,required:!0,placeholder:`Title`,value:m,onChange:h}),(0,Y.jsx)(t,{required:!0,label:x(`admin.content.games.challenges.category`),placeholder:`Category`,value:g,onChange:v,renderOption:R,data:B.map(e=>{let t=u.get(e);return{value:e,label:t?.name,...t}})}),(0,Y.jsx)(t,{required:!0,label:x(`admin.content.games.challenges.type.label`),description:x(`admin.content.games.challenges.type.description`),placeholder:`Type`,value:y,onChange:b,renderOption:k,data:Object.entries(G).map(e=>{let t=p.get(e[1]);return{value:e[1],label:t?.name,...t}})}),(0,Y.jsx)(w,{fullWidth:!0,disabled:s,onClick:C,children:x(`admin.button.challenges.new`)})]})})};var Z={tooltip:`La`},Q=y(v());const ie=({challenge:e,onToggle:t})=>{let r=U().get(e.category),a=m(),{id:o}=A(),[l,u]=(0,J.useState)(!1),{t:d}=M(),{colorScheme:f}=h(),_=r?.color??a.primaryColor,v=a.colors[_],y=f===`dark`?8:6,b=f===`dark`?6:4,[x,S,C]=[e.minScore??0,e.score??500,e.originalScore??500],w=x/C*100,T=S/C*100,E=`calc(100% - 12rem)`;return(0,Y.jsxs)(n,{shadow:`sm`,p:`sm`,children:[(0,Y.jsxs)(L,{wrap:`nowrap`,justify:`space-between`,gap:`xs`,children:[(0,Y.jsx)(c,{color:_,disabled:l,checked:e.isEnabled,onChange:()=>t(e,u)}),(0,Y.jsx)(Q.Icon,{path:r.icon,color:a.colors[r?.color??a.primaryColor][5],size:1.2}),(0,Y.jsxs)(I,{gap:0,maw:E,miw:E,children:[(0,Y.jsx)(p,{truncate:!0,fw:`bold`,children:e.title}),(0,Y.jsxs)(p,{size:`sm`,fw:`bold`,ff:`monospace`,w:`5rem`,children:[e.score,(0,Y.jsxs)(p,{span:!0,fw:`bold`,c:`dimmed`,children:[`/`,e.originalScore,`pts`]})]})]}),(0,Y.jsx)(g,{label:d(`admin.button.challenges.edit`),position:`left`,offset:10,classNames:Z,children:(0,Y.jsx)(j,{c:_,component:D,to:`/admin/games/${o}/challenges/${e.id}`,children:(0,Y.jsx)(Q.Icon,{path:z,size:1})})}),(0,Y.jsx)(g,{label:d(`admin.button.challenges.edit_more`),ta:`end`,position:`left`,offset:54,classNames:Z,children:(0,Y.jsx)(j,{c:_,component:D,to:`/admin/games/${o}/challenges/${e.id}/flags`,children:(0,Y.jsx)(Q.Icon,{path:s,size:1})})})]}),(0,Y.jsx)(n.Section,{mt:`sm`,children:(0,Y.jsxs)(i.Root,{radius:0,children:[(0,Y.jsx)(i.Section,{value:w,color:v[y]}),(0,Y.jsx)(i.Section,{value:T-w,color:v[b]})]})})]})};var $=y(v(),1),ae=()=>{let{id:e}=A(),n=parseInt(e??`-1`),[r,i]=(0,J.useState)(!1),[o,s]=(0,J.useState)(!1),[c,u]=(0,J.useState)(null),m=U(),[h,g]=(0,J.useState)(!1),{t:_}=M(),{challenges:v,mutate:y}=q(n),S=c&&v?v?.filter(e=>e.category===c):v,E=C(),D=(e,t)=>{E.openConfirmModal({title:e.isEnabled?_(`admin.button.challenges.disable`):_(`admin.button.challenges.enable`),children:(0,Y.jsx)(p,{size:`sm`,children:e.isEnabled?_(`admin.content.games.challenges.disable`,{name:e.title}):_(`admin.content.games.challenges.enable`,{name:e.title})}),onConfirm:()=>k(e,t),confirmProps:{color:`orange`}})},k=async(t,n)=>{let r=parseInt(e??`-1`);n(!0);try{await f.edit.editUpdateGameChallenge(r,t.id,{isEnabled:!t.isEnabled}),d({color:`teal`,message:_(`admin.notification.games.challenges.updated`),icon:(0,Y.jsx)($.Icon,{path:T,size:1})}),y(v?.map(e=>e.id===t.id?{...e,isEnabled:!t.isEnabled}:e))}catch(e){O(e,_)}finally{n(!1)}};return(0,Y.jsxs)(K,{headProps:{justify:`apart`},isLoading:!v,head:(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(t,{placeholder:_(`admin.content.show_all`),clearable:!0,searchable:!0,w:`16rem`,value:c,nothingFoundMessage:_(`admin.content.nothing_found`),onChange:e=>u(e),renderOption:R,data:B.map(e=>{let t=m.get(e);return{value:e,label:t?.name,...t}})}),(0,Y.jsxs)(L,{justify:`right`,children:[(0,Y.jsx)(w,{leftSection:(0,Y.jsx)($.Icon,{path:ee,size:1}),disabled:h,onClick:async()=>{if(n){g(!0);try{await f.edit.editFlushScoreboardCache(n),d({color:`teal`,message:_(`admin.notification.games.info.scoreboard_flushed`),icon:(0,Y.jsx)($.Icon,{path:T,size:1})}),y()}catch(e){O(e,_)}finally{g(!1)}}},children:_(`admin.button.challenges.flush_scoreboard`)}),(0,Y.jsx)(w,{leftSection:(0,Y.jsx)($.Icon,{path:x,size:1}),onClick:()=>s(!0),children:_(`admin.button.challenges.bonus`)}),(0,Y.jsx)(w,{mr:`18px`,leftSection:(0,Y.jsx)($.Icon,{path:H,size:1}),onClick:()=>i(!0),children:_(`admin.button.challenges.new`)})]})]}),children:[(0,Y.jsx)(W,{h:`calc(100vh - 180px)`,pos:`relative`,offsetScrollbars:!0,type:`auto`,children:!S||S.length===0?(0,Y.jsx)(l,{h:`calc(100vh - 200px)`,children:(0,Y.jsxs)(I,{gap:0,children:[(0,Y.jsx)(b,{order:2,children:_(`admin.content.games.challenges.empty.title`)}),(0,Y.jsx)(p,{children:_(`admin.content.games.challenges.empty.description`)})]})}):(0,Y.jsx)(a,{pr:6,cols:{base:2,w18:3,w24:4,w30:5,w36:6,w42:7,w48:8},spacing:`sm`,children:S&&S.map(e=>(0,Y.jsx)(ie,{challenge:e,onToggle:D},e.id))})}),(0,Y.jsx)(re,{title:_(`admin.button.challenges.new`),size:`30%`,opened:r,onClose:()=>i(!1),onAddChallenge:e=>y([e,...v??[]])}),(0,Y.jsx)(ne,{title:_(`admin.button.challenges.bonus`),size:`30%`,opened:o,onClose:()=>s(!1)})]})};export{ae as default};