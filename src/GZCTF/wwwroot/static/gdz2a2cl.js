/* The GZ::CTF Project @unknown
 * 
 * License   : GNU Affero General Public License v3.0 (Core)
 * License   : LicenseRef-GZCTF-Restricted (Restricted components)
 * Commit    : Unofficial build version
 * Build     : 2025-12-08T11:45:34.456Z
 * Copyright (C) 2022-2025 GZTimeWalker. All Rights Reserved.
 */
import"./lcut4z52.js";import"./isy1dskq.js";import{t as e}from"./x5mn38mu.js";import"./kocdnk2i.js";import{c as t}from"./gaobt2im.js";import"./j0saofxo.js";import"./nugqs812.js";import{t as n}from"./gmgm1gqp.js";import"./h0nb8b87.js";import{$n as r,$r as i,Ca as a,Cr as o,Dr as s,Fn as c,Hr as l,In as u,Jr as d,L as f,Li as p,Mi as m,Mr as ee,O as h,Oa as g,W as _,Wi as te,Z as v,_i as y,cr as b,ct as x,di as S,dr as C,gt as w,ha as T,it as E,kn as D,li as O,on as ne,q as k,rt as A,yi as j,z as M}from"./index.hrqptwjo.js";import"./iwhjrhtg.js";import"./mdazlrzp.js";import{t as N}from"./c5hn22cb.js";import{n as P,r as F,t as I}from"./eogutjjz.js";import{n as L,t as R}from"./je83xcx9.js";import"./fmw116au.js";import"./laaps3um.js";import"./odnwo8oc.js";import{t as z}from"./drtvoui5.js";var B=g(h(),1),V=g(s(),1),H=g(a(),1),U=g(T(),1),W=50,G=new Map([[c.Accepted,`AC`],[c.WrongAnswer,`WA`],[c.CheatDetected,`CD`],[c.NotFound,`NF`]]),K=e=>{let t=p(),{colorScheme:n}=m(),r=n===`dark`?4:7;return new Map([[c.Accepted,{path:_,size:e,color:t.colors.green[r]}],[c.WrongAnswer,{path:k,size:e,color:t.colors.red[r]}],[c.NotFound,{path:v,size:e,color:t.colors.gray[r]}],[c.CheatDetected,{path:x,size:e,color:t.colors.orange[r]}],[c.FlagSubmitted,{path:A,size:e,color:t.colors.gray[r]}]])},q=()=>{let{id:a}=b(),s=parseInt(a??`-1`),[m,h]=(0,H.useState)(1),[,g]=(0,H.useState)(new Date),v=(0,H.useRef)([]),[x,T]=(0,H.useState)(),[A,q]=(0,H.useState)(`All`),[J,Y]=(0,H.useState)(!1),{game:X}=t(s),re=K(.8),{classes:ie}=D({ff:`monospace`}),ae=p(),{t:Z}=C(),{locale:oe}=r(),Q=(0,H.useRef)(null);(0,H.useEffect)(()=>{Q.current?.scrollTo({top:0,behavior:`smooth`})},[m,Q]),(0,H.useEffect)(()=>{(async()=>{try{T((await u.game.gameSubmissions(s,{type:A===`All`?void 0:A,count:W,skip:(m-1)*W})).data)}catch(e){o({color:`red`,title:Z(`game.notification.fetch_failed.submission`),message:await L(e),icon:(0,U.jsx)(B.Icon,{path:k,size:1})})}})(),m===1&&(v.current=[])},[m,A,s,Z]),(0,H.useEffect)(()=>{if(X?.end&&new Date<new Date(X.end)){let e=new I().withUrl(`/hub/monitor?game=${s}`).withHubProtocol(new P).withAutomaticReconnect().configureLogging(F.None).build();return e.serverTimeoutInMilliseconds=60*1e3*60*2,e.on(`ReceivedSubmissions`,e=>{console.log(e),v.current=[e,...v.current],g(new Date(e.time))}),(async()=>{try{await e.start(),o({color:`teal`,message:Z(`game.notification.connected.submission`),icon:(0,U.jsx)(B.Icon,{path:_,size:1})})}catch(e){console.error(e)}})(),()=>{e.stop().catch(e=>{console.error(e)})}}},[X,s,Z]);let $=v.current.filter(e=>A===`All`||e.status===A),se=[...m===1?$:[],...x??[]].map((e,t)=>(0,U.jsxs)(n.Tr,{className:te({[N.fade]:t===0&&m===1&&$.length>0}),children:[(0,U.jsx)(n.Td,{children:(0,U.jsx)(B.Icon,{...re.get(e.status??c.FlagSubmitted)})}),(0,U.jsx)(n.Td,{ff:`monospace`,children:(0,U.jsx)(l,{size:`sm`,color:`indigo`,fullWidth:!0,children:(0,V.default)(e.time).locale(oe).format(`SL HH:mm:ss`)})}),(0,U.jsx)(n.Td,{children:(0,U.jsx)(d,{size:`sm`,fw:`bold`,children:e.team??`Team`})}),(0,U.jsx)(n.Td,{children:(0,U.jsx)(d,{ff:`monospace`,size:`sm`,fw:`bold`,children:e.user??`User`})}),(0,U.jsx)(n.Td,{children:e.challenge??`Challenge`}),(0,U.jsx)(n.Td,{w:`36vw`,maw:`100%`,p:`0`,children:(0,U.jsx)(i,{variant:`unstyled`,value:e.answer,readOnly:!0,size:`sm`,classNames:ie})})]},`${e.time}@${t}`)),ce=()=>R(u.game.gameSubmissionSheet(s,{format:`blob`}),Y,Z,`Submission_${s}_${Date.now()}.xlsx`);return(0,U.jsxs)(z,{isLoading:!x,children:[(0,U.jsxs)(O,{justify:`space-between`,w:`100%`,children:[(0,U.jsx)(e,{color:ae.primaryColor,value:A,bg:`transparent`,onChange:e=>{q(e),h(1)},data:[{label:`All`,value:`All`},...Object.entries(c).map(e=>({value:e[1],label:G.get(e[1])})).filter(e=>e.value!==c.FlagSubmitted)]}),(0,U.jsxs)(O,{justify:`right`,children:[(0,U.jsx)(ee,{label:Z(`game.button.download.submissionsheet`),position:`left`,children:(0,U.jsx)(S,{disabled:J,size:`lg`,onClick:ce,children:(0,U.jsx)(B.Icon,{path:E,size:1})})}),(0,U.jsx)(S,{size:`lg`,disabled:m<=1,onClick:()=>h(1),children:(0,U.jsx)(B.Icon,{path:ne,size:1})}),(0,U.jsx)(S,{size:`lg`,disabled:m<=1,onClick:()=>h(m-1),children:(0,U.jsx)(B.Icon,{path:f,size:1})}),(0,U.jsx)(S,{size:`lg`,disabled:x&&x.length<W,onClick:()=>h(m+1),children:(0,U.jsx)(B.Icon,{path:M,size:1})})]})]}),(0,U.jsx)(y,{shadow:`md`,p:`md`,children:(0,U.jsx)(j,{viewportRef:Q,offsetScrollbars:!0,h:`calc(100vh - 200px)`,children:(0,U.jsxs)(n,{className:N.table,children:[(0,U.jsx)(n.Thead,{children:(0,U.jsxs)(n.Tr,{children:[(0,U.jsx)(n.Th,{w:`0.6rem`,children:(0,U.jsx)(O,{align:`center`,children:(0,U.jsx)(B.Icon,{path:w,size:.8})})}),(0,U.jsx)(n.Th,{w:`7rem`,children:Z(`common.label.time`)}),(0,U.jsx)(n.Th,{miw:`4.5rem`,children:Z(`common.label.team`)}),(0,U.jsx)(n.Th,{miw:`4.5rem`,children:Z(`common.label.user`)}),(0,U.jsx)(n.Th,{miw:`3rem`,children:Z(`common.label.challenge`)}),(0,U.jsx)(n.Th,{ff:`monospace`,children:Z(`common.label.flag`)})]})}),(0,U.jsx)(n.Tbody,{children:se})]})})})]})};export{q as default};