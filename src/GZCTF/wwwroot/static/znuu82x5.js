/* The GZ::CTF Project @unknown
 * 
 * License   : GNU Affero General Public License v3.0 (Core)
 * License   : LicenseRef-GZCTF-Restricted (Restricted components)
 * Commit    : Unofficial build version
 * Build     : 2025-12-08T11:45:34.456Z
 * Copyright (C) 2022-2025 GZTimeWalker. All Rights Reserved.
 */
import"./lcut4z52.js";import"./isy1dskq.js";import"./kocdnk2i.js";import{c as e}from"./gaobt2im.js";import{t}from"./j0saofxo.js";import"./nugqs812.js";import"./h0nb8b87.js";import{$i as n,$n as r,$r as ee,Ar as i,Ca as a,Cr as o,Dr as s,Fn as c,Hn as l,In as u,Jr as d,L as f,Li as p,M as m,Mi as h,Mt as g,O as _,Oa as v,P as y,W as b,Wi as x,cr as S,ct as C,di as w,dr as T,gt as E,ha as D,jr as O,kn as k,li as A,on as te,q as ne,vn as j,yi as M,yn as N,z as P}from"./index.hrqptwjo.js";import"./iwhjrhtg.js";import"./mdazlrzp.js";import{t as F}from"./c5hn22cb.js";import{n as I,r as L,t as R}from"./eogutjjz.js";import{n as z}from"./je83xcx9.js";import{t as B}from"./bok6ip78.js";import"./fmw116au.js";import"./laaps3um.js";import"./odnwo8oc.js";import{t as V}from"./drtvoui5.js";var H=v(_(),1),U=v(s(),1),W=v(a(),1),G=v(D(),1),K=30,q=e=>{let t=p(),{colorScheme:n}=h();return(0,W.useMemo)(()=>{let r=n===`dark`?5:6;return new Map([[l.FlagSubmit,{path:E,size:e,color:t.colors.cyan[r]}],[l.ContainerStart,{path:N,size:e,color:t.colors.green[r]}],[l.ContainerDestroy,{path:j,size:e,color:t.colors.red[r]}],[l.CheatDetected,{path:C,size:e,color:t.colors.orange[r]}],[l.Normal,{path:g,size:e,color:t.colors.light[r]}]])},[e,n,t.colors])},J=(e,t)=>{switch(t){case c.Accepted:return e(`game.event.answer.accepted`);case c.WrongAnswer:return e(`game.event.answer.wrong`);case c.CheatDetected:return e(`game.event.answer.cheat`);case c.FlagSubmitted:return e(`game.event.answer.submitted`);case c.NotFound:return e(`game.event.answer.not_found`);default:return``}},Y=(e,t)=>{switch(t.type){case l.Normal:return t.values.at(-1)||``;case l.FlagSubmit:return e(`game.event.flag_submit`,{status:J(e,t.values.at(0)),flag:t.values.at(1),chal:t.values.at(2),id:t.values.at(3)});case l.CheatDetected:return e(`game.event.cheat_detected`,{chal:t.values.at(0),team:t.values.at(1),steam:t.values.at(2)});case l.ContainerStart:return e(`game.event.container.start`,{id:t.values.at(0),chal:t.values.at(1)});case l.ContainerDestroy:return e(`game.event.container.destroy`,{id:t.values.at(0),chal:t.values.at(1)});default:return t.values.at(-1)||``}},X=({path:e,content:t})=>(0,G.jsxs)(A,{gap:3,wrap:`nowrap`,children:[(0,G.jsx)(H.Icon,{path:e,size:.75,color:`var(--mantine-color-dimmed)`}),(0,G.jsx)(d,{size:`sm`,fw:500,c:`dimmed`,children:t})]}),Z=()=>{let{id:a}=S(),s=parseInt(a??`-1`),[c,p]=n({key:`hide-container-events`,defaultValue:!1,getInitialValueInEffect:!1}),{locale:h}=r(),[g,_]=(0,W.useState)(1),[,v]=(0,W.useState)(new Date),C=(0,W.useRef)([]),[E,D]=(0,W.useState)(),{game:j}=e(s),N=q(1.15),{classes:J}=k({fw:500}),{t:Z}=T(),Q=(0,W.useRef)(null);(0,W.useEffect)(()=>{Q.current?.scrollTo({top:0,behavior:`smooth`})},[g,Q]),(0,W.useEffect)(()=>{(async()=>{try{D((await u.game.gameEvents(s,{hideContainer:c,count:K,skip:(g-1)*K})).data)}catch(e){o({color:`red`,title:Z(`game.notification.fetch_failed.event`),message:await z(e),icon:(0,G.jsx)(H.Icon,{path:ne,size:1})})}})(),g===1&&(C.current=[])},[g,c,s,Z]),(0,W.useEffect)(()=>{if(j?.end&&new Date<new Date(j.end)){let e=new R().withUrl(`/hub/monitor?game=${s}`).withHubProtocol(new I).withAutomaticReconnect().configureLogging(L.None).build();return e.serverTimeoutInMilliseconds=60*1e3*60*2,e.on(`ReceivedGameEvent`,e=>{console.log(e),C.current=[e,...C.current],v(new Date(e.time))}),(async()=>{try{await e.start(),o({color:`teal`,message:Z(`game.notification.connected.event`),icon:(0,G.jsx)(H.Icon,{path:b,size:1})})}catch(e){console.error(e)}})(),()=>{e.stop().catch(e=>{console.error(e)})}}},[j,s,Z]);let $=C.current.filter(e=>!c||e.type!==l.ContainerStart&&e.type!==l.ContainerDestroy);return(0,G.jsxs)(V,{isLoading:!E,children:[(0,G.jsxs)(A,{justify:`space-between`,w:`100%`,children:[(0,G.jsx)(i,{label:B(Z(`game.content.hide_container_events.label`),Z(`game.content.hide_container_events.description`)),checked:c,onChange:e=>p(e.currentTarget.checked)}),(0,G.jsxs)(A,{justify:`right`,children:[(0,G.jsx)(w,{size:`lg`,disabled:g<=1,onClick:()=>_(1),children:(0,G.jsx)(H.Icon,{path:te,size:1})}),(0,G.jsx)(w,{size:`lg`,disabled:g<=1,onClick:()=>_(g-1),children:(0,G.jsx)(H.Icon,{path:f,size:1})}),(0,G.jsx)(w,{size:`lg`,disabled:E&&E.length<K,onClick:()=>_(g+1),children:(0,G.jsx)(H.Icon,{path:P,size:1})})]})]}),(0,G.jsx)(M,{viewportRef:Q,offsetScrollbars:!0,h:`calc(100vh - 160px)`,children:(0,G.jsx)(O,{gap:`xs`,pr:10,w:`100%`,children:[...g===1?$:[],...E??[]]?.map((e,n)=>(0,G.jsx)(t,{shadow:`sm`,radius:`sm`,p:`xs`,className:x({[F.fade]:n===0&&g===1&&$.length>0}),children:(0,G.jsxs)(A,{wrap:`nowrap`,align:`flex-start`,justify:`right`,gap:`sm`,w:`100%`,children:[(0,G.jsx)(H.Icon,{...N.get(e.type)}),(0,G.jsxs)(O,{gap:2,w:`100%`,children:[(0,G.jsx)(ee,{variant:`unstyled`,value:Y(Z,e),readOnly:!0,size:`md`,classNames:J}),(0,G.jsxs)(A,{wrap:`nowrap`,justify:`space-between`,children:[(0,G.jsxs)(A,{gap:`sm`,wrap:`nowrap`,children:[(0,G.jsx)(X,{path:y,content:e.user}),(0,G.jsx)(X,{path:m,content:e.team})]}),(0,G.jsx)(d,{size:`xs`,fw:500,c:`dimmed`,children:(0,U.default)(e.time).locale(h).format(`SL LTS`)})]})]})]})},`${e.time}@${n}`))})})]})};export{Z as default};