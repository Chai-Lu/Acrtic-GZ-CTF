/* The GZ::CTF Project @unknown
 * 
 * License   : GNU Affero General Public License v3.0 (Core)
 * License   : LicenseRef-GZCTF-Restricted (Restricted components)
 * Commit    : Unofficial build version
 * Build     : 2025-12-08T11:45:34.456Z
 * Copyright (C) 2022-2025 GZTimeWalker. All Rights Reserved.
 */
import"./lcut4z52.js";import"./cbxtepre.js";import"./isy1dskq.js";import"./kocdnk2i.js";import{t as e}from"./f25gev77.js";import{t}from"./nu4jnu0f.js";import{t as n}from"./glsbf5jj.js";import"./hrbt7ry7.js";import{t as r}from"./kpl3u1sg.js";import{t as i}from"./nugqs812.js";import{t as a}from"./h0nb8b87.js";import{$r as o,B as s,Br as c,Ca as l,Cr as u,E as d,Hr as f,In as p,Jr as m,Kn as h,Li as g,M as ee,Nr as _,O as v,Oa as y,Or as te,P as b,Qt as x,Ti as S,Tt as C,Ur as w,Vr as T,W as E,Wi as ne,Xt as D,Yr as O,b as k,cr as A,di as j,dn as M,dr as N,ha as P,jn as re,jr as F,li as I,ot as L,q as R,sr as z,yi as B}from"./index.hrqptwjo.js";import"./iwhjrhtg.js";import"./cjpezv9m.js";import"./mdazlrzp.js";import"./mbfygvvk.js";import{t as V}from"./lvtgxs0o.js";import{n as H,t as U}from"./yb0kdwg6.js";var W=y(v(),1),G=y(l()),K=y(P());const ie=e=>{let{participateId:t,divisions:r,currentDivisionId:i,setParticipation:a,...o}=e,[s,c]=(0,G.useState)(i?i.toString():``),[l,u]=(0,G.useState)(!1),{t:d}=N(),f=(0,G.useMemo)(()=>r.map(e=>({value:e.id.toString(),label:e.name})),[r]);(0,G.useEffect)(()=>{c(i?i.toString():``),u(!1)},[i,o.opened]);let p=async()=>{let e=s?parseInt(s,10):null;if((i??null)===e){o.onClose();return}u(!0);try{await a(t,{divisionId:e}),o.onClose()}finally{u(!1)}};return(0,K.jsx)(_,{...o,children:(0,K.jsxs)(F,{children:[(0,K.jsx)(n,{label:d(`game.content.join.division.label`),data:f,clearable:!0,disabled:l,value:s,placeholder:d(`admin.content.games.review.participation.no_division`),onChange:e=>c(e??``)}),(0,K.jsx)(T,{fullWidth:!0,disabled:l,onClick:p,children:d(`common.modal.confirm_update`)})]})})};var q={root:`O_`,col:`P_`,input:`Q_`},J={size:.9,color:`gray`},Y=e=>{let{user:t,isCaptain:n,isRegistered:i}=e,a=g(),{t:c}=N();return(0,K.jsxs)(I,{wrap:`nowrap`,gap:`xl`,justify:`space-between`,children:[(0,K.jsxs)(I,{wrap:`nowrap`,w:`calc(100% - 16rem)`,miw:`500px`,children:[(0,K.jsx)(w,{alt:`avatar`,src:t.avatar,children:t.userName?.slice(0,1)??`U`}),(0,K.jsxs)(r,{className:q.root,children:[(0,K.jsxs)(r.Col,{span:3,className:q.col,children:[(0,K.jsx)(W.Icon,{path:C,...J}),(0,K.jsx)(m,{fw:`bold`,lineClamp:1,children:t.userName})]}),(0,K.jsxs)(r.Col,{span:3,className:q.col,children:[(0,K.jsx)(W.Icon,{path:s,...J}),(0,K.jsx)(o,{variant:`unstyled`,value:t.stdNumber||c(`admin.placeholder.empty`),readOnly:!0,classNames:{input:q.input}})]}),(0,K.jsxs)(r.Col,{span:6,className:q.col,children:[(0,K.jsx)(W.Icon,{path:L,...J}),(0,K.jsx)(m,{children:t.email||c(`admin.placeholder.empty`)})]}),(0,K.jsxs)(r.Col,{span:6,className:q.col,children:[(0,K.jsx)(W.Icon,{path:b,...J}),(0,K.jsx)(o,{variant:`unstyled`,value:t.realName||c(`admin.placeholder.empty`),readOnly:!0,classNames:{input:q.input}})]}),(0,K.jsxs)(r.Col,{span:6,className:q.col,children:[(0,K.jsx)(W.Icon,{path:x,...J}),(0,K.jsx)(m,{children:t.phone||c(`admin.placeholder.empty`)})]})]})]}),(0,K.jsxs)(I,{wrap:`nowrap`,justify:`right`,children:[n&&(0,K.jsxs)(I,{gap:0,children:[(0,K.jsx)(W.Icon,{path:`M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z`,color:a.colors.yellow[4],size:.9}),(0,K.jsx)(m,{size:`sm`,fw:500,c:`yellow`,children:c(`team.content.role.captain`)})]}),(0,K.jsx)(m,{size:`sm`,fw:`bold`,c:i?`teal`:`orange`,children:c(i?`admin.content.games.review.participation.joined`:`admin.content.games.review.participation.not_joined`)})]})]})},ae=e=>{let{participation:t,disabled:n,onEditDiv:r,setParticipation:a,hasDivisions:o,divisionName:s}=e,l=d().get(t.status),{t:u}=N();return(0,K.jsxs)(O.Item,{value:t.id.toString(),children:[(0,K.jsx)(S,{className:i.alignCenter,display:`flex`,children:(0,K.jsx)(O.Control,{children:(0,K.jsxs)(I,{justify:`space-between`,wrap:`nowrap`,children:[(0,K.jsxs)(I,{wrap:`nowrap`,miw:0,children:[(0,K.jsx)(w,{alt:`avatar`,src:t.team?.avatar,children:t.team?.name?t.team.name.slice(0,1):`T`}),(0,K.jsxs)(S,{children:[(0,K.jsx)(m,{fw:500,children:t.team?.name?t.team.name:u(`admin.placeholder.games.participation.team`)}),(0,K.jsx)(m,{lineClamp:1,size:`sm`,c:`dimmed`,children:t.team?.bio?t.team.bio:u(`admin.placeholder.games.participation.bio`)})]})]}),(0,K.jsxs)(I,{wrap:`nowrap`,justify:`space-between`,w:`35%`,miw:`370px`,children:[(0,K.jsxs)(S,{w:`10em`,children:[o&&t.status!==h.Rejected&&(0,K.jsxs)(I,{gap:0,wrap:`nowrap`,children:[(0,K.jsx)(m,{fz:`sm`,fw:`bold`,truncate:!0,children:s??u(`admin.content.games.review.participation.no_division`)}),(0,K.jsx)(j,{size:`sm`,onClick:r,disabled:n,children:(0,K.jsx)(W.Icon,{path:`M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z`,size:.6})})]}),(0,K.jsx)(m,{size:`sm`,c:`dimmed`,fw:`bold`,children:u(`admin.content.games.review.participation.stats`,{count:t.registeredMembers?.length??0,total:t.team?.members?.length??0})})]}),(0,K.jsx)(c,{miw:`5.5em`,children:(0,K.jsx)(f,{color:l.color,children:l.title})}),(0,K.jsx)(H,{disabled:n,participation:t,setParticipation:a})]})]})})}),(0,K.jsx)(O.Panel,{children:(0,K.jsx)(F,{children:t.team?.members?.map(e=>(0,K.jsx)(Y,{user:e,isRegistered:t.registeredMembers?.some(t=>t===e.userId)??!1,isCaptain:t.team?.captainId===e.userId},e.userId))})})]})},X=10,Z=()=>{let r=z(),{id:o}=A(),s=parseInt(o??`-1`,10),[l,f]=(0,G.useState)(!1),[g,_]=(0,G.useState)(null),[v,y]=(0,G.useState)(null),[b,x]=(0,G.useState)(),[S,C]=t(``),w=d(),[T,D]=(0,G.useState)(!1),[j,M]=(0,G.useState)(null),{t:P}=N(),[L,H]=(0,G.useState)(1),{data:q}=p.edit.useEditGetDivisions(s,re,s>0),J=(0,G.useMemo)(()=>{let e=new Map;return q?.forEach(t=>{e.set(t.id,t.name&&t.name.trim().length>0?t.name:`#${t.id}`)}),e},[q]),Y=(0,G.useMemo)(()=>{let e=new Map;return q?.forEach(t=>{let n=t.id.toString();e.set(n,{value:n,label:J.get(t.id)??`#${t.id}`})}),b?.forEach(t=>{if(t.divisionId!==void 0&&t.divisionId!==null){let n=t.divisionId.toString();e.has(n)||e.set(n,{value:n,label:`#${t.divisionId}`})}}),Array.from(e.values()).sort((e,t)=>e.label.localeCompare(t.label))},[q,J,b]),Z=(q?.length??0)>0,Q=async(e,t)=>{f(!0);try{await p.admin.adminParticipation(e,t),x(n=>n?.map(n=>{if(n.id!==e)return n;let r={...n};return t.status&&(r.status=t.status),t.divisionId!==void 0&&(r.divisionId=t.divisionId),t.status===h.Rejected&&(r.divisionId=null),r})),u({color:`teal`,message:P(`admin.notification.games.participation.updated`),icon:(0,K.jsx)(W.Icon,{path:E,size:1})})}catch(e){k(e,P)}finally{f(!1)}};(0,G.useEffect)(()=>{H(1)},[g,v,S]),(0,G.useEffect)(()=>{if(s<0){u({color:`red`,message:P(`common.error.param_error`),icon:(0,K.jsx)(W.Icon,{path:R,size:1})}),r(`/admin/games`);return}(async()=>{try{x((await p.game.gameParticipations(s)).data)}catch(e){k(e,P)}})()},[r,s,P]);let $=b?.filter(e=>{let t=g===null||e.status===g,n=v===null||e.divisionId!==void 0&&e.divisionId!==null&&e.divisionId.toString()===v,r=S===``||e.team?.name?.toLowerCase().includes(S.toLowerCase());return t&&n&&r}),oe=$?.slice((L-1)*X,L*X);return(0,K.jsxs)(V,{headProps:{justify:`apart`},isLoading:b===void 0||s>0&&q===void 0,head:(0,K.jsxs)(I,{justify:`space-between`,wrap:`nowrap`,w:`100%`,children:[(0,K.jsx)(a,{w:`20rem`,placeholder:P(`admin.placeholder.teams.search`),value:S,onChange:C,rightSection:(0,K.jsx)(W.Icon,{path:ee,size:1})}),(0,K.jsxs)(I,{justify:`right`,wrap:`nowrap`,children:[Y.length>0&&(0,K.jsx)(n,{placeholder:P(`admin.content.show_all`),clearable:!0,data:Y,value:v,onChange:e=>y(e)}),(0,K.jsx)(n,{placeholder:P(`admin.content.show_all`),clearable:!0,data:Array.from(w,e=>({value:e[0],label:e[1].title})),value:g,onChange:e=>_(e)})]})]}),children:[(0,K.jsx)(B,{type:`never`,pos:`relative`,h:`calc(100vh - 250px)`,children:b&&b.length===0?(0,K.jsx)(c,{h:`calc(100vh - 200px)`,children:(0,K.jsxs)(F,{gap:0,children:[(0,K.jsx)(te,{order:2,children:P(`admin.content.games.review.empty.title`)}),(0,K.jsx)(m,{children:P(`admin.content.games.review.empty.description`)})]})}):(0,K.jsx)(O,{variant:`contained`,chevronPosition:`left`,classNames:U,className:U.root,children:oe?.map(e=>(0,K.jsx)(ae,{participation:e,disabled:l,onEditDiv:()=>{Z&&(M(e),D(!0))},setParticipation:Q,hasDivisions:Z,divisionName:e.divisionId?J.get(e.divisionId):null},e.id))})}),(0,K.jsx)(e,{value:L,onChange:H,total:Math.ceil(($?.length??1)/X),classNames:{root:ne(i.flex,i.flexRow,i.justifyEnd)}}),Z&&j&&(0,K.jsx)(ie,{title:P(`admin.content.games.review.edit_division`),opened:T,divisions:q??[],participateId:j?.id??-1,currentDivisionId:j?.divisionId??null,setParticipation:Q,onClose:()=>{D(!1),M(null)}})]})};export{Z as default};