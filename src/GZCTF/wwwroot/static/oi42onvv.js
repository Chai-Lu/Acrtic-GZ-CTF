/* The GZ::CTF Project @unknown
 * 
 * License   : GNU Affero General Public License v3.0 (Core)
 * License   : LicenseRef-GZCTF-Restricted (Restricted components)
 * Commit    : Unofficial build version
 * Build     : 2025-12-08T11:45:34.456Z
 * Copyright (C) 2022-2025 GZTimeWalker. All Rights Reserved.
 */
import{r as e}from"./lcut4z52.js";import"./cbxtepre.js";import{t}from"./isy1dskq.js";import{t as n}from"./ltc052rv.js";import{t as r}from"./kocdnk2i.js";import{t as i}from"./nu4jnu0f.js";import{t as a}from"./kpl3u1sg.js";import{s as o,t as s}from"./nugqs812.js";import{t as c}from"./gjb4rijj.js";import"./dut9ujr7.js";import{t as l}from"./o417b45d.js";import{t as u}from"./h0nb8b87.js";import{t as d}from"./lj7msjkh.js";import{An as f,Br as p,Ca as m,Cr as h,In as g,Jr as _,Lr as ee,Nr as v,O as y,Oa as b,Or as x,Pn as S,Rr as C,S as w,Sr as T,Ti as E,Ur as D,Vr as O,W as k,_i as A,b as j,dr as M,ha as N,jr as P,li as F,p as te,q as I,sr as L,wr as R}from"./index.hrqptwjo.js";import{t as z}from"./o7hpfmlv.js";import{t as B}from"./pbjgqd5h.js";var V=b(m(),1),H=b(y()),U=b(N());const W=e=>{let[t,n]=i(``),[r,a]=i(``),[o,s]=i(``),l=L(),{t:u}=M(),{config:d}=S(),f=async()=>{if(!r||!o)h({color:`red`,title:u(`account.password.empty`),message:u(`common.error.check_input`),icon:(0,U.jsx)(H.Icon,{path:I,size:1})});else if(r===o)try{await g.account.accountChangePassword({old:await z(u,t,d.apiPublicKey),new:await z(u,r,d.apiPublicKey)}),h({color:`teal`,message:u(`account.notification.profile.password_updated`),icon:(0,U.jsx)(H.Icon,{path:k,size:1})}),e.onClose(),g.account.accountLogOut(),l(`/account/login`)}catch(e){j(e,u)}else h({color:`red`,title:u(`account.password.not_match`),message:u(`common.error.check_input`),icon:(0,U.jsx)(H.Icon,{path:I,size:1})})};return(0,U.jsx)(v,{...e,children:(0,U.jsxs)(P,{children:[(0,U.jsx)(c,{required:!0,label:u(`account.label.password_old`),placeholder:`P4ssW@rd`,w:`100%`,value:t,onChange:n}),(0,U.jsx)(B,{value:r,onChange:a}),(0,U.jsx)(c,{required:!0,label:u(`account.label.password_retype`),placeholder:`P4ssW@rd`,w:`100%`,value:o,onChange:s}),(0,U.jsxs)(F,{justify:`right`,children:[(0,U.jsx)(O,{variant:`default`,onClick:()=>{n(``),a(``),s(``),e.onClose()},children:u(`common.modal.cancel`)}),(0,U.jsx)(O,{color:`orange`,onClick:f,children:u(`common.modal.confirm_update`)})]})]})})};var G=b(y(),1),K=()=>{let[i,c]=(0,V.useState)(!1),{user:m,mutate:y}=e(),[b,S]=(0,V.useState)({userName:m?.userName,bio:m?.bio,stdNumber:m?.stdNumber,phone:m?.phone,realName:m?.realName}),[N,L]=(0,V.useState)(null),[z,B]=(0,V.useState)(!1),[H,K]=(0,V.useState)(!1),[q,J]=(0,V.useState)(!1),[Y,X]=(0,V.useState)(``),Z=f(),{t:Q}=M();r(Q(`account.title.profile`)),(0,V.useEffect)(()=>{S({userName:m?.userName,bio:m?.bio,stdNumber:m?.stdNumber,phone:m?.phone,realName:m?.realName})},[m]);let ne=async()=>{if(N){B(!0),T.clean(),h({id:`upload-avatar`,color:`orange`,message:Q(`common.avatar.uploading`),loading:!0,autoClose:!1});try{await g.account.accountAvatar({file:N}),R({id:`upload-avatar`,color:`teal`,message:Q(`common.avatar.uploaded`),icon:(0,U.jsx)(G.Icon,{path:k,size:1}),autoClose:!0,loading:!1}),B(!1),y(),L(null)}catch(e){R({id:`upload-avatar`,color:`red`,title:Q(`common.avatar.upload_failed`),message:w(e,Q),icon:(0,U.jsx)(G.Icon,{path:I,size:1}),autoClose:!0,loading:!1})}finally{B(!1),c(!1)}}},re=async()=>{try{B(!0),await g.account.accountUpdate(b),h({color:`teal`,message:Q(`account.notification.profile.profile_updated`),icon:(0,U.jsx)(G.Icon,{path:k,size:1})}),y({...m})}catch(e){j(e,Q)}},ie=async()=>{if(Y)try{(await g.account.accountChangeEmail({newMail:Y})).data.data?h({color:`teal`,title:Q(`common.email.sent.title`),message:Q(`common.email.sent.message`),icon:(0,U.jsx)(G.Icon,{path:k,size:1})}):y({...m,email:Y})}catch(e){j(e,Q)}finally{B(!1)}},$=(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(x,{order:2,children:Q(`account.title.profile`)}),(0,U.jsx)(C,{mt:`xs`,mb:`md`}),(0,U.jsxs)(P,{gap:`md`,m:`auto`,children:[(0,U.jsxs)(F,{wrap:`nowrap`,children:[(0,U.jsx)(u,{label:Q(`account.label.username`),type:`text`,w:`100%`,value:b.userName??`ctfer`,disabled:z,onChange:e=>S({...b,userName:e.target.value})}),(0,U.jsx)(p,{children:(0,U.jsx)(D,{alt:`avatar`,radius:40,size:80,src:m?.avatar,onClick:()=>c(!0),children:m?.userName?.slice(0,1)??`U`})})]}),(0,U.jsxs)(l,{cols:2,children:[(0,U.jsx)(u,{label:Q(`account.label.email`),type:`email`,w:`100%`,value:m?.email??`ctfer@gzti.me`,disabled:!0,readOnly:!0}),(0,U.jsx)(u,{label:Q(`account.label.phone`),type:`tel`,w:`100%`,value:b.phone??``,disabled:z,onChange:e=>S({...b,phone:e.target.value})}),(0,U.jsx)(u,{label:Q(`account.label.student_id`),type:`text`,w:`100%`,value:b.stdNumber??``,disabled:z,onChange:e=>S({...b,stdNumber:e.target.value})}),(0,U.jsx)(u,{label:Q(`account.label.real_name`),type:`text`,w:`100%`,value:b.realName??``,disabled:z,onChange:e=>S({...b,realName:e.target.value})})]}),(0,U.jsx)(ee,{label:Q(`account.label.bio`),value:b.bio??Q(`account.placeholder.bio`),w:`100%`,disabled:z,autosize:!0,minRows:2,maxRows:4,onChange:e=>S({...b,bio:e.target.value})}),(0,U.jsx)(E,{m:`auto`,w:`100%`,children:(0,U.jsxs)(a,{grow:!0,children:[(0,U.jsx)(a.Col,{span:4,children:(0,U.jsx)(O,{fullWidth:!0,variant:`outline`,disabled:z,onClick:()=>K(!0),children:Q(`account.button.update_email`)})}),(0,U.jsx)(a.Col,{span:4,children:(0,U.jsx)(O,{fullWidth:!0,variant:`outline`,disabled:z,onClick:()=>J(!0),children:Q(`account.button.change_password`)})}),(0,U.jsx)(a.Col,{span:4,children:(0,U.jsx)(O,{fullWidth:!0,disabled:z,onClick:re,children:Q(`account.button.save_profile`)})})]})})]})]});return(0,U.jsxs)(t,{minWidth:0,children:[Z?(0,U.jsx)(E,{mt:`md`,p:`sm`,children:$}):(0,U.jsx)(p,{h:`100vh`,children:(0,U.jsx)(A,{w:`55%`,maw:600,shadow:`sm`,p:`5%`,children:$})}),(0,U.jsx)(W,{opened:q,onClose:()=>J(!1),title:Q(`account.button.change_password`)}),(0,U.jsx)(v,{opened:H,onClose:()=>K(!1),title:Q(`account.button.update_email`),children:(0,U.jsxs)(P,{children:[(0,U.jsx)(_,{children:(0,U.jsx)(d,{i18nKey:`account.content.profile.update_email_note`})}),(0,U.jsx)(u,{required:!0,label:Q(`account.label.email_new`),type:`email`,w:`100%`,placeholder:m?.email??`ctfer@gzti.me`,value:Y,onChange:e=>X(e.target.value)}),(0,U.jsxs)(F,{justify:`right`,children:[(0,U.jsx)(O,{variant:`default`,onClick:()=>{X(m?.email??``),K(!1)},children:Q(`common.modal.cancel`)}),(0,U.jsx)(O,{color:`orange`,onClick:ie,children:Q(`common.modal.confirm`)})]})]})}),(0,U.jsxs)(v,{opened:i,onClose:()=>c(!1),withCloseButton:!1,children:[(0,U.jsx)(n,{onDrop:e=>L(e[0]),onReject:()=>{h({color:`red`,title:Q(`common.error.file_invalid.title`),message:Q(`common.error.file_invalid.message`),icon:(0,U.jsx)(G.Icon,{path:I,size:1})})},m:`0 auto 20px auto`,miw:220,mih:220,maxSize:3*1024*1024,accept:te,children:(0,U.jsx)(F,{justify:`center`,gap:`xl`,mih:240,className:s.noPointerEvents,children:N?(0,U.jsx)(o,{fit:`contain`,src:URL.createObjectURL(N),alt:`avatar`}):(0,U.jsxs)(E,{children:[(0,U.jsx)(_,{size:`xl`,inline:!0,children:Q(`common.content.drop_zone.content`,{type:Q(`common.content.drop_zone.type.avatar`)})}),(0,U.jsx)(_,{size:`sm`,c:`dimmed`,inline:!0,mt:7,children:Q(`common.content.drop_zone.limit`)})]})})}),(0,U.jsx)(O,{fullWidth:!0,variant:`outline`,disabled:z,onClick:ne,children:Q(`common.avatar.save`)})]})]})};export{K as default};