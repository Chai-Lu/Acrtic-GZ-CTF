/* The GZ::CTF Project @unknown
 * 
 * License   : GNU Affero General Public License v3.0 (Core)
 * License   : LicenseRef-GZCTF-Restricted (Restricted components)
 * Commit    : Unofficial build version
 * Build     : 2025-12-08T11:45:34.456Z
 * Copyright (C) 2022-2025 GZTimeWalker. All Rights Reserved.
 */
import"./lcut4z52.js";import"./cbxtepre.js";import"./isy1dskq.js";import"./kocdnk2i.js";import{t as e}from"./nu4jnu0f.js";import{i as t,n}from"./gaobt2im.js";import"./j0saofxo.js";import{t as r}from"./lquea752.js";import{t as i}from"./nugqs812.js";import{t as a}from"./dut9ujr7.js";import"./o417b45d.js";import{t as o}from"./gmgm1gqp.js";import{t as s}from"./h0nb8b87.js";import{t as c}from"./mi2mv45h.js";import{t as l}from"./lj7msjkh.js";import{Ar as u,Ca as d,Cn as f,Cr as p,Dr as m,G as h,Hr as g,In as _,Jr as v,L as y,Li as b,Nr as x,O as S,Oa as C,Ri as w,Ur as ee,Vr as T,W as E,Zt as D,_i as O,ar as k,b as A,di as j,dr as M,ha as N,jr as P,li as F,q as I,sr as L,tn as R,yi as z,z as B,zr as V}from"./index.hrqptwjo.js";import"./iwhjrhtg.js";import"./mdazlrzp.js";import{t as H}from"./mbfygvvk.js";import{t as U}from"./c5hn22cb.js";import{t as W}from"./l7haotmn.js";import{t as G}from"./gtptignr.js";var K=C(S()),q=C(m()),J=C(d()),Y=C(N());const te=t=>{let{onAddGame:n,...r}=t,[i,a]=(0,J.useState)(!1),o=L(),[l,u]=e(``),[d,f]=e((0,q.default)()),[m,h]=e((0,q.default)().add(2,`h`)),{t:g}=M(),v=async()=>{if(!l||m<d){p({color:`red`,title:g(`common.error.param_invalid`),message:g(`admin.notification.games.no_title_time`),icon:(0,Y.jsx)(K.Icon,{path:I,size:1})});return}a(!0);try{let e=await _.edit.editAddGame({title:l,start:d.valueOf(),end:m.valueOf()});p({color:`teal`,message:g(`admin.notification.games.created`),icon:(0,Y.jsx)(K.Icon,{path:E,size:1})}),n(e.data),o(`/admin/games/${e.data.id}/info`)}catch(e){A(e,g),a(!1)}};return(0,Y.jsx)(x,{size:`30%`,title:g(`admin.button.games.new`),...r,children:(0,Y.jsxs)(P,{children:[(0,Y.jsx)(s,{label:g(`admin.content.games.info.title.label`),type:`text`,required:!0,w:`100%`,value:l,onChange:u}),(0,Y.jsx)(c,{label:g(`admin.content.games.info.start_time`),size:`sm`,value:d.toDate(),valueFormat:`L LT`,clearable:!1,onChange:e=>{let t=(0,q.default)(e);f(t),t&&m<t&&h(t.add(2,`h`))},required:!0}),(0,Y.jsx)(c,{label:g(`admin.content.games.info.end_time`),size:`sm`,minDate:d.toDate(),valueFormat:`L LT`,value:m.toDate(),clearable:!1,onChange:e=>{h((0,q.default)(e))},error:m<d,required:!0}),(0,Y.jsx)(F,{grow:!0,m:`auto`,w:`100%`,children:(0,Y.jsx)(T,{fullWidth:!0,disabled:i,onClick:v,children:g(`admin.button.games.new`)})})]})})};var X=C(S(),1),Z=C(m(),1),Q=30,$=()=>{let[e,s]=(0,J.useState)(1),[c,d]=(0,J.useState)(!1),[p,m]=(0,J.useState)(!1),[h,x]=(0,J.useState)(0),{data:S,total:C,setData:E,updateData:D}=W(),[N,P]=(0,J.useState)(0),I=L(),{t:K}=M(),q=b(),$=async e=>{if(e.id){m(!0);try{await _.edit.editUpdateGame(e.id,{...e,hidden:!e.hidden}),S&&D(S.map(t=>t.id===e.id?{...t,hidden:!t.hidden}:t))}catch(e){A(e,K)}finally{m(!1)}}};return(0,J.useEffect)(()=>{(async()=>{try{let t=await _.edit.editGetGames({count:Q,skip:(e-1)*Q});E(t.data),P((e-1)*Q+t.data.length)}catch(e){A(e,K)}})()},[e]),(0,Y.jsxs)(H,{isLoading:!S,headProps:{justify:`apart`},head:(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsxs)(F,{gap:`md`,wrap:`nowrap`,children:[(0,Y.jsx)(T,{leftSection:(0,Y.jsx)(X.Icon,{path:R,size:1}),onClick:()=>d(!0),children:K(`admin.button.games.new`)}),(0,Y.jsx)(r,{onChange:async t=>{if(t){x(0),m(!0);try{let n=await _.edit.editImportGame({file:t},{onUploadProgress:e=>{x(e.loaded/(e.total??1)*100)}});if(x(0),m(!1),n.data){let t=await _.edit.editGetGames({count:Q,skip:(e-1)*Q});E(t.data),P((e-1)*Q+t.data.length),I(`/admin/games/${n.data}/info`)}}catch(e){A(e,K),x(0),m(!1)}}},accept:`application/zip`,children:e=>(0,Y.jsxs)(T,{...e,leftSection:(0,Y.jsx)(X.Icon,{path:f,size:1}),className:G.button,disabled:p,color:h===0?q.primaryColor:`cyan`,variant:`outline`,children:[(0,Y.jsx)(`div`,{className:G.label,children:K(h===0?`admin.button.games.import`:`admin.notification.games.import.importing`)}),h!==0&&(0,Y.jsx)(a,{value:h,className:G.progress,color:w(q.colors[q.primaryColor][2],.35),radius:`sm`})]})})]}),(0,Y.jsxs)(F,{w:`calc(100% - 9rem)`,justify:`right`,children:[(0,Y.jsx)(v,{fw:`bold`,size:`sm`,children:(0,Y.jsxs)(l,{i18nKey:`admin.content.games.stats`,values:{current:N,total:C},children:[`_`,(0,Y.jsx)(V,{children:`_`}),`_`]})}),(0,Y.jsx)(j,{size:`lg`,disabled:e<=1,onClick:()=>s(e-1),children:(0,Y.jsx)(X.Icon,{path:y,size:1})}),(0,Y.jsx)(v,{fw:`bold`,size:`sm`,children:e}),(0,Y.jsx)(j,{size:`lg`,disabled:e*Q>=C,onClick:()=>s(e+1),children:(0,Y.jsx)(X.Icon,{path:B,size:1})})]})]}),children:[(0,Y.jsx)(O,{shadow:`md`,p:`md`,w:`100%`,children:(0,Y.jsx)(z,{offsetScrollbars:!0,h:`calc(100vh - 190px)`,children:(0,Y.jsxs)(o,{className:U.table,children:[(0,Y.jsx)(o.Thead,{children:(0,Y.jsxs)(o.Tr,{children:[(0,Y.jsx)(o.Th,{miw:`1.8rem`,children:K(`admin.label.games.hide`)}),(0,Y.jsx)(o.Th,{children:K(`common.label.game`)}),(0,Y.jsx)(o.Th,{children:K(`common.label.time`)}),(0,Y.jsx)(o.Th,{children:K(`admin.label.games.summary`)}),(0,Y.jsx)(o.Th,{})]})}),(0,Y.jsx)(o.Tbody,{children:S&&S.map(e=>{let{startTime:r,endTime:a,status:s}=t(e),c=n.get(s);return(0,Y.jsxs)(o.Tr,{children:[(0,Y.jsx)(o.Td,{children:(0,Y.jsx)(u,{disabled:p,checked:e.hidden,onChange:()=>$(e)})}),(0,Y.jsx)(o.Td,{children:(0,Y.jsxs)(F,{wrap:`nowrap`,justify:`space-between`,children:[(0,Y.jsxs)(F,{wrap:`nowrap`,justify:`left`,onClick:()=>I(`/games/${e.id}`),className:i.cPointer,children:[(0,Y.jsx)(ee,{alt:`avatar`,src:e.poster,radius:0,children:e.title?.slice(0,1)}),(0,Y.jsx)(v,{fw:`bold`,lineClamp:1,maw:`calc(20vw)`,children:e.title})]}),(0,Y.jsx)(g,{color:c,children:s})]})}),(0,Y.jsx)(o.Td,{children:(0,Y.jsxs)(F,{wrap:`nowrap`,gap:`xs`,children:[(0,Y.jsx)(g,{size:`sm`,color:c,variant:`dot`,children:(0,Z.default)(r).format(`YYYY-MM-DD HH:mm`)}),(0,Y.jsx)(X.Icon,{path:`M14.58,16.59L19.17,12L14.58,7.41L16,6L22,12L16,18L14.58,16.59M8.58,16.59L13.17,12L8.58,7.41L10,6L16,12L10,18L8.58,16.59M2.58,16.59L7.17,12L2.58,7.41L4,6L10,12L4,18L2.58,16.59Z`,size:1}),(0,Y.jsx)(g,{size:`sm`,color:c,variant:`dot`,children:(0,Z.default)(a).format(`YYYY-MM-DD HH:mm`)})]})}),(0,Y.jsx)(o.Td,{children:(0,Y.jsx)(v,{size:`sm`,truncate:!0,maw:`20rem`,children:e.summary})}),(0,Y.jsx)(o.Td,{children:(0,Y.jsx)(F,{justify:`right`,children:(0,Y.jsx)(j,{component:k,to:`/admin/games/${e.id}/info`,children:(0,Y.jsx)(X.Icon,{path:`M14.06,9L15,9.94L5.92,19H5V18.08L14.06,9M17.66,3C17.41,3 17.15,3.1 16.96,3.29L15.13,5.12L18.88,8.87L20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18.17,3.09 17.92,3 17.66,3M14.06,6.19L3,17.25V21H6.75L17.81,9.94L14.06,6.19Z`,size:1})})})})]},e.id)})})]})})}),(0,Y.jsx)(te,{opened:c,onClose:()=>d(!1),onAddGame:e=>D([...S??[],e])})]})};export{$ as default};