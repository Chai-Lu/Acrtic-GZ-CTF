/* The GZ::CTF Project @unknown
 * 
 * License   : GNU Affero General Public License v3.0 (Core)
 * License   : LicenseRef-GZCTF-Restricted (Restricted components)
 * Commit    : Unofficial build version
 * Build     : 2025-12-08T11:45:34.456Z
 * Copyright (C) 2022-2025 GZTimeWalker. All Rights Reserved.
 */
import{n as e,r as t}from"./lcut4z52.js";import{t as n}from"./isy1dskq.js";import{t as r}from"./kocdnk2i.js";import{n as i,t as a}from"./m0xgfnwp.js";import{t as o}from"./glsbf5jj.js";import"./hrbt7ry7.js";import{c as s,f as c,i as l}from"./gaobt2im.js";import"./j0saofxo.js";import{t as u}from"./dvcvy16t.js";import"./nugqs812.js";import"./b671iymd.js";import{t as d}from"./h0nb8b87.js";import{t as f}from"./lj7msjkh.js";import{$n as p,An as m,Br as h,Ca as g,Cr as _,F as v,Gi as y,Hr as b,In as x,Jr as S,Kn as C,Li as w,Nr as T,O as E,Oa as D,Or as O,Pi as k,Ti as A,Tr as j,Vr as M,W as N,_n as P,ar as F,b as I,ca as L,cr as ee,dr as R,ha as te,ji as z,jn as B,jr as V,li as H,q as U,qr as ne,sr as re,ta as W,ui as G,vt as K,wi as q}from"./index.hrqptwjo.js";import{r as ie}from"./c5dhfig7.js";import{t as ae}from"./laaps3um.js";var J={root:`m_66836ed3`,wrapper:`m_a5d60502`,body:`m_667c2793`,title:`m_6a03f287`,label:`m_698f4f23`,icon:`m_667f2a6a`,message:`m_7fa78076`,closeButton:`m_87f54839`},Y=D(te(),1),X=D(g(),1),oe=y((e,{radius:t,color:n,variant:r,autoContrast:i})=>{let a=e.variantColorResolver({color:n||e.primaryColor,theme:e,variant:r||`light`,autoContrast:i});return{root:{"--alert-radius":t===void 0?void 0:L(t),"--alert-bg":n||r?a.background:void 0,"--alert-color":a.color,"--alert-bd":n||r?a.border:void 0}}}),Z=q((e,t)=>{let n=z(`Alert`,null,e),{classNames:r,className:i,style:a,styles:o,unstyled:s,vars:c,radius:l,color:u,title:d,children:f,id:p,icon:m,withCloseButton:h,onClose:g,closeButtonLabel:_,variant:v,autoContrast:y,role:b,attributes:x,...S}=n,C=k({name:`Alert`,classes:J,props:n,className:i,style:a,classNames:r,styles:o,unstyled:s,attributes:x,vars:c,varsResolver:oe}),w=W(p),T=d&&`${w}-title`||void 0,E=`${w}-body`;return(0,Y.jsx)(A,{id:w,...C(`root`,{variant:v}),variant:v,ref:t,role:b||`alert`,...S,"aria-describedby":f?E:void 0,"aria-labelledby":d?T:void 0,children:(0,Y.jsxs)(`div`,{...C(`wrapper`),children:[m&&(0,Y.jsx)(`div`,{...C(`icon`),children:m}),(0,Y.jsxs)(`div`,{...C(`body`),children:[d&&(0,Y.jsx)(`div`,{...C(`title`),"data-with-close-button":h||void 0,children:(0,Y.jsx)(`span`,{id:T,...C(`label`),children:d})}),f&&(0,Y.jsx)(`div`,{id:E,...C(`message`),"data-variant":v,children:f})]}),h&&(0,Y.jsx)(G,{...C(`closeButton`),onClick:g,variant:`transparent`,size:16,iconSize:16,"aria-label":_,unstyled:s})]})})});Z.classes=J,Z.displayName=`@mantine/core/Alert`;var Q=D(E());const se=t=>{let{id:n}=ee(),r=parseInt(n??`-1`),{onSubmitJoin:i,...a}=t,{teams:c}=e(),{game:l}=s(r),{data:u}=x.game.useGameGetGameJoinCheckInfo(r,B,t.opened&&r>0),[f,p]=(0,X.useState)(``),[m,h]=(0,X.useState)(``),[g,v]=(0,X.useState)(null),[y,b]=(0,X.useState)(!1),{t:S}=R();(0,X.useEffect)(()=>{!g&&c&&c.length>=1&&v(c[0].id.toString())},[g,c]),(0,X.useEffect)(()=>{m||(typeof l?.division==`number`?h(l.division.toString()):l?.divisions&&l.divisions.length>=1&&l.divisions[0].id&&h(l.divisions[0].id.toString()))},[m,l]);let C=(0,X.useMemo)(()=>(l?.divisions??[]).filter(e=>e.id&&(!u?.joinableDivisions||u.joinableDivisions.includes(e.id))).map(e=>({value:e.id.toString(),label:e.name??`Division #${e.id}`})),[l?.divisions,u]),w=(0,X.useMemo)(()=>{let e=new Map;return u?.joinedTeams?.forEach(t=>{e.set(t.id.toString(),{div:t.division,joinable:u.joinableDivisions?.includes(t.division)})}),e},[u]),E=(0,X.useMemo)(()=>(l?.divisions??[]).find(e=>e.id?.toString()===m)??null,[m,l?.divisions]),D=(0,X.useMemo)(()=>c?.map(e=>({label:e.name,value:e.id.toString()}))??[],[c]),O=g?w.get(g):null,k=O?.div?l?.divisions?.find(e=>e.id===O?.div):null,A=C.length>0||O?.div,j=!O,N=A?!!E?.inviteCodeRequired:!!l?.inviteCodeRequired;(0,X.useEffect)(()=>{N||p(``)},[N]);let P=async()=>{if(b(!0),!g){_({color:`orange`,message:S(`game.notification.no_team`),icon:(0,Y.jsx)(Q.Icon,{path:U,size:1})}),b(!1);return}if(N&&!f){_({color:`orange`,message:S(`game.notification.no_invite_code`),icon:(0,Y.jsx)(Q.Icon,{path:U,size:1})}),b(!1);return}if(j&&A&&!m){_({color:`orange`,message:S(`game.notification.no_division`),icon:(0,Y.jsx)(Q.Icon,{path:U,size:1})}),b(!1);return}try{await i({teamId:parseInt(g,10),inviteCode:N?f:void 0,divisionId:j&&A?parseInt(m,10):!j&&k?k.id:void 0})}finally{p(``),h(``),b(!1),t.onClose()}};return(0,Y.jsx)(T,{...a,children:(0,Y.jsxs)(V,{children:[(0,Y.jsx)(o,{required:!0,label:S(`game.content.join.team.label`),description:S(`game.content.join.team.description`),data:D,disabled:y,value:g,onChange:e=>e&&v(e)}),j&&A&&(0,Y.jsx)(o,{required:!0,label:S(`game.content.join.division.label`),description:S(`game.content.join.division.description`),readOnly:!j,data:C,disabled:y,value:m,onChange:e=>h(e??``)}),!j&&k&&(0,Y.jsx)(o,{required:!0,label:S(`game.content.join.division.label`),description:S(`game.content.join.division.description`),readOnly:!0,disabled:!0,data:[{label:k.name??`Division #${k.id}`,value:k.id.toString()}],value:k.id.toString()}),N&&(0,Y.jsx)(d,{required:!0,label:S(`game.content.join.invite_code.label`),description:S(`game.content.join.invite_code.description`),value:f,onChange:e=>p(e.target.value),disabled:y}),(0,Y.jsx)(M,{disabled:y,onClick:P,children:S(`game.button.join`)})]})})};var $=D(E(),1),ce=(e,t)=>{let{t:n}=R(),r=new Map([[C.Pending,{color:`yellow`,icon:P,title:n(`game.participation.alert.pending.title`,{team:t}),content:n(`game.participation.alert.pending.content`)}],[C.Accepted,null],[C.Rejected,{color:`red`,icon:v,title:n(`game.participation.alert.rejected.title`),content:n(`game.participation.alert.rejected.content`)}],[C.Suspended,{color:`red`,icon:v,title:n(`game.participation.alert.suspended.title`,{team:t}),content:n(`game.participation.alert.suspended.content`)}],[C.Unsubmitted,null]]).get(e);return r?(0,Y.jsx)(Z,{color:r.color,icon:(0,Y.jsx)($.Icon,{path:r.icon}),title:r.title,children:r.content}):null},le=()=>{let{id:o}=ee(),d=parseInt(o??`-1`),g=re(),{game:v,error:y,mutate:T,status:E}=s(d),D=w(),{startTime:k,endTime:A,finished:P,started:L,progress:te}=l(v),{locale:z}=p(),{user:B}=t(),{teams:U}=e(),W=j(),G=m(),{t:K}=R();r(v?.title),(0,X.useEffect)(()=>{y&&(I(y,K),g(`/games`))},[y,g]);let{scrollIntoView:q,targetRef:J}=i(),[oe,Q]=(0,X.useState)(!1);(0,X.useEffect)(()=>q({alignment:`center`}),[q]);let le=new Map([[C.Pending,K(`game.participation.actions.pending`)],[C.Accepted,K(`game.participation.actions.accepted`)],[C.Rejected,K(`game.participation.actions.rejected`)],[C.Suspended,K(`game.participation.actions.suspended`)],[C.Unsubmitted,K(`game.participation.actions.unsubmitted`)]]),ue=async e=>{try{if(!d)return;await x.game.gameJoinGame(d,e),_({color:`teal`,message:K(`game.notification.joined`),icon:(0,Y.jsx)($.Icon,{path:N,size:1})}),T()}catch(e){return I(e,K)}},de=async()=>{try{if(!d)return;await x.game.gameLeaveGame(d),_({color:`teal`,message:K(`game.notification.left`),icon:(0,Y.jsx)($.Icon,{path:N,size:1})}),T()}catch(e){return I(e,K)}},fe=!P||v?.practiceMode,pe=(E===C.Unsubmitted||E===C.Rejected)&&fe&&B&&U&&U.length>0,me=B&&E===C.Unsubmitted&&fe&&U&&U.length===0,he=(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(M,{disabled:!pe,onClick:()=>W.openConfirmModal({title:K(`game.content.join.confirm`),children:(0,Y.jsxs)(V,{gap:`xs`,children:[(0,Y.jsx)(S,{size:`sm`,children:K(`game.content.join.content.0`)}),(0,Y.jsx)(S,{size:`sm`,children:(0,Y.jsx)(f,{i18nKey:`game.content.join.content.1`})}),(0,Y.jsx)(S,{size:`sm`,children:(0,Y.jsx)(f,{i18nKey:`game.content.join.content.2`})})]}),onConfirm:()=>Q(!0),confirmProps:{color:D.primaryColor}}),children:fe?B?le.get(E):K(`game.button.login_required`):K(`game.button.finished`)}),L&&(0,Y.jsx)(M,{component:F,to:`/games/${d}/scoreboard`,children:K(`game.button.scoreboard`)}),(E===C.Pending||E===C.Rejected)&&(0,Y.jsx)(M,{color:`red`,variant:`outline`,onClick:()=>W.openConfirmModal({title:K(`game.content.leave.confirm`),children:(0,Y.jsxs)(V,{gap:`xs`,children:[(0,Y.jsx)(S,{size:`sm`,children:K(`game.content.leave.content.0`)}),(0,Y.jsx)(S,{size:`sm`,children:K(`game.content.leave.content.1`)})]}),onConfirm:de,confirmProps:{color:D.primaryColor}}),children:K(`game.button.leave`)}),E===C.Accepted&&L&&!G&&(!P||v?.practiceMode)&&(0,Y.jsx)(M,{component:F,to:`/games/${d}/challenges`,children:K(`game.button.challenges`)})]});return(0,Y.jsxs)(n,{width:`100%`,isLoading:!v,minWidth:0,withFooter:!0,children:[(0,Y.jsx)(`div`,{ref:J,className:a.root,children:(0,Y.jsxs)(H,{wrap:`nowrap`,justify:`space-between`,w:`100%`,p:`0 ${D.spacing.md}`,className:a.container,children:[(0,Y.jsxs)(V,{gap:6,className:a.flexGrowAtSm,children:[(0,Y.jsxs)(H,{children:[(0,Y.jsx)(b,{variant:`outline`,children:!v||v.limit===0?K(`game.tag.multiplayer`):v.limit===1?K(`game.tag.individual`):K(`game.tag.limited`,{count:v.limit})}),v?.hidden&&(0,Y.jsx)(b,{variant:`outline`,children:K(`game.tag.hidden`)})]}),(0,Y.jsxs)(V,{gap:2,children:[(0,Y.jsx)(O,{className:a.title,children:v?.title}),(0,Y.jsx)(S,{size:`sm`,c:`dimmed`,children:(0,Y.jsx)(f,{i18nKey:`game.content.joined_status`,values:{count:v?.teamCount??0}})})]}),(0,Y.jsxs)(H,{justify:`space-between`,children:[(0,Y.jsxs)(V,{gap:0,children:[(0,Y.jsx)(S,{size:`sm`,className:a.date,children:K(`game.content.start_time`)}),(0,Y.jsx)(S,{size:`sm`,fw:`bold`,className:a.date,children:k.locale(z).format(`LLL`)})]}),(0,Y.jsxs)(V,{gap:0,children:[(0,Y.jsx)(S,{size:`sm`,className:a.date,children:K(`game.content.end_time`)}),(0,Y.jsx)(S,{size:`sm`,fw:`bold`,className:a.date,children:A.locale(z).format(`LLL`)})]})]}),(0,Y.jsx)(ae,{percentage:te}),(0,Y.jsx)(H,{children:he})]}),(0,Y.jsx)(c,{className:a.banner,src:v?.poster??``,radius:`sm`,children:(0,Y.jsx)(h,{h:`100%`,children:!v?.poster&&(0,Y.jsx)($.Icon,{path:`M12.36,6L12.76,8H18V14H14.64L14.24,12H7V6H12.36M14,4H5V21H7V14H12.6L13,16H20V6H14.4`,size:4,color:D.colors.gray[5]})})})]})}),(0,Y.jsxs)(u,{className:a.content,children:[(0,Y.jsxs)(V,{gap:`xs`,pb:100,children:[ce(E,v?.teamName??``),me&&(0,Y.jsx)(Z,{color:`yellow`,icon:(0,Y.jsx)($.Icon,{path:`M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z`}),title:K(`game.participation.alert.team_required.title`),children:(0,Y.jsxs)(f,{i18nKey:`game.participation.alert.team_required.content`,children:[`_`,(0,Y.jsx)(ne,{component:F,size:`sm`,to:`/teams`,children:`_`}),`_`]})}),E===C.Accepted&&!L&&(0,Y.jsxs)(Z,{color:`teal`,icon:(0,Y.jsx)($.Icon,{path:`M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z`}),title:K(`game.participation.alert.not_started.title`),children:[K(`game.participation.alert.not_started.content`,{team:v?.teamName??``}),G&&K(`game.participation.alert.not_started.mobile`)]}),(0,Y.jsx)(ie,{source:v?.content??``})]}),(0,Y.jsx)(se,{title:K(`game.content.join.title`),opened:oe,withCloseButton:!1,onClose:()=>Q(!1),onSubmitJoin:ue})]})]})};export{le as default};