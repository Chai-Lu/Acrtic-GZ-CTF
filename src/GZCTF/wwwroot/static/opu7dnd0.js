/* The GZ::CTF Project @unknown
 * 
 * License   : GNU Affero General Public License v3.0 (Core)
 * License   : LicenseRef-GZCTF-Restricted (Restricted components)
 * Commit    : Unofficial build version
 * Build     : 2025-12-08T11:45:34.456Z
 * Copyright (C) 2022-2025 GZTimeWalker. All Rights Reserved.
 */
import"./lcut4z52.js";import"./isy1dskq.js";import{t as e}from"./cdbutviq.js";import"./kocdnk2i.js";import{t}from"./glsbf5jj.js";import"./hrbt7ry7.js";import{t as n}from"./nugqs812.js";import{t as r}from"./gmgm1gqp.js";import"./h0nb8b87.js";import{t as i}from"./lj7msjkh.js";import{$n as a,$r as o,Ca as s,Cr as c,Dr as l,G as u,Hr as d,In as f,Jr as p,Jt as m,Li as h,M as g,Mr as _,O as v,Oa as y,Rn as b,Ti as x,W as S,_i as C,b as w,dr as T,ha as E,in as D,li as O,v as k,w as A,yi as j,zr as M}from"./index.hrqptwjo.js";import"./iwhjrhtg.js";import{t as N}from"./cjpezv9m.js";import"./mdazlrzp.js";import{t as P}from"./mbfygvvk.js";import{t as F}from"./c5hn22cb.js";var I=y(v(),1),L=y(l(),1),R=y(s(),1),z={input:`N_`},B=y(E(),1),V=({option:e})=>{let{name:t,id:r,...i}=e;return(0,B.jsx)(O,{...i,gap:0,wrap:`nowrap`,children:(0,B.jsxs)(p,{fw:500,size:`sm`,lineClamp:1,className:n.wordBreakAll,children:[(0,B.jsx)(p,{span:!0,c:`dimmed`,children:`#${r} `}),t]})})},H=({option:e})=>{let{title:t,id:r,category:i}=e,a=A().get(i??b.Misc);return(0,B.jsxs)(O,{wrap:`nowrap`,gap:`sm`,children:[(0,B.jsx)(I.Icon,{color:h().colors[a.color][4],path:a.icon,size:1}),(0,B.jsxs)(p,{fw:500,size:`sm`,lineClamp:1,className:n.wordBreakAll,children:[(0,B.jsx)(p,{span:!0,c:`dimmed`,children:`#${r} `}),t]})]})},U=()=>{let{data:n,mutate:s}=f.admin.useAdminInstances({refreshInterval:30*1e3,revalidateOnFocus:!1}),[l,u]=(0,R.useState)(),[m,h]=(0,R.useState)(),[v,y]=(0,R.useState)(!1),E=e(),U=A(),{t:W}=T(),{locale:G}=a();(0,R.useEffect)(()=>{n&&(u([...new Map(n.data.map(e=>[e.team.id,e.team])).values()]),h([...new Map(n.data.map(e=>[e.challenge.id,e.challenge])).values()]))},[n]);let[K,q]=(0,R.useState)(null),[J,Y]=(0,R.useState)(null),[X,Z]=(0,R.useState)(n?.data);(0,R.useEffect)(()=>{if(!n)return;let e=n.data;K&&(e=e.filter(e=>e.team?.id===Number(K))),J&&(e=e.filter(e=>e.challenge?.id===Number(J))),Z(e)},[n,K,J]);let Q=async e=>{if(e)try{y(!0),await f.admin.adminDestroyInstance(e),c({color:`teal`,message:W(`admin.notification.instances.destroyed`),icon:(0,B.jsx)(I.Icon,{path:S,size:1})}),n&&s({total:(n.total??n.length)-1,length:n.length-1,data:n.data.filter(t=>t.containerGuid!==e)})}catch(e){w(e,W)}finally{y(!1)}};return(0,B.jsx)(P,{isLoading:!n||!l||!m,head:(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(O,{w:`60%`,justify:`left`,gap:`md`,children:[(0,B.jsx)(t,{w:`48%`,searchable:!0,clearable:!0,placeholder:W(`admin.placeholder.instances.teams.select`),value:K,onChange:e=>q(e),leftSection:(0,B.jsx)(I.Icon,{path:g,size:1}),nothingFoundMessage:W(`admin.placeholder.instances.teams.not_found`),renderOption:V,data:l?.map(e=>({value:String(e.id),label:e.name,...e}))??[]}),(0,B.jsx)(t,{w:`48%`,searchable:!0,clearable:!0,placeholder:W(`admin.placeholder.instances.challenges.select`),onChange:e=>Y(e),leftSection:(0,B.jsx)(I.Icon,{path:D,size:1}),nothingFoundMessage:W(`admin.placeholder.instances.challenges.not_found`),renderOption:H,data:m?.map(e=>({value:String(e.id),label:e.title,...e}))??[]})]}),(0,B.jsx)(O,{justify:`right`,children:(0,B.jsx)(p,{fw:`bold`,size:`sm`,children:(0,B.jsxs)(i,{i18nKey:`admin.content.instances.stats`,values:{count:n?.length},children:[`_`,(0,B.jsx)(M,{children:`_`}),`_`]})})})]}),children:(0,B.jsxs)(C,{shadow:`md`,p:`xs`,w:`100%`,children:[(0,B.jsx)(j,{offsetScrollbars:!0,scrollbarSize:4,h:`calc(100vh - 205px)`,children:(0,B.jsxs)(r,{className:F.table,children:[(0,B.jsx)(r.Thead,{children:(0,B.jsxs)(r.Tr,{children:[(0,B.jsx)(r.Th,{children:W(`common.label.team`)}),(0,B.jsx)(r.Th,{children:W(`common.label.challenge`)}),(0,B.jsx)(r.Th,{children:W(`admin.label.instances.life_cycle`)}),(0,B.jsx)(r.Th,{children:W(`admin.label.instances.container_id`)}),(0,B.jsx)(r.Th,{children:W(`admin.label.instances.entry`)}),(0,B.jsx)(r.Th,{})]})}),(0,B.jsx)(r.Tbody,{children:X&&X.map(e=>{let t=U.get(e.challenge?.category??b.Misc).color;return(0,B.jsxs)(r.Tr,{children:[(0,B.jsx)(r.Td,{children:(0,B.jsx)(x,{w:`100%`,h:`100%`,children:(0,B.jsx)(o,{variant:`unstyled`,value:e.team?.name??`Team`,readOnly:!0,classNames:z})})}),(0,B.jsx)(r.Td,{children:(0,B.jsx)(x,{w:`100%`,h:`100%`,children:(0,B.jsx)(o,{variant:`unstyled`,value:e.challenge?.title??`Challenge`,readOnly:!0,classNames:z})})}),(0,B.jsx)(r.Td,{children:(0,B.jsxs)(O,{wrap:`nowrap`,gap:`xs`,children:[(0,B.jsx)(d,{size:`xs`,color:t,variant:`dot`,children:(0,L.default)(e.startedAt).locale(G).format(`SL HH:mm`)}),(0,B.jsx)(I.Icon,{path:`M14.58,16.59L19.17,12L14.58,7.41L16,6L22,12L16,18L14.58,16.59M8.58,16.59L13.17,12L8.58,7.41L10,6L16,12L10,18L8.58,16.59M2.58,16.59L7.17,12L2.58,7.41L4,6L10,12L4,18L2.58,16.59Z`,size:1}),(0,B.jsx)(d,{size:`xs`,color:t,variant:`dot`,children:(0,L.default)(e.expectStopAt).locale(G).format(`SL HH:mm`)})]})}),(0,B.jsx)(r.Td,{children:(0,B.jsx)(p,{size:`sm`,ff:`monospace`,lineClamp:1,children:(0,B.jsx)(_,{label:W(`common.button.copy`),withArrow:!0,position:`left`,children:(0,B.jsx)(p,{size:`sm`,ff:`monospace`,bg:`transparent`,fz:`sm`,className:F.clickable,onClick:()=>{E.copy(e.containerGuid&&k(e.containerGuid)),c({color:`teal`,title:W(`admin.notification.instances.url_copied.title`),message:W(`admin.notification.instances.url_copied.message`),icon:(0,B.jsx)(I.Icon,{path:`M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z`,size:1})})},children:e.containerGuid})})})}),(0,B.jsx)(r.Td,{children:(0,B.jsx)(_,{label:W(`common.button.copy`),withArrow:!0,position:`left`,children:(0,B.jsxs)(p,{size:`sm`,c:`dimmed`,ff:`monospace`,bg:`transparent`,fz:`sm`,className:F.clickable,onClick:()=>{E.copy(`${e.ip??``}:${e.port??``}`),c({color:`teal`,message:W(`admin.notification.instances.entry_copied`),icon:(0,B.jsx)(I.Icon,{path:`M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z`,size:1})})},children:[`${e.ip}:`,(0,B.jsx)(p,{span:!0,fw:`bold`,children:e.port})]})})}),(0,B.jsx)(r.Td,{align:`right`,children:(0,B.jsx)(O,{wrap:`nowrap`,gap:`sm`,justify:`right`,children:(0,B.jsx)(N,{iconPath:`M13 12.6L19 9.2V13C19.7 13 20.4 13.1 21 13.4V7.5C21 7.1 20.8 6.8 20.5 6.6L12.6 2.2C12.4 2.1 12.2 2 12 2S11.6 2.1 11.4 2.2L3.5 6.6C3.2 6.8 3 7.1 3 7.5V16.5C3 16.9 3.2 17.2 3.5 17.4L11.4 21.8C11.6 21.9 11.8 22 12 22S12.4 21.9 12.6 21.8L13.5 21.3C13.2 20.7 13.1 20 13 19.3M12 4.2L18 7.5L16 8.6L10.1 5.2L12 4.2M11 19.3L5 15.9V9.2L11 12.6V19.3M12 10.8L6 7.5L8 6.3L14 9.8L12 10.8M16.9 15.5L19 17.6L21.1 15.5L22.5 16.9L20.4 19L22.5 21.1L21.1 22.5L19 20.4L16.9 22.5L15.5 21.1L17.6 19L15.5 16.9L16.9 15.5Z`,color:`alert`,message:W(`admin.content.instances.destroy`,{name:e.containerGuid?.slice(0,8)}),disabled:v,onClick:()=>Q(e.containerGuid)})})})]},e.containerGuid)})})]})}),(0,B.jsx)(p,{size:`xs`,c:`dimmed`,children:W(`admin.content.instances.note`)})]})})};export{U as default};