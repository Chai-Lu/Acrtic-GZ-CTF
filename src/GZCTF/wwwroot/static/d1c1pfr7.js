/* The GZ::CTF Project @unknown
 * 
 * License   : GNU Affero General Public License v3.0 (Core)
 * License   : LicenseRef-GZCTF-Restricted (Restricted components)
 * Commit    : Unofficial build version
 * Build     : 2025-12-08T11:45:34.456Z
 * Copyright (C) 2022-2025 GZTimeWalker. All Rights Reserved.
 */
import{t as e}from"./cdbutviq.js";import{t}from"./nugqs812.js";import{t as n}from"./h0nb8b87.js";import{$n as r,$r as i,Bn as a,Ca as o,Cr as s,D as c,Dr as l,Gt as u,Jr as d,Li as f,Mr as p,Nr as m,O as h,Oa as g,Or as ee,Pn as _,Rr as v,Vr as y,W as b,Y as te,bi as x,bn as S,di as C,dr as ne,ha as w,ia as T,jr as E,jt as D,li as O,ln as k,n as A,qr as re,qt as ie,r as j,st as M,v as N,zn as P}from"./index.hrqptwjo.js";import{n as ae,r as F,t as I}from"./c5dhfig7.js";import{t as L}from"./fmw116au.js";var R=g(o(),1);function oe(e,t,n={leading:!1}){let[r,i]=(0,R.useState)(e),a=(0,R.useRef)(null),o=(0,R.useRef)(!0),s=()=>window.clearTimeout(a.current);return(0,R.useEffect)(()=>s,[]),[r,(0,R.useCallback)(e=>{s(),o.current&&n.leading?i(e):a.current=window.setTimeout(()=>{o.current=!0,i(e)},t),o.current=!1},[n.leading])]}var se={icon:`Ka`},z=g(h()),B=g(l()),V=g(L()),H=g(w());B.default.extend(V.default);var ce=e=>{let{time:t,onTimeout:n,extendEnabled:r,enableExtend:i}=e,{config:a}=_(),[o,s]=(0,R.useState)((0,B.default)()),[c,l]=(0,R.useState)(!1),u=t?(0,B.default)(t):o.add(a.defaultLifetime??120,`minutes`),f=B.default.duration(u.diff(o));return(0,R.useEffect)(()=>{if((0,B.default)()>u)return;let e=setInterval(()=>s((0,B.default)()),1e3);return()=>clearInterval(e)},[]),(0,R.useEffect)(()=>{!r&&a.renewalWindow&&f.asMinutes()<a.renewalWindow&&i();let e=f.asSeconds()<=0;e&&!c&&n&&(l(!0),n()),!e&&c&&l(!1)},[f,a.renewalWindow,c,n]),(0,H.jsx)(d,{span:!0,fw:`bold`,children:f.asSeconds()>0?f.format(`HH:mm:ss`):`00:00:00`})};const U=r=>{let{test:i,label:o,context:l,disabled:f,onCreate:m,onDestroy:h}=r,{wsrx:g,wsrxState:ee,wsrxOptions:x}=j(),{config:S}=_(),w=e(),[D,ie]=(0,R.useState)(!1),[P,ae]=(0,R.useState)(!!l.instanceEntry),F=l.instanceEntry??``,I=S.portMapping===a.PlatformProxy&&F.length===36&&!F.includes(`:`),L=I?N(F,i):F,[V,U]=oe(!1,500),{t:W}=ne(),G=T(()=>{s({color:`orange`,title:W(`challenge.notification.instance.extend.note.title`),message:W(`challenge.notification.instance.extend.note.message`),icon:(0,H.jsx)(z.Icon,{path:M,size:1})}),U(!0)},100);(0,R.useEffect)(()=>{ae(!!l.instanceEntry),U(B.default.duration((0,B.default)(l.closeTime??0).diff((0,B.default)())).asMinutes()<(S.renewalWindow??10))},[l,S.renewalWindow]);let K=()=>{!V||!r.onExtend||(r.onExtend(),s({color:`teal`,title:W(`challenge.notification.instance.extend.success.title`),message:W(`challenge.notification.instance.extend.success.message`),icon:(0,H.jsx)(z.Icon,{path:b,size:1})}),U(!1))},q=g.list().find(e=>e.remote===L),[le,J]=(0,R.useState)(q?.local??``),Y=I&&ee===c.Usable,X=!!q&&D;(0,R.useEffect)(()=>{if(!L||!Y)return;let e=x.allowLan?`0.0.0.0:0`:`127.0.0.1:0`;(async()=>{try{J((await g.add({label:o,remote:L,local:e})).local)}catch(e){A(e,W)}})()},[L,Y,o,x.allowLan]);let Z=Y&&!X,Q=Z?le:L,$=I&&!Z,ue=()=>{w.copy(Q),s({color:`teal`,title:$?W(`challenge.notification.instance.copied.url.title`):void 0,message:W($?`challenge.notification.instance.copied.url.message`:`challenge.notification.instance.copied.entry`),icon:(0,H.jsx)(z.Icon,{path:b,size:1})})};return P?(0,H.jsxs)(E,{gap:`sm`,w:`100%`,children:[(0,H.jsx)(n,{label:(0,H.jsx)(d,{size:`sm`,fw:`bold`,children:W(`challenge.content.instance.entry.label`)}),description:I&&!i&&(0,H.jsxs)(d,{span:!0,size:`sm`,children:[W(`challenge.content.instance.entry.description.proxy`),`\xA0`,(0,H.jsx)(re,{href:`https://github.com/XDSEC/WebSocketReflectorX/releases`,target:`_blank`,rel:`noreferrer`,children:W(`challenge.content.instance.entry.description.anchor`)})]}),leftSection:(0,H.jsx)(z.Icon,{path:k,size:1,"data-proxied":Y&&!X||void 0,className:se.icon}),value:Q,readOnly:!0,classNames:{input:t.ffmono},rightSection:(0,H.jsxs)(O,{gap:2,children:[(0,H.jsx)(v,{orientation:`vertical`,pr:4}),Y&&(0,H.jsx)(p,{label:W(D?`challenge.button.instance.show.proxied`:`challenge.button.instance.show.original`),withArrow:!0,children:(0,H.jsx)(C,{onClick:()=>ie(e=>!e),children:(0,H.jsx)(z.Icon,{path:`M18,11H14.82C14.4,9.84 13.3,9 12,9C10.7,9 9.6,9.84 9.18,11H6C5.67,11 4,10.9 4,9V8C4,6.17 5.54,6 6,6H16.18C16.6,7.16 17.7,8 19,8A3,3 0 0,0 22,5A3,3 0 0,0 19,2C17.7,2 16.6,2.84 16.18,4H6C4.39,4 2,5.06 2,8V9C2,11.94 4.39,13 6,13H9.18C9.6,14.16 10.7,15 12,15C13.3,15 14.4,14.16 14.82,13H18C18.33,13 20,13.1 20,15V16C20,17.83 18.46,18 18,18H7.82C7.4,16.84 6.3,16 5,16A3,3 0 0,0 2,19A3,3 0 0,0 5,22C6.3,22 7.4,21.16 7.82,20H18C19.61,20 22,18.93 22,16V15C22,12.07 19.61,11 18,11M19,4A1,1 0 0,1 20,5A1,1 0 0,1 19,6A1,1 0 0,1 18,5A1,1 0 0,1 19,4M5,20A1,1 0 0,1 4,19A1,1 0 0,1 5,18A1,1 0 0,1 6,19A1,1 0 0,1 5,20Z`,size:1})})}),(0,H.jsx)(p,{label:W(`common.button.copy`),withArrow:!0,children:(0,H.jsx)(C,{onClick:ue,children:(0,H.jsx)(z.Icon,{path:te,size:1})})}),(0,H.jsx)(p,{label:W(`challenge.content.instance.open.web`),withArrow:!0,children:(0,H.jsx)(C,{disabled:$,component:`a`,href:$?`#`:`http://${Z&&x.allowLan?Q.replace(`0.0.0.0`,`127.0.0.1`):Q}`,target:$?void 0:`_blank`,rel:`noreferrer`,children:(0,H.jsx)(z.Icon,{path:u,size:1})})})]}),rightSectionWidth:Y?`6.5rem`:`5rem`}),!i&&(0,H.jsxs)(O,{justify:`space-between`,wrap:`nowrap`,children:[(0,H.jsxs)(E,{align:`left`,gap:0,children:[(0,H.jsxs)(d,{size:`sm`,fw:600,children:[W(`challenge.content.instance.actions.count_down`),(0,H.jsx)(ce,{time:l.closeTime,extendEnabled:V,enableExtend:G,onTimeout:h})]}),(0,H.jsx)(d,{size:`xs`,c:`dimmed`,fw:600,children:W(`challenge.content.instance.actions.note`,{min:S.renewalWindow})})]}),(0,H.jsxs)(O,{justify:`right`,wrap:`nowrap`,gap:`xs`,children:[(0,H.jsx)(y,{color:`orange`,onClick:K,disabled:!V||f,children:W(`challenge.button.instance.extend`)}),(0,H.jsx)(y,{color:`red`,onClick:h,disabled:f,children:W(`challenge.button.instance.destroy`)})]})]})]}):i?(0,H.jsx)(d,{size:`md`,c:`dimmed`,fw:`bold`,pt:30,children:W(`challenge.content.instance.test.no_container`)}):(0,H.jsxs)(O,{justify:`space-between`,wrap:`nowrap`,children:[(0,H.jsxs)(E,{align:`left`,gap:0,children:[(0,H.jsx)(d,{size:`sm`,fw:`bold`,children:W(`challenge.content.instance.no_container.message`)}),(0,H.jsx)(d,{size:`xs`,c:`dimmed`,fw:`bold`,children:W(`challenge.content.instance.no_container.note`,{min:S.defaultLifetime})})]}),(0,H.jsx)(y,{onClick:m,disabled:f,loading:f,children:W(`challenge.button.instance.create`)})]})};var W={title:`Pc`,header:`Qc`,body:`Rc`,content:`Sc`,footer:`Tc`},G=g(h()),K=g(l()),q=g(L());K.default.extend(q.default);var le=({deadline:e,onExpiredChange:t})=>{let{t:n}=ne(),[i,a]=(0,R.useState)((0,K.default)()),{locale:o}=r();if((0,R.useEffect)(()=>{a((0,K.default)());let e=setInterval(()=>a((0,K.default)()),1e3);return()=>clearInterval(e)},[e]),(0,R.useEffect)(()=>{t(i.isAfter(e))},[i,e,t]),i.isAfter(e))return null;let s=(0,R.useMemo)(()=>e.locale(o).format(`L LTS`),[e,o]),c=e.diff(i),l=K.default.duration(c),u=`${Math.floor(l.asHours())}:${l.format(`mm:ss`)}`;return(0,H.jsxs)(O,{gap:`xs`,justify:`space-between`,wrap:`nowrap`,children:[(0,H.jsxs)(d,{fw:`bold`,size:`sm`,children:[n(`challenge.content.deadline.remaining`),`\xA0`,(0,H.jsx)(d,{span:!0,ff:`monospace`,fw:`bold`,size:`sm`,c:`brand`,children:u})]}),(0,H.jsxs)(d,{fw:`bold`,size:`xs`,c:`dimmed`,children:[n(`challenge.content.deadline.label`),`\xA0`,(0,H.jsx)(d,{span:!0,ff:`monospace`,c:`dimmed`,fw:`bold`,size:`xs`,children:s})]})]})};const J=e=>{let{challenge:a,cateData:o,solved:s,disabled:c,gameTitle:l,gameEnded:u,practiceMode:p,flag:h,setFlag:g,onCreate:_,onExtend:b,onDestroy:te,onDownload:S,onSubmitFlag:C,...w}=e,{t:T}=ne(),D=f(),{locale:k}=r(),A=T(`challenge.content.flag_placeholders`,{returnObjects:!0}),[re,ie]=(0,R.useState)(``);(0,R.useEffect)(()=>{ie(A[Math.floor(Math.random()*A.length)])},[a]);let j=(0,R.useMemo)(()=>a?.deadline?(0,K.default)(a.deadline):null,[a?.deadline]),[M,N]=(0,R.useState)(()=>j?(0,K.default)().isAfter(j):!1);(0,R.useEffect)(()=>{N(j?(0,K.default)().isAfter(j):!1)},[j]);let L=a?.limit&&(a.attempts??0)>=a.limit||!1,oe=a?.type===P.StaticContainer||a?.type===P.DynamicContainer,se=(0,H.jsxs)(E,{gap:`xs`,children:[(0,H.jsxs)(O,{wrap:`nowrap`,w:`100%`,justify:`space-between`,gap:`sm`,children:[(0,H.jsxs)(O,{wrap:`nowrap`,gap:`sm`,w:`calc(100% - 6.75rem)`,children:[o&&(0,H.jsx)(G.Icon,{path:o.icon,size:1.2,color:D.colors[o.color][5]}),(0,H.jsx)(ee,{order:4,lineClamp:1,children:a?.title??``})]}),(0,H.jsxs)(d,{miw:`6rem`,fw:`bold`,ff:`monospace`,ta:`right`,children:[a?.score??0,` pts`]})]}),(0,H.jsx)(v,{size:`md`,color:o?.color})]}),z=(0,H.jsx)(x,{mah:`52vh`,maw:`100%`,scrollbars:`y`,scrollbarSize:6,type:`scroll`,children:a?.content===void 0?(0,H.jsx)(I,{}):(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(F,{source:a.content??``}),a.hints&&a.hints.length>0&&(0,H.jsx)(E,{gap:2,pt:`sm`,children:a.hints.map(e=>(0,H.jsxs)(O,{gap:`xs`,align:`flex-start`,wrap:`nowrap`,children:[(0,H.jsx)(G.Icon,{path:`M20,11H23V13H20V11M1,11H4V13H1V11M13,1V4H11V1H13M4.92,3.5L7.05,5.64L5.63,7.05L3.5,4.93L4.92,3.5M16.95,5.63L19.07,3.5L20.5,4.93L18.37,7.05L16.95,5.63M12,6A6,6 0 0,1 18,12C18,14.22 16.79,16.16 15,17.2V19A1,1 0 0,1 14,20H10A1,1 0 0,1 9,19V17.2C7.21,16.16 6,14.22 6,12A6,6 0 0,1 12,6M14,21V22A1,1 0 0,1 13,23H11A1,1 0 0,1 10,22V21H14M11,18H13V15.87C14.73,15.43 16,13.86 16,12A4,4 0 0,0 12,8A4,4 0 0,0 8,12C8,13.86 9.27,15.43 11,15.87V18Z`,size:.8,color:D.colors.yellow[5]}),(0,H.jsx)(ae,{size:`sm`,maw:`calc(100% - 2rem)`,source:e},e)]},e))})]})}),B=j&&!M,V=B&&(0,H.jsx)(le,{deadline:j,onExpiredChange:N}),ce=!!a?.context?.url||S,q=a?.context?.url,J=q&&q.startsWith(`/assets`),Y=ce&&(0,H.jsxs)(O,{gap:`xs`,justify:`flex-start`,align:`center`,wrap:`nowrap`,children:[(0,H.jsx)(d,{fw:`bold`,size:`sm`,children:T(`challenge.button.download.attachment`)}),(0,H.jsx)(y,{component:`a`,href:q??`#`,variant:`light`,size:`compact-sm`,target:`_blank`,rel:`noreferrer`,leftSection:(0,H.jsx)(G.Icon,{path:J?`M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L10.11,5.22L16,8.61L17.96,7.5L12,4.15M6.04,7.5L12,10.85L13.96,9.75L8.08,6.35L6.04,7.5M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V9.21L13,12.58V19.29L19,15.91Z`:`M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z`,size:.8}),maw:`20rem`,onClick:S&&(e=>{e.preventDefault(),S()}),children:J?q.split(`/`).pop():T(`common.content.external_link`)})]}),X=oe&&a?.context,Z=X&&(0,H.jsx)(U,{label:`${a.title} @ ${l}`,context:a.context,onCreate:_,onExtend:b,onDestroy:te,disabled:c}),Q=(0,R.useMemo)(()=>{if(typeof a?.attempts!=`number`||s)return null;let e=null;if(j&&M)e=T(`challenge.content.deadline.expired`,{deadline:j.locale(k).format(`L LTS`)});else if(a?.limit){let t=a.limit-a.attempts;e=t>0?T(`challenge.content.attempts.remaining`,{remaining:t}):T(`challenge.content.attempts.exhausted`)}else e=T(`challenge.content.attempts.count`,{count:a.attempts});return(0,H.jsx)(i.Label,{children:e})},[a?.attempts,a?.limit,s,j,k,M,T]),$=s?T(`challenge.content.already_solved`):L?T(`challenge.content.attempts.placeholder`):h,ue=!M||u&&p,de=c||s||L||!ue,fe=(0,H.jsxs)(E,{gap:`xs`,className:W.footer,children:[(ce||X||B)&&(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(v,{mb:Q?`0.2rem`:void 0}),Y,Z,V]}),(0,H.jsx)(v,{label:Q,my:Q?`-0.4rem`:void 0}),(0,H.jsx)(`form`,{onSubmit:e=>{e.preventDefault(),!s&&ue&&C()},children:(0,H.jsxs)(O,{justify:`space-between`,gap:`sm`,align:`flex-end`,children:[(0,H.jsx)(n,{placeholder:re,value:$,disabled:de,onChange:g,classNames:{root:t.flexGrow,input:t.ffmono}}),(0,H.jsx)(y,{miw:`6rem`,type:`submit`,disabled:de,children:T(`challenge.button.submit_flag`)})]})})]});return(0,H.jsxs)(m.Root,{size:`42vw`,...w,onClose:()=>{g(``),w.onClose()},centered:!0,classNames:W,children:[(0,H.jsx)(m.Overlay,{}),(0,H.jsxs)(m.Content,{children:[(0,H.jsx)(m.Header,{children:(0,H.jsx)(m.Title,{children:se})}),(0,H.jsx)(m.Body,{children:z}),fe]})]})};export{U as n,J as t};